document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');/*
---
script: Fx.Scroll.js
name: Fx.Scroll
description: Effect to smoothly scroll any element, including the window.
license: MIT-style license
authors:
  - Valerio Proietti
requires:
  - Core/Fx
  - Core/Element.Event
  - Core/Element.Dimensions
  - MooTools.More
provides: [Fx.Scroll]
...
*/

function GHE_isBody(element){
	return (/^(?:body|html)$/i).test(element.tagName);
}

Fx.Scroll = new Class({
	Extends: Fx,
	options: {
		offset: {x: 0, y: 0},
		wheelStops: true
	},
	initialize: function(element, options){
		this.element = this.subject = document.id(element);
		this.parent(options);
		if (typeOf(this.element) != 'element') this.element = document.id(this.element.getDocument().body);
		if (this.options.wheelStops){
			var stopper = this.element,
				cancel = this.cancel.pass(false, this);
			this.addEvent('start', function(){
				stopper.addEvent('mousewheel', cancel);
			}, true);
			this.addEvent('complete', function(){
				stopper.removeEvent('mousewheel', cancel);
			}, true);
		}
	},
	set: function(){
		var now = Array.flatten(arguments);
		if (Browser.firefox) now = [Math.round(now[0]), Math.round(now[1])]; // not needed anymore in newer firefox versions
		this.element.scrollTo(now[0], now[1]);
		return this;
	},
	compute: function(from, to, delta){
		return [0, 1].map(function(i){
			return Fx.compute(from[i], to[i], delta);
		});
	},
	start: function(x, y){
		if (!this.check(x, y)) return this;
		var scroll = this.element.getScroll();
		return this.parent([scroll.x, scroll.y], [x, y]);
	},
	calculateScroll: function(x, y){
		var element = this.element,
			scrollSize = element.getScrollSize(),
			scroll = element.getScroll(),
			size = element.getSize(),
			offset = this.options.offset,
			values = {x: x, y: y};
		for (var z in values){
			if (!values[z] && values[z] !== 0) values[z] = scroll[z];
			if (typeOf(values[z]) != 'number') values[z] = scrollSize[z] - size[z];
			values[z] += offset[z];
		}
		return [values.x, values.y];
	},
	toElement: function(el, axes){
		axes = axes ? Array.from(axes) : ['x', 'y'];
		var scroll = GHE_isBody(this.element) ? {x: 0, y: 0} : this.element.getScroll();
		var position = Object.map(document.id(el).getPosition(this.element), function(value, axis){
			return axes.contains(axis) ? value + scroll[axis] : false;
		});
		return this.start.apply(this, this.calculateScroll(position.x, position.y));
	}
});

var Embed = new Class({
	Implements: [Events],
	initialize: function(wrapper, codeWrapper, data){

		this.wrapper = document.id(wrapper);
		this.codeWrapper = document.id(codeWrapper);
		this.data = data;
		this.codeScroll = new Fx.Scroll(this.codeWrapper, {link: 'cancel'});
		this.files = [];
		this.rawTree = [];
		for (var i = 0; i < data.tree.length; i++) {
			var file = {};
			file.path = this.getPath(this.data.tree[i].path);
			file.mode = this.data.tree[i].mode;
			file.sha = this.data.tree[i].sha;
			file.url = this.data.tree[i].url;
			file.name = file.path.pop();
			file.extension = file.name.split('.').pop();
			file.type = (this.data.tree[i].type == "tree")? 'folder' : 'file';
			this.rawTree.push(file);
		}
		this.filelist = new GHE_Filelist(this.wrapper);
		//loop through files, and make structure.
		for (var i = 0; i < this.rawTree.length; i++) {
			var file = this.rawTree[i];
			var path = this.filelist;
			//find/create file path
			while(file.path.length > 0){
				var segment = file.path.shift();
				if(!path[segment]){
					path[segment] =  new GHE_Folder(path.fileHousing, file, segment);
				}
				path = path[segment];
			}
			if(file.type == 'file'){
				if(file.extension != 'gitignore' && file.extension != 'pdf'){
					path[file.name] = new GHE_File(path.fileHousing,file);
					path[file.name].addEvent('clicked', this.fileClicked.bind(this));
					this.files.push(path[file.name]);
				}
			}else{
				path[file.name] = new GHE_Folder(path.fileHousing,file);
			}
		}
		this.files[0].select();
		console.log(this.fileList);
	},
	fileClicked: function(file){
		for (var i = 0; i < this.files.length; i++) {
			this.files[i].unselect();
		}
		file.select();
		console.log(file);
		this.codeScroll.toElement(document.id(file.sha));
	},
	getPath: function(path){
		return path.split("/");
	}
});var GHE_Filelist = new Class({
	Implements: [Events],
	initialize: function(wrapper){
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'fileList'}).inject(this.wrapper);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.body);
		//console.log(this);
	},
});
var GHE_File = new Class({
	Implements: [Events],
	initialize: function(wrapper, data){
		this.data = data;
		this.name = data.name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'file'}).inject(this.wrapper);
			this.nameEl = new Element('div', {'class': 'name', html: this.data.name}).inject(this.body);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	select: function(){
		this.body.addClass('selected');
	},
	unselect: function(){
		this.body.removeClass('selected');
	}
});var GHE_Folder = new Class({
	Implements: [Events],
	initialize: function(wrapper, data, name){
		this.data = data;
		this.name = name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.folderWrapper = new Element('div', {'class': 'folderWrapper'}).inject(this.wrapper);
			this.body = new Element('div', {'class': 'folder'}).inject(this.folderWrapper);
				this.nameEl = new Element('div', {'class': 'name', html: this.name}).inject(this.body);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.folderWrapper);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	addFile: function(file){
		this.fileHousing.inject(file.body);
	}
});
document.write('<div class=\"githubEmbed_projectWrapper\"><div class=\"projectHeader\" ><span class=\"projectTitle\"><a title=\"github.com: ameyer/HMC5883L\" href=\"http://github.com/ameyer/HMC5883L\">HMC5883L</a> </span><a class=\"downloadButton\" title=\"download prject from github\" href=\"https://github.com/ameyer/HMC5883L/archive/master.zip\">download</a></div><div class=\"body\"><div class=\"sideBar\" id=\"HMC5883L_sidebar\"></div><div class=\"projectCode\" id=\"HMC5883L_code\">   <div class=\"fileWrapper cpp\" id=\"b4ff4e801ba2b7e5c956674a1c36f0791db83011\">  <p class=\"fileHead\">HMC5883L.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />HMC5883L.cpp - Class file for the HMC5883L Triple Axis Magnetometer Arduino Library.<br />Copyright (C) 2011 Love Electronics (loveelectronics.co.uk)/ 2012 bildr.org (Arduino 1.0 compatible)<br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />WARNING: THE HMC5883L IS NOT IDENTICAL TO THE HMC5883!<br />Datasheet for HMC5883L:<br />http://www51.honeywell.com/aero/common/documents/myaerospacecatalog-documents/Defense_Brochures-documents/HMC5883L_3-Axis_Digital_Compass_IC.pdf<br /><br />*/</span><br /><br /><span class=\"co2\">#include &lt;Arduino.h&gt; </span><br /><span class=\"co2\">#include &quot;HMC5883L.h&quot;</span><br /><br />HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">HMC5883L</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> m_Scale <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />MagnetometerRaw HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">ReadRawAxis</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> uint8_t<span class=\"sy0\">*</span> buffer <span class=\"sy0\">=</span> Read<span class=\"br0\">&#40;</span>DataRegisterBegin<span class=\"sy0\">,</span> 6<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> MagnetometerRaw raw <span class=\"sy0\">=</span> MagnetometerRaw<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> raw.<span class=\"me1\">XAxis</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>buffer<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> buffer<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> raw.<span class=\"me1\">ZAxis</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>buffer<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> buffer<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> raw.<span class=\"me1\">YAxis</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>buffer<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> buffer<span class=\"br0\">&#91;</span>5<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> raw<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />MagnetometerScaled HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">ReadScaledAxis</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> MagnetometerRaw raw <span class=\"sy0\">=</span> ReadRawAxis<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> MagnetometerScaled scaled <span class=\"sy0\">=</span> MagnetometerScaled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> scaled.<span class=\"me1\">XAxis</span> <span class=\"sy0\">=</span> raw.<span class=\"me1\">XAxis</span> <span class=\"sy0\">*</span> m_Scale<span class=\"sy0\">;</span><br /> scaled.<span class=\"me1\">ZAxis</span> <span class=\"sy0\">=</span> raw.<span class=\"me1\">ZAxis</span> <span class=\"sy0\">*</span> m_Scale<span class=\"sy0\">;</span><br /> scaled.<span class=\"me1\">YAxis</span> <span class=\"sy0\">=</span> raw.<span class=\"me1\">YAxis</span> <span class=\"sy0\">*</span> m_Scale<span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> scaled<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">int</span> HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">SetScale</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> gauss<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />    uint8_t regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x00</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 0.88<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x00</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">0.73</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 1.3<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x01</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">0.92</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 1.9<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x02</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">1.22</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 2.5<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x03</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">1.52</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 4.0<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x04</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">2.27</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 4.7<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x05</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">2.56</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 5.6<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x06</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">3.03</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>gauss <span class=\"sy0\">==</span> 8.1<span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />        regValue <span class=\"sy0\">=</span> <span class=\"nu12\">0x07</span><span class=\"sy0\">;</span><br />        m_Scale <span class=\"sy0\">=</span> <span class=\"nu16\">4.35</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span><br />        <span class=\"kw1\">return</span> ErrorCode_1_Num<span class=\"sy0\">;</span><br />    <br />    <span class=\"co1\">// Setting is in the top 3 bits of the register.</span><br />    regValue <span class=\"sy0\">=</span> regValue <span class=\"sy0\">&lt;&lt;</span> <span class=\"nu0\">5</span><span class=\"sy0\">;</span><br />    Write<span class=\"br0\">&#40;</span>ConfigurationRegisterB<span class=\"sy0\">,</span> regValue<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">int</span> HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">SetMeasurementMode</span><span class=\"br0\">&#40;</span>uint8_t mode<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />    Write<span class=\"br0\">&#40;</span>ModeRegister<span class=\"sy0\">,</span> mode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">Write</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> data<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>HMC5883L_Address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>data<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />uint8_t<span class=\"sy0\">*</span> HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">Read</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> length<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>HMC5883L_Address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>HMC5883L_Address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">requestFrom</span><span class=\"br0\">&#40;</span>HMC5883L_Address<span class=\"sy0\">,</span> length<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> uint8_t buffer<span class=\"br0\">&#91;</span>length<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>Wire.<span class=\"me1\">available</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">==</span> length<span class=\"br0\">&#41;</span><br /> <span class=\"br0\">&#123;</span><br />     <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>uint8_t i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> length<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><br />     <span class=\"br0\">&#123;</span><br />         buffer<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> Wire.<span class=\"me1\">read</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />     <span class=\"br0\">&#125;</span><br /> <span class=\"br0\">&#125;</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw1\">return</span> buffer<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">char</span><span class=\"sy0\">*</span> HMC5883L<span class=\"sy0\">::</span><span class=\"me2\">GetErrorText</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> errorCode<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>ErrorCode_1_Num <span class=\"sy0\">==</span> 1<span class=\"br0\">&#41;</span><br />        <span class=\"kw1\">return</span> ErrorCode_1<span class=\"sy0\">;</span><br />    <br />    <span class=\"kw1\">return</span> <span class=\"st0\">&quot;Error not defined.&quot;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"917d2d4a09116dc1b09026d592a330bb316bee48\">  <p class=\"fileHead\">HMC5883L.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />HMC5883L.h - Header file for the HMC5883L Triple Axis Magnetometer Arduino Library.<br />Copyright (C) 2011 Love Electronics (loveelectronics.co.uk) / 2012 bildr.org (Arduino 1.0 compatible)<br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />WARNING: THE HMC5883L IS NOT IDENTICAL TO THE HMC5883!<br />Datasheet for HMC5883L:<br />http://www51.honeywell.com/aero/common/documents/myaerospacecatalog-documents/Defense_Brochures-documents/HMC5883L_3-Axis_Digital_Compass_IC.pdf<br /><br />*/</span><br /><br /><span class=\"co2\">#ifndef HMC5883L_h</span><br /><span class=\"co2\">#define HMC5883L_h</span><br /><br /><span class=\"co2\">#include &lt;Arduino.h&gt;</span><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><br /><br /><br /><span class=\"co2\">#define HMC5883L_Address 0x1E</span><br /><span class=\"co2\">#define ConfigurationRegisterA 0x00</span><br /><span class=\"co2\">#define ConfigurationRegisterB 0x01</span><br /><span class=\"co2\">#define ModeRegister 0x02</span><br /><span class=\"co2\">#define DataRegisterBegin 0x03</span><br /><br /><span class=\"co2\">#define Measurement_Continuous 0x00</span><br /><span class=\"co2\">#define Measurement_SingleShot 0x01</span><br /><span class=\"co2\">#define Measurement_Idle 0x03</span><br /><br /><span class=\"co2\">#define ErrorCode_1 &quot;Entered scale was not valid, valid gauss values are: 0.88, 1.3, 1.9, 2.5, 4.0, 4.7, 5.6, 8.1&quot;</span><br /><span class=\"co2\">#define ErrorCode_1_Num 1</span><br /><br /><span class=\"kw4\">struct</span> MagnetometerScaled<br /><span class=\"br0\">&#123;</span><br />    <span class=\"kw4\">float</span> XAxis<span class=\"sy0\">;</span><br />    <span class=\"kw4\">float</span> YAxis<span class=\"sy0\">;</span><br />    <span class=\"kw4\">float</span> ZAxis<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"kw4\">struct</span> MagnetometerRaw<br /><span class=\"br0\">&#123;</span><br />    <span class=\"kw4\">int</span> XAxis<span class=\"sy0\">;</span><br />    <span class=\"kw4\">int</span> YAxis<span class=\"sy0\">;</span><br />    <span class=\"kw4\">int</span> ZAxis<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br />class HMC5883L<br /><span class=\"br0\">&#123;</span><br />    public<span class=\"sy0\">:</span><br />     HMC5883L<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />     MagnetometerRaw ReadRawAxis<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />     MagnetometerScaled ReadScaledAxis<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br />     <span class=\"kw4\">int</span> SetMeasurementMode<span class=\"br0\">&#40;</span>uint8_t mode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />     <span class=\"kw4\">int</span> SetScale<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> gauss<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />     <span class=\"kw4\">char</span><span class=\"sy0\">*</span> GetErrorText<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> errorCode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />    protected<span class=\"sy0\">:</span><br />     <span class=\"kw4\">void</span> Write<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> byte<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />     uint8_t<span class=\"sy0\">*</span> Read<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> length<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />    private<span class=\"sy0\">:</span><br />     <span class=\"kw4\">float</span> m_Scale<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"c5224aabdd5a28a19b27fde13f5105b90023a650\">  <p class=\"fileHead\">HMC5883L_Example.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />HMC5883L_Example.pde - Example sketch for integration with an HMC5883L triple axis magnetomerwe.<br />Copyright (C) 2011 Love Electronics (loveelectronics.co.uk)<br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span class=\"co1\">// Reference the I2C Library</span><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><span class=\"co1\">// Reference the HMC5883L Compass Library</span><br /><span class=\"co2\">#include &lt;HMC5883L.h&gt;</span><br /><br /><span class=\"co1\">// Store our compass as a variable.</span><br />HMC5883L compass<span class=\"sy0\">;</span><br /><span class=\"co1\">// Record any errors that may occur in the compass.</span><br /><span class=\"kw4\">int</span> error <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br /><br /><span class=\"co1\">// Out setup routine, here we will configure the microcontroller and compass.</span><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> <span class=\"co1\">// Initialize the serial port.</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span>9600<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Starting the I2C interface.&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Start the I2C interface.</span><br /><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Constructing new HMC5883L&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> compass <span class=\"sy0\">=</span> HMC5883L<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Construct a new HMC5883 compass.</span><br />  <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Setting scale to +/- 1.3 Ga&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> error <span class=\"sy0\">=</span> compass.<span class=\"me1\">SetScale</span><span class=\"br0\">&#40;</span>1.3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Set the scale of the compass.</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>error <span class=\"sy0\">!=</span> <span class=\"nu0\">0</span><span class=\"br0\">&#41;</span> <span class=\"co1\">// If there is an error, print it out.</span><br />  <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>compass.<span class=\"me1\">GetErrorText</span><span class=\"br0\">&#40;</span>error<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Setting measurement mode to continous.&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> error <span class=\"sy0\">=</span> compass.<span class=\"me1\">SetMeasurementMode</span><span class=\"br0\">&#40;</span>Measurement_Continuous<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Set the measurement mode to Continuous</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>error <span class=\"sy0\">!=</span> <span class=\"nu0\">0</span><span class=\"br0\">&#41;</span> <span class=\"co1\">// If there is an error, print it out.</span><br />  <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>compass.<span class=\"me1\">GetErrorText</span><span class=\"br0\">&#40;</span>error<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Our main program loop.</span><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> <span class=\"co1\">// Retrive the raw values from the compass (not scaled).</span><br /> MagnetometerRaw raw <span class=\"sy0\">=</span> compass.<span class=\"me1\">ReadRawAxis</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">// Retrived the scaled values from the compass (scaled to the configured scale).</span><br /> MagnetometerScaled scaled <span class=\"sy0\">=</span> compass.<span class=\"me1\">ReadScaledAxis</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Values are accessed like so:</span><br /> <span class=\"kw4\">int</span> MilliGauss_OnThe_XAxis <span class=\"sy0\">=</span> scaled.<span class=\"me1\">XAxis</span><span class=\"sy0\">;</span><span class=\"co1\">// (or YAxis, or ZAxis)</span><br /><br /> <span class=\"co1\">// Calculate heading when the magnetometer is level, then correct for signs of axis.</span><br /> <span class=\"kw4\">float</span> heading <span class=\"sy0\">=</span> atan2<span class=\"br0\">&#40;</span>scaled.<span class=\"me1\">YAxis</span><span class=\"sy0\">,</span> scaled.<span class=\"me1\">XAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Once you have your heading, you must then add your \'Declination Angle\', which is the \'Error\' of the magnetic field in your location.</span><br /> <span class=\"co1\">// Find yours here: http://www.magnetic-declination.com/</span><br /> <span class=\"co1\">// Mine is: 2ï¿½ 37\' W, which is 2.617 Degrees, or (which we need) 0.0456752665 radians, I will use 0.0457</span><br /> <span class=\"co1\">// If you cannot find your Declination, comment out these two lines, your compass will be slightly off.</span><br /> <span class=\"kw4\">float</span> declinationAngle <span class=\"sy0\">=</span> <span class=\"nu16\">0.0457</span><span class=\"sy0\">;</span><br /> heading <span class=\"sy0\">+=</span> declinationAngle<span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Correct for when signs are reversed.</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>heading <span class=\"sy0\">&lt;</span> 0<span class=\"br0\">&#41;</span><br />  heading <span class=\"sy0\">+=</span> 2<span class=\"sy0\">*</span>PI<span class=\"sy0\">;</span><br />  <br /> <span class=\"co1\">// Check for wrap due to addition of declination.</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>heading <span class=\"sy0\">&gt;</span> 2<span class=\"sy0\">*</span>PI<span class=\"br0\">&#41;</span><br />  heading <span class=\"sy0\">-=</span> 2<span class=\"sy0\">*</span>PI<span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Convert radians to degrees for readability.</span><br /> <span class=\"kw4\">float</span> headingDegrees <span class=\"sy0\">=</span> heading <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span> <br /><br /> <span class=\"co1\">// Output the data via the serial port.</span><br /> Output<span class=\"br0\">&#40;</span>raw<span class=\"sy0\">,</span> scaled<span class=\"sy0\">,</span> heading<span class=\"sy0\">,</span> headingDegrees<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">// Normally we would delay the application by 66ms to allow the loop</span><br /> <span class=\"co1\">// to run at 15Hz (default bandwidth for the HMC5883L).</span><br /> <span class=\"co1\">// However since we have a long serial out (104ms at 9600) we will let</span><br /> <span class=\"co1\">// it run at its natural speed.</span><br /> <span class=\"co1\">// delay(66);</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Output the data down the serial port.</span><br /><span class=\"kw4\">void</span> Output<span class=\"br0\">&#40;</span>MagnetometerRaw raw<span class=\"sy0\">,</span> MagnetometerScaled scaled<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> heading<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> headingDegrees<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Raw:<span class=\"es1\">\\t</span>&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>raw.<span class=\"me1\">XAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>raw.<span class=\"me1\">YAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>raw.<span class=\"me1\">ZAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  <span class=\"es1\">\\t</span>Scaled:<span class=\"es1\">\\t</span>&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>scaled.<span class=\"me1\">XAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>scaled.<span class=\"me1\">YAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>scaled.<span class=\"me1\">ZAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;  <span class=\"es1\">\\t</span>Heading:<span class=\"es1\">\\t</span>&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>heading<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot; Radians  <span class=\"es1\">\\t</span>&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>headingDegrees<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot; Degrees  <span class=\"es1\">\\t</span>&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"99bb7da315196d2af6014a3d6694608c1168705e\">  <p class=\"fileHead\">keywords.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>#######################################<br /># Syntax Coloring Map For Matrix<br />#######################################<br /><br />#######################################<br /># Datatypes (KEYWORD1)<br />#######################################<br /><br />HMC5883L            KEYWORD1<br />MagnetometerRaw     KEYWORD1<br />MagnetometerScaled   KEYWORD1<br /><br />#######################################<br /># Methods and Functions (KEYWORD2)<br />#######################################<br /><br />ReadRawAxis           KEYWORD2<br />ReadScaledAxis     KEYWORD2<br />SetMeasurementMode   KEYWORD2<br />SetScale            KEYWORD2<br /><br />XAxis  KEYWORD2<br />YAxis  KEYWORD2<br />ZAxis  KEYWORD2<br /><br />#######################################<br /># Constants (LITERAL1)<br />#######################################<br /><br />Measurement_Continuous LITERAL1<br />Measurement_SingleShot LITERAL1</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"75ac1db50191a9aeb8efdbd6a9058a4cea62e72a\">  <p class=\"fileHead\">HMC5883L_Simple.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><span class=\"co2\">#include &lt;HMC5883L.h&gt;</span><br /><br />HMC5883L compass<span class=\"sy0\">;</span><br /><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span>9600<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> compass <span class=\"sy0\">=</span> HMC5883L<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//new instance of HMC5883L library</span><br /> setupHMC5883L<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//setup the HMC5883L</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Our main program loop.</span><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <br /> <span class=\"kw4\">float</span> heading <span class=\"sy0\">=</span> getHeading<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>heading<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>100<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//only here to slow down the serial print</span><br /><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> setupHMC5883L<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"co1\">//Setup the HMC5883L, and check for errors</span><br /> <span class=\"kw4\">int</span> error<span class=\"sy0\">;</span> <br /> error <span class=\"sy0\">=</span> compass.<span class=\"me1\">SetScale</span><span class=\"br0\">&#40;</span>1.3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//Set the scale of the compass.</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>error <span class=\"sy0\">!=</span> 0<span class=\"br0\">&#41;</span> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>compass.<span class=\"me1\">GetErrorText</span><span class=\"br0\">&#40;</span>error<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//check if there is an error, and print if so</span><br /><br /> error <span class=\"sy0\">=</span> compass.<span class=\"me1\">SetMeasurementMode</span><span class=\"br0\">&#40;</span>Measurement_Continuous<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Set the measurement mode to Continuous</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>error <span class=\"sy0\">!=</span> 0<span class=\"br0\">&#41;</span> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>compass.<span class=\"me1\">GetErrorText</span><span class=\"br0\">&#40;</span>error<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//check if there is an error, and print if so</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">float</span> getHeading<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"co1\">//Get the reading from the HMC5883L and calculate the heading</span><br /> MagnetometerScaled scaled <span class=\"sy0\">=</span> compass.<span class=\"me1\">ReadScaledAxis</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//scaled values from compass.</span><br /> <span class=\"kw4\">float</span> heading <span class=\"sy0\">=</span> atan2<span class=\"br0\">&#40;</span>scaled.<span class=\"me1\">YAxis</span><span class=\"sy0\">,</span> scaled.<span class=\"me1\">XAxis</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">// Correct for when signs are reversed.</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>heading <span class=\"sy0\">&lt;</span> 0<span class=\"br0\">&#41;</span> heading <span class=\"sy0\">+=</span> 2<span class=\"sy0\">*</span>PI<span class=\"sy0\">;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>heading <span class=\"sy0\">&gt;</span> 2<span class=\"sy0\">*</span>PI<span class=\"br0\">&#41;</span> heading <span class=\"sy0\">-=</span> 2<span class=\"sy0\">*</span>PI<span class=\"sy0\">;</span><br /><br /> <span class=\"kw1\">return</span> heading <span class=\"sy0\">*</span> RAD_TO_DEG<span class=\"sy0\">;</span> <span class=\"co1\">//radians to degrees</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"b132efea8543fe82d1fd16a19298a9840f395e17\">  <p class=\"fileHead\">License.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>Copyright (c) 2010 bildr community<br /><br />Permission is hereby granted, free of charge, to any person obtaining a copy<br />of this software and associated documentation files (the &quot;Software&quot;), to deal<br />in the Software without restriction, including without limitation the rights<br />to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br />copies of the Software, and to permit persons to whom the Software is<br />furnished to do so, subject to the following conditions:<br /><br />The above copyright notice and this permission notice shall be included in<br />all copies or substantial portions of the Software.<br /><br />THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br />AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br />LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br />OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br />THE SOFTWARE.</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper md\" id=\"fb141cf6f7c232cf0abddae7db1a5a4fd4a983e7\">  <p class=\"fileHead\">README.md</p>    <div class=\"fileCodeWrapper\">    <div class=\"code\">  <div class=\"markdown\"><h1>HMC5883L 3-axis compass</h1><p>Arduino code for the HMC5883L 3-axis compass</p><p>For complete hookup and tutorial see: <a href=\"http://adam-meyer.com/arduino/hmc5883l\">http://adam-meyer.com/arduino/hmc5883l</a></p><p>The code is provided under the MIT license please use, edit, change, and share. </p><p>The HMC5883L library has been modified for use with this example and is provided under the GPL license.</p><p><em>Before loading the HMC5883L example code, or even opening the arduino software, place the HMC5883L folder in your arduino library.</em></p><h5>ARDUINO LIBRARY LOCATION</h5><ul><li>On your Mac:: In (home directory)/Documents/Arduino/libraries  </li><li>On your PC:: My Documents -&gt; Arduino -&gt; libraries  </li><li>On your Linux box: (home directory)/sketchbook/libraries  </li></ul><p>For all my arduino articles: <a href=\"http://adam-meyer.com/arduino/\">http://adam-meyer.com/arduino/</a></p></div>  </div>  </div>  </div>    </div></div><div class=\"footer\">powered by <a title=\"github.com\" href=\"http://github.com\">github</a><!-- Served in 0.006803035736084 sec - loaded from cache: yes - limitLeft:  of  --!></div></div>');
new Embed("HMC5883L_sidebar", "HMC5883L_code", {"sha":"18b0634a53d04314fcadc327021934aed0d07718","url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/trees\/18b0634a53d04314fcadc327021934aed0d07718","tree":[{"path":"HMC5883L\/HMC5883L.cpp","mode":"100755","type":"blob","sha":"b4ff4e801ba2b7e5c956674a1c36f0791db83011","size":3157,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/b4ff4e801ba2b7e5c956674a1c36f0791db83011"},{"path":"HMC5883L\/HMC5883L.h","mode":"100755","type":"blob","sha":"917d2d4a09116dc1b09026d592a330bb316bee48","size":1959,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/917d2d4a09116dc1b09026d592a330bb316bee48"},{"path":"HMC5883L\/HMC5883L_Example\/HMC5883L_Example.ino","mode":"100755","type":"blob","sha":"c5224aabdd5a28a19b27fde13f5105b90023a650","size":4099,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/c5224aabdd5a28a19b27fde13f5105b90023a650"},{"path":"HMC5883L\/keywords.txt","mode":"100755","type":"blob","sha":"99bb7da315196d2af6014a3d6694608c1168705e","size":719,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/99bb7da315196d2af6014a3d6694608c1168705e"},{"path":"HMC5883L_Simple.ino","mode":"100755","type":"blob","sha":"75ac1db50191a9aeb8efdbd6a9058a4cea62e72a","size":1244,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/75ac1db50191a9aeb8efdbd6a9058a4cea62e72a"},{"path":"License.txt","mode":"100755","type":"blob","sha":"b132efea8543fe82d1fd16a19298a9840f395e17","size":1073,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/b132efea8543fe82d1fd16a19298a9840f395e17"},{"path":"README.md","mode":"100644","type":"blob","sha":"fb141cf6f7c232cf0abddae7db1a5a4fd4a983e7","size":744,"url":"https:\/\/api.github.com\/repos\/ameyer\/HMC5883L\/git\/blobs\/fb141cf6f7c232cf0abddae7db1a5a4fd4a983e7"}],"truncated":false})

<!-- Served in 0.007314920425415 sec - loaded from cache: yes - limitLeft:  of  --!>