document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');/*
---
script: Fx.Scroll.js
name: Fx.Scroll
description: Effect to smoothly scroll any element, including the window.
license: MIT-style license
authors:
  - Valerio Proietti
requires:
  - Core/Fx
  - Core/Element.Event
  - Core/Element.Dimensions
  - MooTools.More
provides: [Fx.Scroll]
...
*/

function GHE_isBody(element){
	return (/^(?:body|html)$/i).test(element.tagName);
}

Fx.Scroll = new Class({
	Extends: Fx,
	options: {
		offset: {x: 0, y: 0},
		wheelStops: true
	},
	initialize: function(element, options){
		this.element = this.subject = document.id(element);
		this.parent(options);
		if (typeOf(this.element) != 'element') this.element = document.id(this.element.getDocument().body);
		if (this.options.wheelStops){
			var stopper = this.element,
				cancel = this.cancel.pass(false, this);
			this.addEvent('start', function(){
				stopper.addEvent('mousewheel', cancel);
			}, true);
			this.addEvent('complete', function(){
				stopper.removeEvent('mousewheel', cancel);
			}, true);
		}
	},
	set: function(){
		var now = Array.flatten(arguments);
		if (Browser.firefox) now = [Math.round(now[0]), Math.round(now[1])]; // not needed anymore in newer firefox versions
		this.element.scrollTo(now[0], now[1]);
		return this;
	},
	compute: function(from, to, delta){
		return [0, 1].map(function(i){
			return Fx.compute(from[i], to[i], delta);
		});
	},
	start: function(x, y){
		if (!this.check(x, y)) return this;
		var scroll = this.element.getScroll();
		return this.parent([scroll.x, scroll.y], [x, y]);
	},
	calculateScroll: function(x, y){
		var element = this.element,
			scrollSize = element.getScrollSize(),
			scroll = element.getScroll(),
			size = element.getSize(),
			offset = this.options.offset,
			values = {x: x, y: y};
		for (var z in values){
			if (!values[z] && values[z] !== 0) values[z] = scroll[z];
			if (typeOf(values[z]) != 'number') values[z] = scrollSize[z] - size[z];
			values[z] += offset[z];
		}
		return [values.x, values.y];
	},
	toElement: function(el, axes){
		axes = axes ? Array.from(axes) : ['x', 'y'];
		var scroll = GHE_isBody(this.element) ? {x: 0, y: 0} : this.element.getScroll();
		var position = Object.map(document.id(el).getPosition(this.element), function(value, axis){
			return axes.contains(axis) ? value + scroll[axis] : false;
		});
		return this.start.apply(this, this.calculateScroll(position.x, position.y));
	}
});

var Embed = new Class({
	Implements: [Events],
	initialize: function(wrapper, codeWrapper, data){

		this.wrapper = document.id(wrapper);
		this.codeWrapper = document.id(codeWrapper);
		this.data = data;
		this.codeScroll = new Fx.Scroll(this.codeWrapper, {link: 'cancel'});
		this.files = [];
		this.rawTree = [];
		for (var i = 0; i < data.tree.length; i++) {
			var file = {};
			file.path = this.getPath(this.data.tree[i].path);
			file.mode = this.data.tree[i].mode;
			file.sha = this.data.tree[i].sha;
			file.url = this.data.tree[i].url;
			file.name = file.path.pop();
			file.extension = file.name.split('.').pop();
			file.type = (this.data.tree[i].type == "tree")? 'folder' : 'file';
			this.rawTree.push(file);
		}
		this.filelist = new GHE_Filelist(this.wrapper);
		//loop through files, and make structure.
		for (var i = 0; i < this.rawTree.length; i++) {
			var file = this.rawTree[i];
			var path = this.filelist;
			//find/create file path
			while(file.path.length > 0){
				var segment = file.path.shift();
				if(!path[segment]){
					path[segment] =  new GHE_Folder(path.fileHousing, file, segment);
				}
				path = path[segment];
			}
			if(file.type == 'file'){
				if(file.extension != 'gitignore' && file.extension != 'pdf'){
					path[file.name] = new GHE_File(path.fileHousing,file);
					path[file.name].addEvent('clicked', this.fileClicked.bind(this));
					this.files.push(path[file.name]);
				}
			}else{
				path[file.name] = new GHE_Folder(path.fileHousing,file);
			}
		}
		this.files[0].select();
		console.log(this.fileList);
	},
	fileClicked: function(file){
		for (var i = 0; i < this.files.length; i++) {
			this.files[i].unselect();
		}
		file.select();
		console.log(file);
		this.codeScroll.toElement(document.id(file.sha));
	},
	getPath: function(path){
		return path.split("/");
	}
});var GHE_Filelist = new Class({
	Implements: [Events],
	initialize: function(wrapper){
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'fileList'}).inject(this.wrapper);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.body);
		//console.log(this);
	},
});
var GHE_File = new Class({
	Implements: [Events],
	initialize: function(wrapper, data){
		this.data = data;
		this.name = data.name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'file'}).inject(this.wrapper);
			this.nameEl = new Element('div', {'class': 'name', html: this.data.name}).inject(this.body);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	select: function(){
		this.body.addClass('selected');
	},
	unselect: function(){
		this.body.removeClass('selected');
	}
});var GHE_Folder = new Class({
	Implements: [Events],
	initialize: function(wrapper, data, name){
		this.data = data;
		this.name = name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.folderWrapper = new Element('div', {'class': 'folderWrapper'}).inject(this.wrapper);
			this.body = new Element('div', {'class': 'folder'}).inject(this.folderWrapper);
				this.nameEl = new Element('div', {'class': 'name', html: this.name}).inject(this.body);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.folderWrapper);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	addFile: function(file){
		this.fileHousing.inject(file.body);
	}
});
document.write('<div class=\"githubEmbed_projectWrapper\"><div class=\"projectHeader\" ><span class=\"projectTitle\"><a title=\"github.com: ameyer/DS18B20\" href=\"http://github.com/ameyer/DS18B20\">DS18B20</a> </span><a class=\"downloadButton\" title=\"download prject from github\" href=\"https://github.com/ameyer/DS18B20/archive/master.zip\">download</a></div><div class=\"body\"><div class=\"sideBar\" id=\"DS18B20_sidebar\"></div><div class=\"projectCode\" id=\"DS18B20_code\">   <div class=\"fileWrapper ino\" id=\"d42b43368f44c7047c8759ca527d74dd14efffe7\">  <p class=\"fileHead\">DS18S20.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#include &lt;OneWire.h&gt; </span><br /><br /><span class=\"kw4\">int</span> DS18S20_Pin <span class=\"sy0\">=</span> <span class=\"nu0\">2</span><span class=\"sy0\">;</span> <span class=\"co1\">//DS18S20 Signal pin on digital 2</span><br /><br /><span class=\"co1\">//Temperature chip i/o</span><br />OneWire ds<span class=\"br0\">&#40;</span>DS18S20_Pin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// on digital pin 2</span><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span>9600<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">float</span> temperature <span class=\"sy0\">=</span> getTemp<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//will take about 750ms to run</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>temperature<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">float</span> getTemp<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"co1\">//returns the temperature from one DS18S20 in DEG Celsius</span><br /><br /> <span class=\"kw4\">byte</span> data<span class=\"br0\">&#91;</span>12<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">byte</span> addr<span class=\"br0\">&#91;</span>8<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> <span class=\"sy0\">!</span>ds.<span class=\"me1\">search</span><span class=\"br0\">&#40;</span>addr<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />   <span class=\"co1\">//no more sensors on chain, reset search</span><br />   ds.<span class=\"me1\">reset_search</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   <span class=\"kw1\">return</span> <span class=\"sy0\">-</span><span class=\"nu0\">1000</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">crc8</span><span class=\"br0\">&#40;</span> addr<span class=\"sy0\">,</span> 7<span class=\"br0\">&#41;</span> <span class=\"sy0\">!=</span> addr<span class=\"br0\">&#91;</span>7<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />   <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;CRC is not valid!&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   <span class=\"kw1\">return</span> <span class=\"sy0\">-</span><span class=\"nu0\">1000</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> addr<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">!=</span> 0x10 <span class=\"sy0\">&amp;&amp;</span> addr<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">!=</span> 0x28<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />   <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Device is not recognized&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   <span class=\"kw1\">return</span> <span class=\"sy0\">-</span><span class=\"nu0\">1000</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> ds.<span class=\"me1\">reset</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> ds.<span class=\"me1\">select</span><span class=\"br0\">&#40;</span>addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> ds.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>0x44<span class=\"sy0\">,</span>1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start conversion, with parasite power on at the end</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>750<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Wait for temperature conversion to complete</span><br /><br /> <span class=\"kw4\">byte</span> present <span class=\"sy0\">=</span> ds.<span class=\"me1\">reset</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> ds.<span class=\"me1\">select</span><span class=\"br0\">&#40;</span>addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> ds.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>0xBE<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Read Scratchpad</span><br /><br /> <br /> <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">9</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <span class=\"co1\">// we need 9 bytes</span><br />  data<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> ds.<span class=\"me1\">read</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> <br /> ds.<span class=\"me1\">reset_search</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"kw4\">byte</span> MSB <span class=\"sy0\">=</span> data<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">byte</span> LSB <span class=\"sy0\">=</span> data<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw4\">float</span> tempRead <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>MSB <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> LSB<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//using two\'s compliment</span><br /> <span class=\"kw4\">float</span> TemperatureSum <span class=\"sy0\">=</span> tempRead <span class=\"sy0\">/</span> <span class=\"nu0\">16</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"kw1\">return</span> TemperatureSum<span class=\"sy0\">;</span><br /> <br /><span class=\"br0\">&#125;</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"b132efea8543fe82d1fd16a19298a9840f395e17\">  <p class=\"fileHead\">License.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>Copyright (c) 2010 bildr community<br /><br />Permission is hereby granted, free of charge, to any person obtaining a copy<br />of this software and associated documentation files (the &quot;Software&quot;), to deal<br />in the Software without restriction, including without limitation the rights<br />to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br />copies of the Software, and to permit persons to whom the Software is<br />furnished to do so, subject to the following conditions:<br /><br />The above copyright notice and this permission notice shall be included in<br />all copies or substantial portions of the Software.<br /><br />THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br />AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br />LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br />OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br />THE SOFTWARE.</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper cpp\" id=\"31164fde811d793dc58e1f80119af46177453c1a\">  <p class=\"fileHead\">OneWire.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />335<br />336<br />337<br />338<br />339<br />340<br />341<br />342<br />343<br />344<br />345<br />346<br />347<br />348<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />Copyright (c) 2007, Jim Studt<br /><br />Updated to work with arduino-0008 and to include skip() as of<br />2007/07/06. --RJL20<br /><br />Permission is hereby granted, free of charge, to any person obtaining<br />a copy of this software and associated documentation files (the<br />&quot;Software&quot;), to deal in the Software without restriction, including<br />without limitation the rights to use, copy, modify, merge, publish,<br />distribute, sublicense, and/or sell copies of the Software, and to<br />permit persons to whom the Software is furnished to do so, subject to<br />the following conditions:<br /><br />The above copyright notice and this permission notice shall be<br />included in all copies or substantial portions of the Software.<br /><br />THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,<br />EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF<br />MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND<br />NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE<br />LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION<br />OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION<br />WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.<br /><br />Much of the code was inspired by Derek Yerger\'s code, though I don\'t<br />think much of that remains. In any event that was..<br />  (copyleft) 2006 by Derek Yerger - Free to distribute freely.<br /><br />The CRC code was excerpted and inspired by the Dallas Semiconductor <br />sample code bearing this copyright.<br />//---------------------------------------------------------------------------<br />// Copyright (C) 2000 Dallas Semiconductor Corporation, All Rights Reserved.<br />//<br />// Permission is hereby granted, free of charge, to any person obtaining a<br />// copy of this software and associated documentation files (the &quot;Software&quot;),<br />// to deal in the Software without restriction, including without limitation<br />// the rights to use, copy, modify, merge, publish, distribute, sublicense,<br />// and/or sell copies of the Software, and to permit persons to whom the<br />// Software is furnished to do so, subject to the following conditions:<br />//<br />// The above copyright notice and this permission notice shall be included<br />// in all copies or substantial portions of the Software.<br />//<br />// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS<br />// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF<br />// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.<br />// IN NO EVENT SHALL DALLAS SEMICONDUCTOR BE LIABLE FOR ANY CLAIM, DAMAGES<br />// OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,<br />// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR<br />// OTHER DEALINGS IN THE SOFTWARE.<br />//<br />// Except as contained in this notice, the name of Dallas Semiconductor<br />// shall not be used except as stated in the Dallas Semiconductor<br />// Branding Policy.<br />//--------------------------------------------------------------------------<br />*/</span><br /><br /><span class=\"co2\">#include &quot;OneWire.h&quot;</span><br /><br /><span class=\"kw2\">extern</span> <span class=\"st0\">&quot;C&quot;</span> <span class=\"br0\">&#123;</span><br /><br /><span class=\"co2\">#if (ARDUINO &gt;= 100)</span><br /><span class=\"co2\">#include &lt;Arduino.h&gt;</span><br /><span class=\"co2\">#else</span><br /><span class=\"co2\">#include &lt;WProgram.h&gt;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co2\">#include &lt;avr/io.h&gt;</span><br /><span class=\"co2\">#include &quot;pins_arduino.h&quot;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br />OneWire<span class=\"sy0\">::</span><span class=\"me2\">OneWire</span><span class=\"br0\">&#40;</span> uint8_t pinArg<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  pin <span class=\"sy0\">=</span> pinArg<span class=\"sy0\">;</span><br />  port <span class=\"sy0\">=</span> digitalPinToPort<span class=\"br0\">&#40;</span>pin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  bitmask <span class=\"sy0\">=</span> digitalPinToBitMask<span class=\"br0\">&#40;</span>pin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  outputReg <span class=\"sy0\">=</span> portOutputRegister<span class=\"br0\">&#40;</span>port<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  inputReg <span class=\"sy0\">=</span> portInputRegister<span class=\"br0\">&#40;</span>port<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  modeReg <span class=\"sy0\">=</span> portModeRegister<span class=\"br0\">&#40;</span>port<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#if ONEWIRE_SEARCH</span><br />  reset_search<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Perform the onewire reset function. We will wait up to 250uS for</span><br /><span class=\"co1\">// the bus to come high, if it doesn\'t then it is broken or shorted</span><br /><span class=\"co1\">// and we return a 0;</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Returns 1 if a device asserted a presence pulse, 0 otherwise.</span><br /><span class=\"co1\">//</span><br />uint8_t OneWire<span class=\"sy0\">::</span><span class=\"me2\">reset</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  uint8_t r<span class=\"sy0\">;</span><br />  uint8_t retries <span class=\"sy0\">=</span> <span class=\"nu0\">125</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// wait until the wire is high... just in case</span><br />  pinMode<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>INPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">do</span> <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> retries<span class=\"sy0\">--</span> <span class=\"sy0\">==</span> 0<span class=\"br0\">&#41;</span> <span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />    delayMicroseconds<span class=\"br0\">&#40;</span>2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br />  <span class=\"br0\">&#125;</span> <span class=\"kw1\">while</span><span class=\"br0\">&#40;</span> <span class=\"sy0\">!</span>digitalRead<span class=\"br0\">&#40;</span> pin<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  digitalWrite<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <span class=\"co1\">// pull low for 500uS</span><br />  pinMode<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>500<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  pinMode<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>INPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>65<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  r <span class=\"sy0\">=</span> <span class=\"sy0\">!</span>digitalRead<span class=\"br0\">&#40;</span>pin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>490<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">return</span> r<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Write a bit. Port and bit is used to cut lookup time and provide</span><br /><span class=\"co1\">// more certain timing.</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">write_bit</span><span class=\"br0\">&#40;</span>uint8_t v<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"kw4\">static</span> uint8_t lowTime<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#123;</span> 55<span class=\"sy0\">,</span> 5 <span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">static</span> uint8_t highTime<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#123;</span> 5<span class=\"sy0\">,</span> 55<span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br />  <br />  v <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>v<span class=\"sy0\">&amp;</span>1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"sy0\">*</span>modeReg <span class=\"sy0\">|=</span> bitmask<span class=\"sy0\">;</span> <span class=\"co1\">// make pin an output, do first since we</span><br />             <span class=\"co1\">// expect to be at 1</span><br />  <span class=\"sy0\">*</span>outputReg <span class=\"sy0\">&amp;=</span> ~bitmask<span class=\"sy0\">;</span> <span class=\"co1\">// zero</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>lowTime<span class=\"br0\">&#91;</span>v<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"sy0\">*</span>outputReg <span class=\"sy0\">|=</span> bitmask<span class=\"sy0\">;</span> <span class=\"co1\">// one, push pin up - important for</span><br />             <span class=\"co1\">// parasites, they might start in here</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>highTime<span class=\"br0\">&#91;</span>v<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Read a bit. Port and bit is used to cut lookup time and provide</span><br /><span class=\"co1\">// more certain timing.</span><br /><span class=\"co1\">//</span><br />uint8_t OneWire<span class=\"sy0\">::</span><span class=\"me2\">read_bit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  uint8_t r<span class=\"sy0\">;</span><br />  <br />  <span class=\"sy0\">*</span>modeReg <span class=\"sy0\">|=</span> bitmask<span class=\"sy0\">;</span>  <span class=\"co1\">// make pin an output, do first since we expect to be at 1</span><br />  <span class=\"sy0\">*</span>outputReg <span class=\"sy0\">&amp;=</span> ~bitmask<span class=\"sy0\">;</span> <span class=\"co1\">// zero</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"sy0\">*</span>modeReg <span class=\"sy0\">&amp;=</span> ~bitmask<span class=\"sy0\">;</span>   <span class=\"co1\">// let pin float, pull up will raise</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// A &quot;read slot&quot; is when 1mcs &gt; t &gt; 2mcs</span><br />  r <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span> <span class=\"sy0\">*</span>inputReg <span class=\"sy0\">&amp;</span> bitmask<span class=\"br0\">&#41;</span> <span class=\"sy0\">?</span> 1 <span class=\"sy0\">:</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> <span class=\"co1\">// check the bit</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>50<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>    <span class=\"co1\">// whole bit slot is 60-120uS, need to give some time</span><br />  <br />  <span class=\"kw1\">return</span> r<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Write a byte. The writing code uses the active drivers to raise the</span><br /><span class=\"co1\">// pin high, if you need power after the write (e.g. DS18S20 in</span><br /><span class=\"co1\">// parasite power mode) then set \'power\' to 1, otherwise the pin will</span><br /><span class=\"co1\">// go tri-state at the end of the write to avoid heating in a short or</span><br /><span class=\"co1\">// other mishap.</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">write</span><span class=\"br0\">&#40;</span>uint8_t v<span class=\"sy0\">,</span> uint8_t power<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  uint8_t bitMask<span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span>bitMask <span class=\"sy0\">=</span> <span class=\"nu12\">0x01</span><span class=\"sy0\">;</span> bitMask<span class=\"sy0\">;</span> bitMask <span class=\"sy0\">&lt;&lt;=</span> 1<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    OneWire<span class=\"sy0\">::</span><span class=\"me2\">write_bit</span><span class=\"br0\">&#40;</span> <span class=\"br0\">&#40;</span>bitMask <span class=\"sy0\">&amp;</span> v<span class=\"br0\">&#41;</span><span class=\"sy0\">?</span>1<span class=\"sy0\">:</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> <span class=\"sy0\">!</span>power<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    pinMode<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>INPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Read a byte</span><br /><span class=\"co1\">//</span><br />uint8_t OneWire<span class=\"sy0\">::</span><span class=\"me2\">read</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  uint8_t bitMask<span class=\"sy0\">;</span><br />  uint8_t r <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span>bitMask <span class=\"sy0\">=</span> <span class=\"nu12\">0x01</span><span class=\"sy0\">;</span> bitMask<span class=\"sy0\">;</span> bitMask <span class=\"sy0\">&lt;&lt;=</span> 1<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">read_bit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> r <span class=\"sy0\">|=</span> bitMask<span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">return</span> r<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Do a ROM select</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">select</span><span class=\"br0\">&#40;</span> uint8_t rom<span class=\"br0\">&#91;</span>8<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /><br />  write<span class=\"br0\">&#40;</span>0x55<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// Choose ROM</span><br /><br />  <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">8</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> write<span class=\"br0\">&#40;</span>rom<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Do a ROM skip</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">skip</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  write<span class=\"br0\">&#40;</span>0xCC<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// Skip ROM</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">depower</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  pinMode<span class=\"br0\">&#40;</span>pin<span class=\"sy0\">,</span>INPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co2\">#if ONEWIRE_SEARCH</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// You need to use this function to start a search again from the beginning.</span><br /><span class=\"co1\">// You do not need to do it for the first search, though you could.</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">void</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">reset_search</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  uint8_t i<span class=\"sy0\">;</span><br />  <br />  searchJunction <span class=\"sy0\">=</span> <span class=\"sy0\">-</span><span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  searchExhausted <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">7</span><span class=\"sy0\">;</span> <span class=\"sy0\">;</span> i<span class=\"sy0\">--</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    address<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">==</span> 0<span class=\"br0\">&#41;</span> <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Perform a search. If this function returns a \'1\' then it has</span><br /><span class=\"co1\">// enumerated the next device and you may retrieve the ROM from the</span><br /><span class=\"co1\">// OneWire::address variable. If there are no devices, no further</span><br /><span class=\"co1\">// devices, or something horrible happens in the middle of the</span><br /><span class=\"co1\">// enumeration then a 0 is returned. If a new device is found then</span><br /><span class=\"co1\">// its address is copied to newAddr. Use OneWire::reset_search() to</span><br /><span class=\"co1\">// start over.</span><br /><span class=\"co1\">// </span><br />uint8_t OneWire<span class=\"sy0\">::</span><span class=\"me2\">search</span><span class=\"br0\">&#40;</span>uint8_t <span class=\"sy0\">*</span>newAddr<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  uint8_t i<span class=\"sy0\">;</span><br />  <span class=\"kw4\">char</span> lastJunction <span class=\"sy0\">=</span> <span class=\"sy0\">-</span><span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  uint8_t done <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> searchExhausted<span class=\"br0\">&#41;</span> <span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> <span class=\"sy0\">!</span>reset<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  write<span class=\"br0\">&#40;</span> 0xf0<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">64</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    uint8_t a <span class=\"sy0\">=</span> read_bit<span class=\"br0\">&#40;</span> <span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    uint8_t nota <span class=\"sy0\">=</span> read_bit<span class=\"br0\">&#40;</span> <span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    uint8_t ibyte <span class=\"sy0\">=</span> i<span class=\"sy0\">/</span><span class=\"nu0\">8</span><span class=\"sy0\">;</span><br />    uint8_t ibit <span class=\"sy0\">=</span> 1<span class=\"sy0\">&lt;&lt;</span><span class=\"br0\">&#40;</span>i<span class=\"sy0\">&amp;</span>7<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> a <span class=\"sy0\">&amp;&amp;</span> nota<span class=\"br0\">&#41;</span> <span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> <span class=\"co1\">// I don\'t think this should happen, this means nothing responded, but maybe if</span><br />    <span class=\"co1\">// something vanishes during the search it will come up.</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> <span class=\"sy0\">!</span>a <span class=\"sy0\">&amp;&amp;</span> <span class=\"sy0\">!</span>nota<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />      <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">==</span> searchJunction<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <span class=\"co1\">// this is our time to decide differently, we went zero last time, go one.</span><br />        a <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />        searchJunction <span class=\"sy0\">=</span> lastJunction<span class=\"sy0\">;</span><br />      <span class=\"br0\">&#125;</span> <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">&lt;</span> searchJunction<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <span class=\"co1\">// take whatever we took last time, look in address</span><br />        <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> address<span class=\"br0\">&#91;</span> ibyte<span class=\"br0\">&#93;</span><span class=\"sy0\">&amp;</span>ibit<span class=\"br0\">&#41;</span> a <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />        <span class=\"kw1\">else</span> <span class=\"br0\">&#123;</span>              <span class=\"co1\">// Only 0s count as pending junctions, we\'ve already exhasuted the 0 side of 1s</span><br />          a <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />          done <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />          lastJunction <span class=\"sy0\">=</span> i<span class=\"sy0\">;</span><br />        <span class=\"br0\">&#125;</span><br />      <span class=\"br0\">&#125;</span> <span class=\"kw1\">else</span> <span class=\"br0\">&#123;</span>              <span class=\"co1\">// we are blazing new tree, take the 0</span><br />        a <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />        searchJunction <span class=\"sy0\">=</span> i<span class=\"sy0\">;</span><br />        done <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />      <span class=\"br0\">&#125;</span><br />      lastJunction <span class=\"sy0\">=</span> i<span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> a<span class=\"br0\">&#41;</span> address<span class=\"br0\">&#91;</span> ibyte<span class=\"br0\">&#93;</span> <span class=\"sy0\">|=</span> ibit<span class=\"sy0\">;</span><br />    <span class=\"kw1\">else</span> address<span class=\"br0\">&#91;</span> ibyte<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;=</span> ~ibit<span class=\"sy0\">;</span><br />    <br />    write_bit<span class=\"br0\">&#40;</span> a<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span> done<span class=\"br0\">&#41;</span> searchExhausted <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">8</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> newAddr<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> address<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">return</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co1\">// This table comes from Dallas sample code where it is freely reusable, though Copyright (C) 2000 Dallas Semiconductor Corporation</span><br /><span class=\"kw4\">static</span> uint8_t dscrc_table<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#123;</span><br />   0<span class=\"sy0\">,</span> 94<span class=\"sy0\">,</span>188<span class=\"sy0\">,</span>226<span class=\"sy0\">,</span> 97<span class=\"sy0\">,</span> 63<span class=\"sy0\">,</span>221<span class=\"sy0\">,</span>131<span class=\"sy0\">,</span>194<span class=\"sy0\">,</span>156<span class=\"sy0\">,</span>126<span class=\"sy0\">,</span> 32<span class=\"sy0\">,</span>163<span class=\"sy0\">,</span>253<span class=\"sy0\">,</span> 31<span class=\"sy0\">,</span> 65<span class=\"sy0\">,</span><br />  157<span class=\"sy0\">,</span>195<span class=\"sy0\">,</span> 33<span class=\"sy0\">,</span>127<span class=\"sy0\">,</span>252<span class=\"sy0\">,</span>162<span class=\"sy0\">,</span> 64<span class=\"sy0\">,</span> 30<span class=\"sy0\">,</span> 95<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span>227<span class=\"sy0\">,</span>189<span class=\"sy0\">,</span> 62<span class=\"sy0\">,</span> 96<span class=\"sy0\">,</span>130<span class=\"sy0\">,</span>220<span class=\"sy0\">,</span><br />  35<span class=\"sy0\">,</span>125<span class=\"sy0\">,</span>159<span class=\"sy0\">,</span>193<span class=\"sy0\">,</span> 66<span class=\"sy0\">,</span> 28<span class=\"sy0\">,</span>254<span class=\"sy0\">,</span>160<span class=\"sy0\">,</span>225<span class=\"sy0\">,</span>191<span class=\"sy0\">,</span> 93<span class=\"sy0\">,</span> 3<span class=\"sy0\">,</span>128<span class=\"sy0\">,</span>222<span class=\"sy0\">,</span> 60<span class=\"sy0\">,</span> 98<span class=\"sy0\">,</span><br />  190<span class=\"sy0\">,</span>224<span class=\"sy0\">,</span> 2<span class=\"sy0\">,</span> 92<span class=\"sy0\">,</span>223<span class=\"sy0\">,</span>129<span class=\"sy0\">,</span> 99<span class=\"sy0\">,</span> 61<span class=\"sy0\">,</span>124<span class=\"sy0\">,</span> 34<span class=\"sy0\">,</span>192<span class=\"sy0\">,</span>158<span class=\"sy0\">,</span> 29<span class=\"sy0\">,</span> 67<span class=\"sy0\">,</span>161<span class=\"sy0\">,</span>255<span class=\"sy0\">,</span><br />  70<span class=\"sy0\">,</span> 24<span class=\"sy0\">,</span>250<span class=\"sy0\">,</span>164<span class=\"sy0\">,</span> 39<span class=\"sy0\">,</span>121<span class=\"sy0\">,</span>155<span class=\"sy0\">,</span>197<span class=\"sy0\">,</span>132<span class=\"sy0\">,</span>218<span class=\"sy0\">,</span> 56<span class=\"sy0\">,</span>102<span class=\"sy0\">,</span>229<span class=\"sy0\">,</span>187<span class=\"sy0\">,</span> 89<span class=\"sy0\">,</span> 7<span class=\"sy0\">,</span><br />  219<span class=\"sy0\">,</span>133<span class=\"sy0\">,</span>103<span class=\"sy0\">,</span> 57<span class=\"sy0\">,</span>186<span class=\"sy0\">,</span>228<span class=\"sy0\">,</span> 6<span class=\"sy0\">,</span> 88<span class=\"sy0\">,</span> 25<span class=\"sy0\">,</span> 71<span class=\"sy0\">,</span>165<span class=\"sy0\">,</span>251<span class=\"sy0\">,</span>120<span class=\"sy0\">,</span> 38<span class=\"sy0\">,</span>196<span class=\"sy0\">,</span>154<span class=\"sy0\">,</span><br />  101<span class=\"sy0\">,</span> 59<span class=\"sy0\">,</span>217<span class=\"sy0\">,</span>135<span class=\"sy0\">,</span> 4<span class=\"sy0\">,</span> 90<span class=\"sy0\">,</span>184<span class=\"sy0\">,</span>230<span class=\"sy0\">,</span>167<span class=\"sy0\">,</span>249<span class=\"sy0\">,</span> 27<span class=\"sy0\">,</span> 69<span class=\"sy0\">,</span>198<span class=\"sy0\">,</span>152<span class=\"sy0\">,</span>122<span class=\"sy0\">,</span> 36<span class=\"sy0\">,</span><br />  248<span class=\"sy0\">,</span>166<span class=\"sy0\">,</span> 68<span class=\"sy0\">,</span> 26<span class=\"sy0\">,</span>153<span class=\"sy0\">,</span>199<span class=\"sy0\">,</span> 37<span class=\"sy0\">,</span>123<span class=\"sy0\">,</span> 58<span class=\"sy0\">,</span>100<span class=\"sy0\">,</span>134<span class=\"sy0\">,</span>216<span class=\"sy0\">,</span> 91<span class=\"sy0\">,</span> 5<span class=\"sy0\">,</span>231<span class=\"sy0\">,</span>185<span class=\"sy0\">,</span><br />  140<span class=\"sy0\">,</span>210<span class=\"sy0\">,</span> 48<span class=\"sy0\">,</span>110<span class=\"sy0\">,</span>237<span class=\"sy0\">,</span>179<span class=\"sy0\">,</span> 81<span class=\"sy0\">,</span> 15<span class=\"sy0\">,</span> 78<span class=\"sy0\">,</span> 16<span class=\"sy0\">,</span>242<span class=\"sy0\">,</span>172<span class=\"sy0\">,</span> 47<span class=\"sy0\">,</span>113<span class=\"sy0\">,</span>147<span class=\"sy0\">,</span>205<span class=\"sy0\">,</span><br />  17<span class=\"sy0\">,</span> 79<span class=\"sy0\">,</span>173<span class=\"sy0\">,</span>243<span class=\"sy0\">,</span>112<span class=\"sy0\">,</span> 46<span class=\"sy0\">,</span>204<span class=\"sy0\">,</span>146<span class=\"sy0\">,</span>211<span class=\"sy0\">,</span>141<span class=\"sy0\">,</span>111<span class=\"sy0\">,</span> 49<span class=\"sy0\">,</span>178<span class=\"sy0\">,</span>236<span class=\"sy0\">,</span> 14<span class=\"sy0\">,</span> 80<span class=\"sy0\">,</span><br />  175<span class=\"sy0\">,</span>241<span class=\"sy0\">,</span> 19<span class=\"sy0\">,</span> 77<span class=\"sy0\">,</span>206<span class=\"sy0\">,</span>144<span class=\"sy0\">,</span>114<span class=\"sy0\">,</span> 44<span class=\"sy0\">,</span>109<span class=\"sy0\">,</span> 51<span class=\"sy0\">,</span>209<span class=\"sy0\">,</span>143<span class=\"sy0\">,</span> 12<span class=\"sy0\">,</span> 82<span class=\"sy0\">,</span>176<span class=\"sy0\">,</span>238<span class=\"sy0\">,</span><br />  50<span class=\"sy0\">,</span>108<span class=\"sy0\">,</span>142<span class=\"sy0\">,</span>208<span class=\"sy0\">,</span> 83<span class=\"sy0\">,</span> 13<span class=\"sy0\">,</span>239<span class=\"sy0\">,</span>177<span class=\"sy0\">,</span>240<span class=\"sy0\">,</span>174<span class=\"sy0\">,</span> 76<span class=\"sy0\">,</span> 18<span class=\"sy0\">,</span>145<span class=\"sy0\">,</span>207<span class=\"sy0\">,</span> 45<span class=\"sy0\">,</span>115<span class=\"sy0\">,</span><br />  202<span class=\"sy0\">,</span>148<span class=\"sy0\">,</span>118<span class=\"sy0\">,</span> 40<span class=\"sy0\">,</span>171<span class=\"sy0\">,</span>245<span class=\"sy0\">,</span> 23<span class=\"sy0\">,</span> 73<span class=\"sy0\">,</span> 8<span class=\"sy0\">,</span> 86<span class=\"sy0\">,</span>180<span class=\"sy0\">,</span>234<span class=\"sy0\">,</span>105<span class=\"sy0\">,</span> 55<span class=\"sy0\">,</span>213<span class=\"sy0\">,</span>139<span class=\"sy0\">,</span><br />  87<span class=\"sy0\">,</span> 9<span class=\"sy0\">,</span>235<span class=\"sy0\">,</span>181<span class=\"sy0\">,</span> 54<span class=\"sy0\">,</span>104<span class=\"sy0\">,</span>138<span class=\"sy0\">,</span>212<span class=\"sy0\">,</span>149<span class=\"sy0\">,</span>203<span class=\"sy0\">,</span> 41<span class=\"sy0\">,</span>119<span class=\"sy0\">,</span>244<span class=\"sy0\">,</span>170<span class=\"sy0\">,</span> 72<span class=\"sy0\">,</span> 22<span class=\"sy0\">,</span><br />  233<span class=\"sy0\">,</span>183<span class=\"sy0\">,</span> 85<span class=\"sy0\">,</span> 11<span class=\"sy0\">,</span>136<span class=\"sy0\">,</span>214<span class=\"sy0\">,</span> 52<span class=\"sy0\">,</span>106<span class=\"sy0\">,</span> 43<span class=\"sy0\">,</span>117<span class=\"sy0\">,</span>151<span class=\"sy0\">,</span>201<span class=\"sy0\">,</span> 74<span class=\"sy0\">,</span> 20<span class=\"sy0\">,</span>246<span class=\"sy0\">,</span>168<span class=\"sy0\">,</span><br />  116<span class=\"sy0\">,</span> 42<span class=\"sy0\">,</span>200<span class=\"sy0\">,</span>150<span class=\"sy0\">,</span> 21<span class=\"sy0\">,</span> 75<span class=\"sy0\">,</span>169<span class=\"sy0\">,</span>247<span class=\"sy0\">,</span>182<span class=\"sy0\">,</span>232<span class=\"sy0\">,</span> 10<span class=\"sy0\">,</span> 84<span class=\"sy0\">,</span>215<span class=\"sy0\">,</span>137<span class=\"sy0\">,</span>107<span class=\"sy0\">,</span> 53<span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Compute a Dallas Semiconductor 8 bit CRC. These show up in the ROM</span><br /><span class=\"co1\">// and the registers. (note: this might better be done without to</span><br /><span class=\"co1\">// table, it would probably be smaller and certainly fast enough</span><br /><span class=\"co1\">// compared to all those delayMicrosecond() calls. But I got</span><br /><span class=\"co1\">// confused, so I use this table from the examples.) </span><br /><span class=\"co1\">//</span><br />uint8_t OneWire<span class=\"sy0\">::</span><span class=\"me2\">crc8</span><span class=\"br0\">&#40;</span> uint8_t <span class=\"sy0\">*</span>addr<span class=\"sy0\">,</span> uint8_t len<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  uint8_t i<span class=\"sy0\">;</span><br />  uint8_t crc <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> len<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    crc <span class=\"sy0\">=</span> dscrc_table<span class=\"br0\">&#91;</span> crc <span class=\"sy0\">^</span> addr<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">return</span> crc<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co2\">#if ONEWIRE_CRC16</span><br /><span class=\"kw4\">static</span> <span class=\"kw4\">short</span> oddparity<span class=\"br0\">&#91;</span>16<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#123;</span> 0<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> 0 <span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Compute a Dallas Semiconductor 16 bit CRC. I have never seen one of</span><br /><span class=\"co1\">// these, but here it is.</span><br /><span class=\"co1\">//</span><br /><span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> OneWire<span class=\"sy0\">::</span><span class=\"me2\">crc16</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> <span class=\"sy0\">*</span>data<span class=\"sy0\">,</span> <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> len<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> i<span class=\"sy0\">;</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> crc <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> len<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> cdata <span class=\"sy0\">=</span> data<span class=\"br0\">&#91;</span>len<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />    <br />    cdata <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>cdata <span class=\"sy0\">^</span> <span class=\"br0\">&#40;</span>crc <span class=\"sy0\">&amp;</span> 0xff<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span> <span class=\"nu12\">0xff</span><span class=\"sy0\">;</span><br />    crc <span class=\"sy0\">&gt;&gt;=</span> <span class=\"nu0\">8</span><span class=\"sy0\">;</span><br />    <br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>oddparity<span class=\"br0\">&#91;</span>cdata <span class=\"sy0\">&amp;</span> 0xf<span class=\"br0\">&#93;</span> <span class=\"sy0\">^</span> oddparity<span class=\"br0\">&#91;</span>cdata <span class=\"sy0\">&gt;&gt;</span> 4<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> crc <span class=\"sy0\">^=</span> <span class=\"nu12\">0xc001</span><span class=\"sy0\">;</span><br />    <br />    cdata <span class=\"sy0\">&lt;&lt;=</span> <span class=\"nu0\">6</span><span class=\"sy0\">;</span><br />    crc <span class=\"sy0\">^=</span> cdata<span class=\"sy0\">;</span><br />    cdata <span class=\"sy0\">&lt;&lt;=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />    crc <span class=\"sy0\">^=</span> cdata<span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">return</span> crc<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"co2\">#endif</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"2e41d34c5824505b742de80e375c4fe92a3ce211\">  <p class=\"fileHead\">OneWire.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#ifndef OneWire_h</span><br /><span class=\"co2\">#define OneWire_h</span><br /><br /><span class=\"co2\">#if (ARDUINO &gt;= 100)</span><br /><span class=\"co2\">#include &lt;Arduino.h&gt;</span><br /><span class=\"co2\">#else</span><br /><span class=\"co2\">#include &lt;WProgram.h&gt;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co2\">#include &lt;inttypes.h&gt;</span><br /><br /><span class=\"co1\">// you can exclude onewire_search by defining that to 0</span><br /><span class=\"co2\">#ifndef ONEWIRE_SEARCH</span><br /><span class=\"co2\">#define ONEWIRE_SEARCH 1</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co1\">// You can exclude onewire_crc16 by defining that to 0</span><br /><span class=\"co2\">#ifndef ONEWIRE_CRC16</span><br /><span class=\"co2\">#define ONEWIRE_CRC16 0</span><br /><span class=\"co2\">#endif</span><br /><br />class OneWire<br /><span class=\"br0\">&#123;</span><br /> private<span class=\"sy0\">:</span><br /><span class=\"co2\">#if ONEWIRE_SEARCH</span><br />  uint8_t address<span class=\"br0\">&#91;</span>8<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">char</span> searchJunction<span class=\"sy0\">;</span><br />  uint8_t searchExhausted<span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span><br />  uint8_t pin<span class=\"sy0\">;</span><br />  uint8_t port<span class=\"sy0\">;</span><br />  uint8_t bitmask<span class=\"sy0\">;</span><br />  <span class=\"kw4\">volatile</span> uint8_t <span class=\"sy0\">*</span>outputReg<span class=\"sy0\">;</span><br />  <span class=\"kw4\">volatile</span> uint8_t <span class=\"sy0\">*</span>inputReg<span class=\"sy0\">;</span><br />  <span class=\"kw4\">volatile</span> uint8_t <span class=\"sy0\">*</span>modeReg<span class=\"sy0\">;</span><br /><br /> public<span class=\"sy0\">:</span><br />  OneWire<span class=\"br0\">&#40;</span> uint8_t pin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"co1\">// Perform a 1-Wire reset cycle. Returns 1 if a device responds</span><br />  <span class=\"co1\">// with a presence pulse. Returns 0 if there is no device or the</span><br />  <span class=\"co1\">// bus is shorted or otherwise held low for more than 250uS</span><br />  uint8_t reset<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Issue a 1-Wire rom select command, you do the reset first.</span><br />  <span class=\"kw4\">void</span> select<span class=\"br0\">&#40;</span> uint8_t rom<span class=\"br0\">&#91;</span>8<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Issue a 1-Wire rom skip command, to address all on bus.</span><br />  <span class=\"kw4\">void</span> skip<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Write a byte. If \'power\' is one then the wire is held high at</span><br />  <span class=\"co1\">// the end for parasitically powered devices. You are responsible</span><br />  <span class=\"co1\">// for eventually depowering it by calling depower() or doing</span><br />  <span class=\"co1\">// another read or write.</span><br />  <span class=\"kw4\">void</span> write<span class=\"br0\">&#40;</span> uint8_t v<span class=\"sy0\">,</span> uint8_t power <span class=\"sy0\">=</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Read a byte.</span><br />  uint8_t read<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Write a bit. The bus is always left powered at the end, see</span><br />  <span class=\"co1\">// note in write() about that.</span><br />  <span class=\"kw4\">void</span> write_bit<span class=\"br0\">&#40;</span> uint8_t v<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Read a bit.</span><br />  uint8_t read_bit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Stop forcing power onto the bus. You only need to do this if</span><br />  <span class=\"co1\">// you used the \'power\' flag to write() or used a write_bit() call</span><br />  <span class=\"co1\">// and aren\'t about to do another read or write. You would rather</span><br />  <span class=\"co1\">// not leave this powered if you don\'t have to, just in case</span><br />  <span class=\"co1\">// someone shorts your bus.</span><br />  <span class=\"kw4\">void</span> depower<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co2\">#if ONEWIRE_SEARCH</span><br />  <span class=\"co1\">// Clear the search state so that if will start from the beginning again.</span><br />  <span class=\"kw4\">void</span> reset_search<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// Look for the next device. Returns 1 if a new address has been</span><br />  <span class=\"co1\">// returned. A zero might mean that the bus is shorted, there are</span><br />  <span class=\"co1\">// no devices, or you have already retrieved all of them. It</span><br />  <span class=\"co1\">// might be a good idea to check the CRC to make sure you didn\'t</span><br />  <span class=\"co1\">// get garbage. The order is deterministic. You will always get</span><br />  <span class=\"co1\">// the same devices in the same order.</span><br />  uint8_t search<span class=\"br0\">&#40;</span>uint8_t <span class=\"sy0\">*</span>newAddr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span><br /><br />  <span class=\"co1\">// Compute a Dallas Semiconductor 8 bit CRC, these are used in the</span><br />  <span class=\"co1\">// ROM and scratchpad registers.</span><br />  <span class=\"kw4\">static</span> uint8_t crc8<span class=\"br0\">&#40;</span> uint8_t <span class=\"sy0\">*</span>addr<span class=\"sy0\">,</span> uint8_t len<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#if ONEWIRE_CRC16</span><br />  <span class=\"co1\">// Compute a Dallas Semiconductor 16 bit CRC. Maybe. I don\'t have</span><br />  <span class=\"co1\">// any devices that use this so this might be wrong. I just copied</span><br />  <span class=\"co1\">// it from their sample code.</span><br />  <span class=\"kw4\">static</span> <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> crc16<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> <span class=\"sy0\">*</span>data<span class=\"sy0\">,</span> <span class=\"kw4\">unsigned</span> <span class=\"kw4\">short</span> len<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co2\">#endif</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"17a60e66c8ba9d0e35fa742d272346a68cbef245\">  <p class=\"fileHead\">keywords.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>#######################################<br /># Syntax Coloring Map For OneWire<br />#######################################<br /><br />#######################################<br /># Datatypes (KEYWORD1)<br />#######################################<br /><br />OneWire KEYWORD1<br /><br />#######################################<br /># Methods and Functions (KEYWORD2)<br />#######################################<br /><br />reset  KEYWORD2<br />write_bit    KEYWORD2<br />read_bit    KEYWORD2<br />write  KEYWORD2<br />read  KEYWORD2<br />select KEYWORD2<br />skip  KEYWORD2<br />depower KEYWORD2<br />reset_search  KEYWORD2<br />search KEYWORD2<br />crc8  KEYWORD2<br />crc16  KEYWORD2<br /><br />#######################################<br /># Instances (KEYWORD2)<br />#######################################<br /><br /><br />#######################################<br /># Constants (LITERAL1)<br />#######################################</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"73e246614d063d126d0f2c90d51cc53550c03af7\">  <p class=\"fileHead\">readme.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>See:<br />  http://www.arduino.cc/playground/Learning/OneWire<br />  http://www.federated.com/~jim/onewire/<br /><br />The version of the OneWire library at federated.com works with arduino-0007.<br />The version here works with arduino-0008, 1.0+ thanks to the very helpful Jim Studt.<br /><br />To use, make a new directory: arduino-0008/lib/targets/libraries/OneWire/<br />and put OneWire.cpp, OneWire.h and keywords.txt in it.<br /><br />--Josh Larios<br />hades (at) elsewhere (dot) org<br />2007/07/06</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper md\" id=\"d381711b56dc6776d9c4be2caf78decb204bbb9a\">  <p class=\"fileHead\">README.md</p>    <div class=\"fileCodeWrapper\">    <div class=\"code\">  <div class=\"markdown\"><h1>DS18B20 One-Wire Thermometer</h1><p>Arduino code for the DS18B20 one-wire thermometer</p><p>For complete hookup and tutorial see: <a href=\"http://adam-meyer.com/arduino/ds18b20\">http://adam-meyer.com/arduino/ds18b20</a></p><p>The code is provided under the MIT license please use, edit, change, and share. </p><p><em>Before loading the DS18S20 code, or even opening the arduino software, place the OneWire folder in your arduino library.</em></p><h5>ARDUINO LIBRARY LOCATION</h5><ul><li>On your Mac:: In (home directory)/Documents/Arduino/libraries  </li><li>On your PC:: My Documents -&gt; Arduino -&gt; libraries  </li><li>On your Linux box: (home directory)/sketchbook/libraries  </li></ul><p>For all my arduino articles: <a href=\"http://adam-meyer.com/arduino/\">http://adam-meyer.com/arduino/</a></p></div>  </div>  </div>  </div>    </div></div><div class=\"footer\">powered by <a title=\"github.com\" href=\"http://github.com\">github</a><!-- Served in 0.0047719478607178 sec - loaded from cache: yes - limitLeft:  of  --!></div></div>');
new Embed("DS18B20_sidebar", "DS18B20_code", {"sha":"5ea1afcfc9af9df6af7c947fd136ff3b70f03dc7","url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/trees\/5ea1afcfc9af9df6af7c947fd136ff3b70f03dc7","tree":[{"path":"DS18S20.ino","mode":"100644","type":"blob","sha":"d42b43368f44c7047c8759ca527d74dd14efffe7","size":1334,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/d42b43368f44c7047c8759ca527d74dd14efffe7"},{"path":"License.txt","mode":"100644","type":"blob","sha":"b132efea8543fe82d1fd16a19298a9840f395e17","size":1073,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/b132efea8543fe82d1fd16a19298a9840f395e17"},{"path":"OneWire\/OneWire.cpp","mode":"100644","type":"blob","sha":"31164fde811d793dc58e1f80119af46177453c1a","size":10833,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/31164fde811d793dc58e1f80119af46177453c1a"},{"path":"OneWire\/OneWire.h","mode":"100644","type":"blob","sha":"2e41d34c5824505b742de80e375c4fe92a3ce211","size":2924,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/2e41d34c5824505b742de80e375c4fe92a3ce211"},{"path":"OneWire\/keywords.txt","mode":"100644","type":"blob","sha":"17a60e66c8ba9d0e35fa742d272346a68cbef245","size":756,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/17a60e66c8ba9d0e35fa742d272346a68cbef245"},{"path":"OneWire\/readme.txt","mode":"100644","type":"blob","sha":"73e246614d063d126d0f2c90d51cc53550c03af7","size":451,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/73e246614d063d126d0f2c90d51cc53550c03af7"},{"path":"README.md","mode":"100644","type":"blob","sha":"d381711b56dc6776d9c4be2caf78decb204bbb9a","size":638,"url":"https:\/\/api.github.com\/repos\/ameyer\/DS18B20\/git\/blobs\/d381711b56dc6776d9c4be2caf78decb204bbb9a"}],"truncated":false})

<!-- Served in 0.0053689479827881 sec - loaded from cache: yes - limitLeft:  of  --!>