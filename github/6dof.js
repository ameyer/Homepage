document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');/*
---
script: Fx.Scroll.js
name: Fx.Scroll
description: Effect to smoothly scroll any element, including the window.
license: MIT-style license
authors:
  - Valerio Proietti
requires:
  - Core/Fx
  - Core/Element.Event
  - Core/Element.Dimensions
  - MooTools.More
provides: [Fx.Scroll]
...
*/

function GHE_isBody(element){
	return (/^(?:body|html)$/i).test(element.tagName);
}

Fx.Scroll = new Class({
	Extends: Fx,
	options: {
		offset: {x: 0, y: 0},
		wheelStops: true
	},
	initialize: function(element, options){
		this.element = this.subject = document.id(element);
		this.parent(options);
		if (typeOf(this.element) != 'element') this.element = document.id(this.element.getDocument().body);
		if (this.options.wheelStops){
			var stopper = this.element,
				cancel = this.cancel.pass(false, this);
			this.addEvent('start', function(){
				stopper.addEvent('mousewheel', cancel);
			}, true);
			this.addEvent('complete', function(){
				stopper.removeEvent('mousewheel', cancel);
			}, true);
		}
	},
	set: function(){
		var now = Array.flatten(arguments);
		if (Browser.firefox) now = [Math.round(now[0]), Math.round(now[1])]; // not needed anymore in newer firefox versions
		this.element.scrollTo(now[0], now[1]);
		return this;
	},
	compute: function(from, to, delta){
		return [0, 1].map(function(i){
			return Fx.compute(from[i], to[i], delta);
		});
	},
	start: function(x, y){
		if (!this.check(x, y)) return this;
		var scroll = this.element.getScroll();
		return this.parent([scroll.x, scroll.y], [x, y]);
	},
	calculateScroll: function(x, y){
		var element = this.element,
			scrollSize = element.getScrollSize(),
			scroll = element.getScroll(),
			size = element.getSize(),
			offset = this.options.offset,
			values = {x: x, y: y};
		for (var z in values){
			if (!values[z] && values[z] !== 0) values[z] = scroll[z];
			if (typeOf(values[z]) != 'number') values[z] = scrollSize[z] - size[z];
			values[z] += offset[z];
		}
		return [values.x, values.y];
	},
	toElement: function(el, axes){
		axes = axes ? Array.from(axes) : ['x', 'y'];
		var scroll = GHE_isBody(this.element) ? {x: 0, y: 0} : this.element.getScroll();
		var position = Object.map(document.id(el).getPosition(this.element), function(value, axis){
			return axes.contains(axis) ? value + scroll[axis] : false;
		});
		return this.start.apply(this, this.calculateScroll(position.x, position.y));
	}
});

var Embed = new Class({
	Implements: [Events],
	initialize: function(wrapper, codeWrapper, data){

		this.wrapper = document.id(wrapper);
		this.codeWrapper = document.id(codeWrapper);
		this.data = data;
		this.codeScroll = new Fx.Scroll(this.codeWrapper, {link: 'cancel'});
		this.files = [];
		this.rawTree = [];
		for (var i = 0; i < data.tree.length; i++) {
			var file = {};
			file.path = this.getPath(this.data.tree[i].path);
			file.mode = this.data.tree[i].mode;
			file.sha = this.data.tree[i].sha;
			file.url = this.data.tree[i].url;
			file.name = file.path.pop();
			file.extension = file.name.split('.').pop();
			file.type = (this.data.tree[i].type == "tree")? 'folder' : 'file';
			this.rawTree.push(file);
		}
		this.filelist = new GHE_Filelist(this.wrapper);
		//loop through files, and make structure.
		for (var i = 0; i < this.rawTree.length; i++) {
			var file = this.rawTree[i];
			var path = this.filelist;
			//find/create file path
			while(file.path.length > 0){
				var segment = file.path.shift();
				if(!path[segment]){
					path[segment] =  new GHE_Folder(path.fileHousing, file, segment);
				}
				path = path[segment];
			}
			if(file.type == 'file'){
				if(file.extension != 'gitignore' && file.extension != 'pdf'){
					path[file.name] = new GHE_File(path.fileHousing,file);
					path[file.name].addEvent('clicked', this.fileClicked.bind(this));
					this.files.push(path[file.name]);
				}
			}else{
				path[file.name] = new GHE_Folder(path.fileHousing,file);
			}
		}
		this.files[0].select();
		console.log(this.fileList);
	},
	fileClicked: function(file){
		for (var i = 0; i < this.files.length; i++) {
			this.files[i].unselect();
		}
		file.select();
		console.log(file);
		this.codeScroll.toElement(document.id(file.sha));
	},
	getPath: function(path){
		return path.split("/");
	}
});var GHE_Filelist = new Class({
	Implements: [Events],
	initialize: function(wrapper){
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'fileList'}).inject(this.wrapper);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.body);
		//console.log(this);
	},
});
var GHE_File = new Class({
	Implements: [Events],
	initialize: function(wrapper, data){
		this.data = data;
		this.name = data.name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'file'}).inject(this.wrapper);
			this.nameEl = new Element('div', {'class': 'name', html: this.data.name}).inject(this.body);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	select: function(){
		this.body.addClass('selected');
	},
	unselect: function(){
		this.body.removeClass('selected');
	}
});var GHE_Folder = new Class({
	Implements: [Events],
	initialize: function(wrapper, data, name){
		this.data = data;
		this.name = name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.folderWrapper = new Element('div', {'class': 'folderWrapper'}).inject(this.wrapper);
			this.body = new Element('div', {'class': 'folder'}).inject(this.folderWrapper);
				this.nameEl = new Element('div', {'class': 'name', html: this.name}).inject(this.body);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.folderWrapper);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	addFile: function(file){
		this.fileHousing.inject(file.body);
	}
});
document.write('<div class=\"githubEmbed_projectWrapper\"><div class=\"projectHeader\" ><span class=\"projectTitle\"><a title=\"github.com: ameyer/6dof\" href=\"http://github.com/ameyer/6dof\">6dof</a> </span><a class=\"downloadButton\" title=\"download prject from github\" href=\"https://github.com/ameyer/6dof/archive/master.zip\">download</a></div><div class=\"body\"><div class=\"sideBar\" id=\"6dof_sidebar\"></div><div class=\"projectCode\" id=\"6dof_code\">   <div class=\"fileWrapper cpp\" id=\"315018db7e2cb723a91e39a66e90b05a951fcb71\">  <p class=\"fileHead\">CommunicationUtils.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#include &quot;CommunicationUtils.h&quot;</span><br /><br /><span class=\"kw4\">void</span> serialPrintFloatArr<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> arr<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> length<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> i<span class=\"sy0\">=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&lt;</span>length<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  serialFloatPrint<span class=\"br0\">&#40;</span>arr<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;,&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> serialFloatPrint<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> f<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte <span class=\"sy0\">*</span> b <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>byte <span class=\"sy0\">*</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span>f<span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> i<span class=\"sy0\">=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&lt;</span><span class=\"nu0\">4</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <br />  byte b1 <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>b<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">&gt;&gt;</span> 4<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span> <span class=\"nu12\">0x0f</span><span class=\"sy0\">;</span><br />  byte b2 <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>b<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> 0x0f<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw4\">char</span> c1 <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>b1 <span class=\"sy0\">&lt;</span> <span class=\"nu0\">10</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">?</span> <span class=\"br0\">&#40;</span><span class=\"st0\">\'0\'</span> <span class=\"sy0\">+</span> b1<span class=\"br0\">&#41;</span> <span class=\"sy0\">:</span> <span class=\"st0\">\'A\'</span> <span class=\"sy0\">+</span> b1 <span class=\"sy0\">-</span> <span class=\"nu0\">10</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">char</span> c2 <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>b2 <span class=\"sy0\">&lt;</span> <span class=\"nu0\">10</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">?</span> <span class=\"br0\">&#40;</span><span class=\"st0\">\'0\'</span> <span class=\"sy0\">+</span> b2<span class=\"br0\">&#41;</span> <span class=\"sy0\">:</span> <span class=\"st0\">\'A\'</span> <span class=\"sy0\">+</span> b2 <span class=\"sy0\">-</span> <span class=\"nu0\">10</span><span class=\"sy0\">;</span><br />  <br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>c1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>c2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> writeArr<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"sy0\">*</span> varr<span class=\"sy0\">,</span> uint8_t arr_length<span class=\"sy0\">,</span> uint8_t type_bytes<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte <span class=\"sy0\">*</span> arr <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>byte<span class=\"sy0\">*</span><span class=\"br0\">&#41;</span> varr<span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>uint8_t i<span class=\"sy0\">=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&lt;</span>arr_length<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  writeVar<span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>arr<span class=\"br0\">&#91;</span>i <span class=\"sy0\">*</span> type_bytes<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> type_bytes<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"co1\">// thanks to Francesco Ferrara and the Simplo project for the following code!</span><br /><span class=\"kw4\">void</span> writeVar<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"sy0\">*</span> val<span class=\"sy0\">,</span> uint8_t type_bytes<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte <span class=\"sy0\">*</span> addr<span class=\"sy0\">=</span><span class=\"br0\">&#40;</span>byte <span class=\"sy0\">*</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span>val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>uint8_t i<span class=\"sy0\">=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&lt;</span>type_bytes<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br />  Serial.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>addr<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"a58fdf5c11051f7133794e60c2f053656f1a85fa\">  <p class=\"fileHead\">CommunicationUtils.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#ifndef CommunitationUtils_h</span><br /><span class=\"co2\">#define CommunitationUtils_h</span><br /><br /><span class=\"co2\">#include &quot;Arduino.h&quot;</span><br /><br /><span class=\"kw4\">void</span> serialPrintFloatArr<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> arr<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> length<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"kw4\">void</span> serialFloatPrint<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> f<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"kw4\">void</span> writeArr<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"sy0\">*</span> arr<span class=\"sy0\">,</span> uint8_t arr_length<span class=\"sy0\">,</span> uint8_t type_bytes<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"kw4\">void</span> writeVar<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"sy0\">*</span> val<span class=\"sy0\">,</span> uint8_t type_bytes<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><br /><span class=\"co2\">#endif // CommunitationUtils_h</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"c7d1b38c44e07cc9d609181dff4b6952a7163d15\">  <p class=\"fileHead\">DebugUtils.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />DebugUtils.h - Simple debugging utilities.<br />Copyright (C) 2011 Fabio Varesano &lt;fabio at varesano dot net&gt;<br /><br />Ideas taken from:<br />http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1271517197<br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span class=\"co2\">#ifndef DEBUGUTILS_H</span><br /><span class=\"co2\">#define DEBUGUTILS_H</span><br /><br /><span class=\"co2\">#ifdef DEBUG_V</span><br /> <span class=\"co2\">#include &lt;WProgram.h&gt;</span><br /> <span class=\"co2\">#define DEBUG_PRINT(str)  \\<br />  Serial.print(millis());   \\<br />  Serial.print(&quot;: &quot;);  \\<br />  Serial.print(__PRETTY_FUNCTION__); \\<br />  Serial.print(\' \');   \\<br />  Serial.print(__FILE__);   \\<br />  Serial.print(\':\');   \\<br />  Serial.print(__LINE__);   \\<br />  Serial.print(\' \');   \\<br />  Serial.println(str);</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co2\">#ifdef DEBUG</span><br /> <span class=\"co2\">#define DEBUG_PRINT(str) \\<br />  Serial.println(str);</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co2\">#ifndef DEBUG_PRINT</span><br /> <span class=\"co2\">#define DEBUG_PRINT(str)</span><br /><span class=\"co2\">#endif</span><br /><br /><br /><span class=\"co2\">#endif //DEBUGUTILS_H</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper cpp\" id=\"e61585105cfa006bb8903cebd8082a7f5702da6f\">  <p class=\"fileHead\">FIMU_ADXL345.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />335<br />336<br />337<br />338<br />339<br />340<br />341<br />342<br />343<br />344<br />345<br />346<br />347<br />348<br />349<br />350<br />351<br />352<br />353<br />354<br />355<br />356<br />357<br />358<br />359<br />360<br />361<br />362<br />363<br />364<br />365<br />366<br />367<br />368<br />369<br />370<br />371<br />372<br />373<br />374<br />375<br />376<br />377<br />378<br />379<br />380<br />381<br />382<br />383<br />384<br />385<br />386<br />387<br />388<br />389<br />390<br />391<br />392<br />393<br />394<br />395<br />396<br />397<br />398<br />399<br />400<br />401<br />402<br />403<br />404<br />405<br />406<br />407<br />408<br />409<br />410<br />411<br />412<br />413<br />414<br />415<br />416<br />417<br />418<br />419<br />420<br />421<br />422<br />423<br />424<br />425<br />426<br />427<br />428<br />429<br />430<br />431<br />432<br />433<br />434<br />435<br />436<br />437<br />438<br />439<br />440<br />441<br />442<br />443<br />444<br />445<br />446<br />447<br />448<br />449<br />450<br />451<br />452<br />453<br />454<br />455<br />456<br />457<br />458<br />459<br />460<br />461<br />462<br />463<br />464<br />465<br />466<br />467<br />468<br />469<br />470<br />471<br />472<br />473<br />474<br />475<br />476<br />477<br />478<br />479<br />480<br />481<br />482<br />483<br />484<br />485<br />486<br />487<br />488<br />489<br />490<br />491<br />492<br />493<br />494<br />495<br />496<br />497<br />498<br />499<br />500<br />501<br />502<br />503<br />504<br />505<br />506<br />507<br />508<br />509<br />510<br />511<br />512<br />513<br />514<br />515<br />516<br />517<br />518<br />519<br />520<br />521<br />522<br />523<br />524<br />525<br />526<br />527<br />528<br />529<br />530<br />531<br />532<br />533<br />534<br />535<br />536<br />537<br />538<br />539<br />540<br />541<br />542<br />543<br />544<br />545<br />546<br />547<br />548<br />549<br />550<br />551<br />552<br />553<br />554<br />555<br />556<br />557<br />558<br />559<br />560<br />561<br />562<br />563<br />564<br />565<br />566<br />567<br />568<br />569<br />570<br />571<br />572<br />573<br />574<br />575<br />576<br />577<br />578<br />579<br />580<br />581<br />582<br />583<br />584<br />585<br />586<br />587<br />588<br />589<br />590<br />591<br />592<br />593<br />594<br />595<br />596<br />597<br />598<br />599<br />600<br />601<br />602<br />603<br />604<br />605<br />606<br />607<br />608<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/**************************************************************************<br />*                                     *<br />* ADXL345 Driver for Arduino                       *<br />*                                     *<br />***************************************************************************<br />*                                     * <br />* This program is free software; you can redistribute it and/or modify  *<br />* it under the terms of the GNU License.                 *<br />* This program is distributed in the hope that it will be useful,     *<br />* but WITHOUT ANY WARRANTY; without even the implied warranty of     *<br />* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the      *<br />* GNU License V2 for more details.                    *<br />*                                     *<br />***************************************************************************/</span><br /><br /><span class=\"co2\">#include &quot;FIMU_ADXL345.h&quot;</span><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><br /><span class=\"co2\">#define TO_READ (6)   // num of bytes we are going to read each time (two bytes for each axis)</span><br /><br />ADXL345<span class=\"sy0\">::</span><span class=\"me2\">ADXL345</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> status <span class=\"sy0\">=</span> ADXL345_OK<span class=\"sy0\">;</span><br /> error_code <span class=\"sy0\">=</span> ADXL345_NO_ERROR<span class=\"sy0\">;</span><br /><br /> gains<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"nu16\">0.00376390</span><span class=\"sy0\">;</span><br /> gains<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"nu16\">0.00376009</span><span class=\"sy0\">;</span><br /> gains<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"nu16\">0.00349265</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> _dev_address <span class=\"sy0\">=</span> address<span class=\"sy0\">;</span><br /> powerOn<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">powerOn</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"co1\">//Turning on the ADXL345</span><br /> <span class=\"co1\">//writeTo(ADXL345_POWER_CTL, 0);   </span><br /> <span class=\"co1\">//writeTo(ADXL345_POWER_CTL, 16);</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_POWER_CTL<span class=\"sy0\">,</span> 8<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Reads the acceleration into an array of three places</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">readAccel</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>xyz<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> readAccel<span class=\"br0\">&#40;</span>xyz<span class=\"sy0\">,</span> xyz <span class=\"sy0\">+</span> 1<span class=\"sy0\">,</span> xyz <span class=\"sy0\">+</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Reads the acceleration into three variable x, y and z</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">readAccel</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>z<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_DATAX0<span class=\"sy0\">,</span> TO_READ<span class=\"sy0\">,</span> _buff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//read the acceleration data from the ADXL345</span><br /><br /> <span class=\"co1\">// each axis reading comes in 10 bit resolution, ie 2 bytes. Least Significat Byte first!!</span><br /> <span class=\"co1\">// thus we are converting both bytes in to one int</span><br /> <span class=\"sy0\">*</span>x <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"br0\">&#41;</span>_buff<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <br /> <span class=\"sy0\">*</span>y <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"br0\">&#41;</span>_buff<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>z <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"br0\">&#41;</span>_buff<span class=\"br0\">&#91;</span>5<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">get_Gxyz</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>xyz<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> xyz_int<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> readAccel<span class=\"br0\">&#40;</span>xyz_int<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>i<span class=\"sy0\">=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&lt;</span><span class=\"nu0\">3</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  xyz<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> xyz_int<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> gains<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Writes val to address register on device</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">writeTo</span><span class=\"br0\">&#40;</span>byte address<span class=\"sy0\">,</span> byte val<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start transmission to device</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>       <span class=\"co1\">// send register address</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>         <span class=\"co1\">// send value to write</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// end transmission</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Reads num bytes starting from address register on device in to _buff array</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">readFrom</span><span class=\"br0\">&#40;</span>byte address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> num<span class=\"sy0\">,</span> byte _buff<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start transmission to device</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>       <span class=\"co1\">// sends address to read from</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// end transmission</span><br /><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start transmission to device</span><br /> Wire.<span class=\"me1\">requestFrom</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"sy0\">,</span> num<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <span class=\"co1\">// request 6 bytes from device</span><br /><br /> <span class=\"kw4\">int</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">while</span><span class=\"br0\">&#40;</span>Wire.<span class=\"me1\">available</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span>     <span class=\"co1\">// device may send less than requested (abnormal)</span><br /> <span class=\"br0\">&#123;</span><br />  _buff<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> Wire.<span class=\"me1\">read</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <span class=\"co1\">// receive a byte</span><br />  i<span class=\"sy0\">++;</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>i <span class=\"sy0\">!=</span> num<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  status <span class=\"sy0\">=</span> ADXL345_ERROR<span class=\"sy0\">;</span><br />  error_code <span class=\"sy0\">=</span> ADXL345_READ_ERROR<span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <span class=\"co1\">// end transmission</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the range setting and return it into rangeSetting</span><br /><span class=\"co1\">// it can be 2, 4, 8 or 16</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getRangeSetting</span><span class=\"br0\">&#40;</span>byte<span class=\"sy0\">*</span> rangeSetting<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>rangeSetting <span class=\"sy0\">=</span> _b <span class=\"sy0\">&amp;</span> B00000011<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the range setting, possible values are: 2, 4, 8, 16</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setRangeSetting</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> val<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _s<span class=\"sy0\">;</span><br /> byte _b<span class=\"sy0\">;</span><br /><br /> <span class=\"kw1\">switch</span> <span class=\"br0\">&#40;</span>val<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">case</span> 2<span class=\"sy0\">:</span> <br />  _s <span class=\"sy0\">=</span> B00000000<span class=\"sy0\">;</span><br />  <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">case</span> 4<span class=\"sy0\">:</span> <br />  _s <span class=\"sy0\">=</span> B00000001<span class=\"sy0\">;</span><br />  <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">case</span> 8<span class=\"sy0\">:</span> <br />  _s <span class=\"sy0\">=</span> B00000010<span class=\"sy0\">;</span><br />  <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">case</span> 16<span class=\"sy0\">:</span><br />  _s <span class=\"sy0\">=</span> B00000011<span class=\"sy0\">;</span><br />  <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">default</span><span class=\"sy0\">:</span><br />  _s <span class=\"sy0\">=</span> B00000000<span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> _s <span class=\"sy0\">|=</span> <span class=\"br0\">&#40;</span>_b <span class=\"sy0\">&amp;</span> B11101100<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> _s<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"co1\">// gets the state of the SELF_TEST bit</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getSelfTestBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 7<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the SELF-TEST bit</span><br /><span class=\"co1\">// if set to 1 it applies a self-test force to the sensor causing a shift in the output data</span><br /><span class=\"co1\">// if set to 0 it disables the self-test force</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setSelfTestBit</span><span class=\"br0\">&#40;</span>bool selfTestBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 7<span class=\"sy0\">,</span> selfTestBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the state of the SPI bit</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getSpiBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 6<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the SPI bit</span><br /><span class=\"co1\">// if set to 1 it sets the device to 3-wire mode</span><br /><span class=\"co1\">// if set to 0 it sets the device to 4-wire SPI mode</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setSpiBit</span><span class=\"br0\">&#40;</span>bool spiBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 6<span class=\"sy0\">,</span> spiBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the state of the INT_INVERT bit</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getInterruptLevelBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the INT_INVERT bit</span><br /><span class=\"co1\">// if set to 0 sets the interrupts to active high</span><br /><span class=\"co1\">// if set to 1 sets the interrupts to active low</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInterruptLevelBit</span><span class=\"br0\">&#40;</span>bool interruptLevelBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 5<span class=\"sy0\">,</span> interruptLevelBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the state of the FULL_RES bit</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getFullResBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the FULL_RES bit</span><br /><span class=\"co1\">// if set to 1, the device is in full resolution mode, where the output resolution increases with the</span><br /><span class=\"co1\">//  g range set by the range bits to maintain a 4mg/LSB scal factor</span><br /><span class=\"co1\">// if set to 0, the device is in 10-bit mode, and the range buts determine the maximum g range</span><br /><span class=\"co1\">//  and scale factor</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setFullResBit</span><span class=\"br0\">&#40;</span>bool fullResBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 3<span class=\"sy0\">,</span> fullResBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the state of the justify bit</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getJustifyBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the JUSTIFY bit</span><br /><span class=\"co1\">// if sets to 1 selects the left justified mode</span><br /><span class=\"co1\">// if sets to 0 selects right justified mode with sign extension</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setJustifyBit</span><span class=\"br0\">&#40;</span>bool justifyBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_DATA_FORMAT<span class=\"sy0\">,</span> 2<span class=\"sy0\">,</span> justifyBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the THRESH_TAP byte value</span><br /><span class=\"co1\">// it should be between 0 and 255</span><br /><span class=\"co1\">// the scale factor is 62.5 mg/LSB</span><br /><span class=\"co1\">// A value of 0 may result in undesirable behavior</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTapThreshold</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> tapThreshold<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> tapThreshold <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>tapThreshold<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>tapThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_THRESH_TAP<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the THRESH_TAP byte value</span><br /><span class=\"co1\">// return value is comprised between 0 and 255</span><br /><span class=\"co1\">// the scale factor is 62.5 mg/LSB</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getTapThreshold</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_THRESH_TAP<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// set/get the gain for each axis in Gs / count</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setAxisGains</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_gains<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">3</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  gains<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _gains<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getAxisGains</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_gains<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"nu0\">3</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  _gains<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> gains<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"co1\">// Sets the OFSX, OFSY and OFSZ bytes</span><br /><span class=\"co1\">// OFSX, OFSY and OFSZ are user offset adjustments in twos complement format with</span><br /><span class=\"co1\">// a scale factor of 15,6mg/LSB</span><br /><span class=\"co1\">// OFSX, OFSY and OFSZ should be comprised between</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setAxisOffset</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> z<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_OFSX<span class=\"sy0\">,</span> byte <span class=\"br0\">&#40;</span>x<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_OFSY<span class=\"sy0\">,</span> byte <span class=\"br0\">&#40;</span>y<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_OFSZ<span class=\"sy0\">,</span> byte <span class=\"br0\">&#40;</span>z<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the OFSX, OFSY and OFSZ bytes</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getAxisOffset</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"sy0\">*</span> x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span> y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span>z<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_OFSX<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"sy0\">*</span>x <span class=\"sy0\">=</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_OFSY<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"sy0\">*</span>y <span class=\"sy0\">=</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_OFSZ<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"sy0\">*</span>z <span class=\"sy0\">=</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the DUR byte</span><br /><span class=\"co1\">// The DUR byte contains an unsigned time value representing the maximum time</span><br /><span class=\"co1\">// that an event must be above THRESH_TAP threshold to qualify as a tap event</span><br /><span class=\"co1\">// The scale factor is 625s/LSB</span><br /><span class=\"co1\">// A value of 0 disables the tap/float tap funcitons. Max value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTapDuration</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> tapDuration<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> tapDuration <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>tapDuration<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>tapDuration<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_DUR<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the DUR byte</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getTapDuration</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_DUR<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the latency (latent register) which contains an unsigned time value</span><br /><span class=\"co1\">// representing the wait time from the detection of a tap event to the start</span><br /><span class=\"co1\">// of the time window, during which a possible second tap can be detected.</span><br /><span class=\"co1\">// The scale factor is 1.25ms/LSB. A value of 0 disables the float tap function.</span><br /><span class=\"co1\">// It accepts a maximum value of 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setDoubleTapLatency</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> floatTapLatency<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>floatTapLatency<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_LATENT<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the Latent value</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getDoubleTapLatency</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_LATENT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the Window register, which contains an unsigned time value representing</span><br /><span class=\"co1\">// the amount of time after the expiration of the latency time (Latent register)</span><br /><span class=\"co1\">// during which a second valud tap can begin. The scale factor is 1.25ms/LSB. A</span><br /><span class=\"co1\">// value of 0 disables the float tap function. The maximum value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setDoubleTapWindow</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> floatTapWindow<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> floatTapWindow <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>floatTapWindow<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>floatTapWindow<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_WINDOW<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the Window register</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getDoubleTapWindow</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_WINDOW<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the THRESH_ACT byte which holds the threshold value for detecting activity.</span><br /><span class=\"co1\">// The data format is unsigned, so the magnitude of the activity event is compared</span><br /><span class=\"co1\">// with the value is compared with the value in the THRESH_ACT register. The scale</span><br /><span class=\"co1\">// factor is 62.5mg/LSB. A value of 0 may result in undesirable behavior if the</span><br /><span class=\"co1\">// activity interrupt is enabled. The maximum value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setActivityThreshold</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> activityThreshold<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> activityThreshold <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>activityThreshold<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>activityThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_THRESH_ACT<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the THRESH_ACT byte</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getActivityThreshold</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_THRESH_ACT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the THRESH_INACT byte which holds the threshold value for detecting inactivity.</span><br /><span class=\"co1\">// The data format is unsigned, so the magnitude of the inactivity event is compared</span><br /><span class=\"co1\">// with the value is compared with the value in the THRESH_INACT register. The scale</span><br /><span class=\"co1\">// factor is 62.5mg/LSB. A value of 0 may result in undesirable behavior if the</span><br /><span class=\"co1\">// inactivity interrupt is enabled. The maximum value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInactivityThreshold</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> inactivityThreshold<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> inactivityThreshold <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>inactivityThreshold<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>inactivityThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_THRESH_INACT<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the THRESH_INACT byte</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getInactivityThreshold</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_THRESH_INACT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the TIME_INACT register, which contains an unsigned time value representing the</span><br /><span class=\"co1\">// amount of time that acceleration must be less thant the value in the THRESH_INACT</span><br /><span class=\"co1\">// register for inactivity to be declared. The scale factor is 1sec/LSB. The value must</span><br /><span class=\"co1\">// be between 0 and 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTimeInactivity</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> timeInactivity<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> timeInactivity <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>timeInactivity<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>timeInactivity<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_TIME_INACT<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the TIME_INACT register</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getTimeInactivity</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_TIME_INACT<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the THRESH_FF register which holds the threshold value, in an unsigned format, for</span><br /><span class=\"co1\">// free-fall detection. The root-sum-square (RSS) value of all axes is calculated and</span><br /><span class=\"co1\">// compared whith the value in THRESH_FF to determine if a free-fall event occured. The</span><br /><span class=\"co1\">// scale factor is 62.5mg/LSB. A value of 0 may result in undesirable behavior if the free-fall</span><br /><span class=\"co1\">// interrupt is enabled. The maximum value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setFreeFallThreshold</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> freeFallThreshold<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> freeFallThreshold <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>freeFallThreshold<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>freeFallThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_THRESH_FF<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the THRESH_FF register.</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getFreeFallThreshold</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_THRESH_FF<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Sets the TIME_FF register, which holds an unsigned time value representing the minimum</span><br /><span class=\"co1\">// time that the RSS value of all axes must be less than THRESH_FF to generate a free-fall</span><br /><span class=\"co1\">// interrupt. The scale factor is 5ms/LSB. A value of 0 may result in undesirable behavior if</span><br /><span class=\"co1\">// the free-fall interrupt is enabled. The maximum value is 255.</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setFreeFallDuration</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> freeFallDuration<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> freeFallDuration <span class=\"sy0\">=</span> min<span class=\"br0\">&#40;</span>max<span class=\"br0\">&#40;</span>freeFallDuration<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">,</span>255<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> byte _b <span class=\"sy0\">=</span> byte <span class=\"br0\">&#40;</span>freeFallDuration<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writeTo<span class=\"br0\">&#40;</span>ADXL345_TIME_FF<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Gets the TIME_FF register.</span><br /><span class=\"kw4\">int</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getFreeFallDuration</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_TIME_FF<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">return</span> <span class=\"kw4\">int</span> <span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivityXEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 6<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivityYEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivityZEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isInactivityXEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isInactivityYEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isInactivityZEnabled</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setActivityX</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 6<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setActivityY</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 5<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setActivityZ</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 4<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInactivityX</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 2<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInactivityY</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInactivityZ</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivityAc</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 7<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isInactivityAc</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setActivityAc</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 7<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInactivityAc</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_INACT_CTL<span class=\"sy0\">,</span> 3<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getSuppressBit</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setSuppressBit</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 3<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapDetectionOnX</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTapDetectionOnX</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 2<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapDetectionOnY</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTapDetectionOnY</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapDetectionOnZ</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setTapDetectionOnZ</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_TAP_AXES<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivitySourceOnX</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 6<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivitySourceOnY</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isActivitySourceOnZ</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapSourceOnX</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapSourceOnY</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isTapSourceOnZ</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isAsleep</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_ACT_TAP_STATUS<span class=\"sy0\">,</span> 3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isLowPower</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setLowPower</span><span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> 4<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">float</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getRate</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> _b <span class=\"sy0\">&amp;=</span> B00001111<span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>pow<span class=\"br0\">&#40;</span>2<span class=\"sy0\">,</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"br0\">&#41;</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">-</span>6<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> <span class=\"nu16\">6.25</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setRate</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> rate<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">,</span>_s<span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> v <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#40;</span>rate <span class=\"sy0\">/</span> 6.25<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> r <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">while</span> <span class=\"br0\">&#40;</span>v <span class=\"sy0\">&gt;&gt;=</span> 1<span class=\"br0\">&#41;</span><br /> <span class=\"br0\">&#123;</span><br />  r<span class=\"sy0\">++;</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>r <span class=\"sy0\">&lt;=</span> 9<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  readFrom<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  _s <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span>byte<span class=\"br0\">&#41;</span> <span class=\"br0\">&#40;</span>r <span class=\"sy0\">+</span> 6<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> <span class=\"br0\">&#40;</span>_b <span class=\"sy0\">&amp;</span> B11110000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  writeTo<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> _s<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">set_bw</span><span class=\"br0\">&#40;</span>byte bw_code<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>bw_code <span class=\"sy0\">&lt;</span> ADXL345_BW_3<span class=\"br0\">&#41;</span> <span class=\"sy0\">||</span> <span class=\"br0\">&#40;</span>bw_code <span class=\"sy0\">&gt;</span> ADXL345_BW_1600<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  status <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  error_code <span class=\"sy0\">=</span> ADXL345_BAD_ARG<span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw1\">else</span><span class=\"br0\">&#123;</span><br />  writeTo<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> bw_code<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br />byte ADXL345<span class=\"sy0\">::</span><span class=\"me2\">get_bw_code</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> byte bw_code<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_BW_RATE<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>bw_code<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> bw_code<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />byte ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getInterruptSource</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>ADXL345_INT_SOURCE<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> _b<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getInterruptSource</span><span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_INT_SOURCE<span class=\"sy0\">,</span>interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getInterruptMapping</span><span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_INT_MAP<span class=\"sy0\">,</span>interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Set the mapping of an interrupt to pin1 or pin2</span><br /><span class=\"co1\">// eg: setInterruptMapping(ADXL345_INT_DOUBLE_TAP_BIT,ADXL345_INT2_PIN);</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInterruptMapping</span><span class=\"br0\">&#40;</span>byte interruptBit<span class=\"sy0\">,</span> bool interruptPin<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_INT_MAP<span class=\"sy0\">,</span> interruptBit<span class=\"sy0\">,</span> interruptPin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">isInterruptEnabled</span><span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">return</span> getRegisterBit<span class=\"br0\">&#40;</span>ADXL345_INT_ENABLE<span class=\"sy0\">,</span>interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setInterrupt</span><span class=\"br0\">&#40;</span>byte interruptBit<span class=\"sy0\">,</span> bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setRegisterBit<span class=\"br0\">&#40;</span>ADXL345_INT_ENABLE<span class=\"sy0\">,</span> interruptBit<span class=\"sy0\">,</span> state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">setRegisterBit</span><span class=\"br0\">&#40;</span>byte regAdress<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> bitPos<span class=\"sy0\">,</span> bool state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>regAdress<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>state<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  _b <span class=\"sy0\">|=</span> <span class=\"br0\">&#40;</span>1 <span class=\"sy0\">&lt;&lt;</span> bitPos<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// forces nth bit of _b to be 1. all other bits left alone.</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw1\">else</span> <span class=\"br0\">&#123;</span><br />  _b <span class=\"sy0\">&amp;=</span> ~<span class=\"br0\">&#40;</span>1 <span class=\"sy0\">&lt;&lt;</span> bitPos<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// forces nth bit of _b to be 0. all other bits left alone.</span><br /> <span class=\"br0\">&#125;</span><br /> writeTo<span class=\"br0\">&#40;</span>regAdress<span class=\"sy0\">,</span> _b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ADXL345<span class=\"sy0\">::</span><span class=\"me2\">getRegisterBit</span><span class=\"br0\">&#40;</span>byte regAdress<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> bitPos<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>regAdress<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_b <span class=\"sy0\">&gt;&gt;</span> bitPos<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span> 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// print all register value to the serial ouptut, which requires it to be setup</span><br /><span class=\"co1\">// this can be used to manually to check the current configuration of the device</span><br /><span class=\"kw4\">void</span> ADXL345<span class=\"sy0\">::</span><span class=\"me2\">printAllRegister</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> byte _b<span class=\"sy0\">;</span><br /> Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;0x00: &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> readFrom<span class=\"br0\">&#40;</span>0x00<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> print_byte<span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Serial.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span>i<span class=\"sy0\">=</span><span class=\"nu0\">29</span><span class=\"sy0\">;</span>i<span class=\"sy0\">&lt;=</span><span class=\"nu0\">57</span><span class=\"sy0\">;</span>i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;0x&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>i<span class=\"sy0\">,</span> HEX<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;: &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  readFrom<span class=\"br0\">&#40;</span>i<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  print_byte<span class=\"br0\">&#40;</span>_b<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  Serial.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> print_byte<span class=\"br0\">&#40;</span>byte val<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br /> Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;B&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">for</span><span class=\"br0\">&#40;</span>i<span class=\"sy0\">=</span><span class=\"nu0\">7</span><span class=\"sy0\">;</span> i<span class=\"sy0\">&gt;=</span><span class=\"nu0\">0</span><span class=\"sy0\">;</span> i<span class=\"sy0\">--</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  Serial.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>val <span class=\"sy0\">&gt;&gt;</span> i <span class=\"sy0\">&amp;</span> 1<span class=\"sy0\">,</span> BIN<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"6dd8aff419621ebb1f8baed1f12a8f07ecedc563\">  <p class=\"fileHead\">FIMU_ADXL345.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/**************************************************************************<br />*                                     *<br />* ADXL345 Driver for Arduino                       *<br />*                                     *<br />***************************************************************************<br />*                                     * <br />* This program is free software; you can redistribute it and/or modify  *<br />* it under the terms of the GNU License.                 *<br />* This program is distributed in the hope that it will be useful,     *<br />* but WITHOUT ANY WARRANTY; without even the implied warranty of     *<br />* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the      *<br />* GNU License V2 for more details.                    *<br />*                                     *<br />***************************************************************************/</span><br /><span class=\"co2\">#include &quot;Arduino.h&quot;</span><br /><br /><span class=\"co2\">#ifndef FIMU_ADXL345_h</span><br /><span class=\"co2\">#define FIMU_ADXL345_h</span><br /><br /><span class=\"coMULTI\">/* -- ADXL345 addresses --*/</span><br /><span class=\"co2\">#define ADXL345_ADDR_ALT_HIGH 0x1D // ADXL345 address when ALT is connected to HIGH</span><br /><span class=\"co2\">#define ADXL345_ADDR_ALT_LOW 0x53 // ADXL345 address when ALT is connected to LOW</span><br /><br /><span class=\"coMULTI\">/* ------- Register names ------- */</span><br /><span class=\"co2\">#define ADXL345_DEVID 0x00</span><br /><span class=\"co2\">#define ADXL345_RESERVED1 0x01</span><br /><span class=\"co2\">#define ADXL345_THRESH_TAP 0x1d</span><br /><span class=\"co2\">#define ADXL345_OFSX 0x1e</span><br /><span class=\"co2\">#define ADXL345_OFSY 0x1f</span><br /><span class=\"co2\">#define ADXL345_OFSZ 0x20</span><br /><span class=\"co2\">#define ADXL345_DUR 0x21</span><br /><span class=\"co2\">#define ADXL345_LATENT 0x22</span><br /><span class=\"co2\">#define ADXL345_WINDOW 0x23</span><br /><span class=\"co2\">#define ADXL345_THRESH_ACT 0x24</span><br /><span class=\"co2\">#define ADXL345_THRESH_INACT 0x25</span><br /><span class=\"co2\">#define ADXL345_TIME_INACT 0x26</span><br /><span class=\"co2\">#define ADXL345_ACT_INACT_CTL 0x27</span><br /><span class=\"co2\">#define ADXL345_THRESH_FF 0x28</span><br /><span class=\"co2\">#define ADXL345_TIME_FF 0x29</span><br /><span class=\"co2\">#define ADXL345_TAP_AXES 0x2a</span><br /><span class=\"co2\">#define ADXL345_ACT_TAP_STATUS 0x2b</span><br /><span class=\"co2\">#define ADXL345_BW_RATE 0x2c</span><br /><span class=\"co2\">#define ADXL345_POWER_CTL 0x2d</span><br /><span class=\"co2\">#define ADXL345_INT_ENABLE 0x2e</span><br /><span class=\"co2\">#define ADXL345_INT_MAP 0x2f</span><br /><span class=\"co2\">#define ADXL345_INT_SOURCE 0x30</span><br /><span class=\"co2\">#define ADXL345_DATA_FORMAT 0x31</span><br /><span class=\"co2\">#define ADXL345_DATAX0 0x32</span><br /><span class=\"co2\">#define ADXL345_DATAX1 0x33</span><br /><span class=\"co2\">#define ADXL345_DATAY0 0x34</span><br /><span class=\"co2\">#define ADXL345_DATAY1 0x35</span><br /><span class=\"co2\">#define ADXL345_DATAZ0 0x36</span><br /><span class=\"co2\">#define ADXL345_DATAZ1 0x37</span><br /><span class=\"co2\">#define ADXL345_FIFO_CTL 0x38</span><br /><span class=\"co2\">#define ADXL345_FIFO_STATUS 0x39</span><br /><br /><span class=\"co2\">#define ADXL345_BW_1600 0xF // 1111</span><br /><span class=\"co2\">#define ADXL345_BW_800 0xE // 1110</span><br /><span class=\"co2\">#define ADXL345_BW_400 0xD // 1101 </span><br /><span class=\"co2\">#define ADXL345_BW_200 0xC // 1100</span><br /><span class=\"co2\">#define ADXL345_BW_100 0xB // 1011 </span><br /><span class=\"co2\">#define ADXL345_BW_50  0xA // 1010 </span><br /><span class=\"co2\">#define ADXL345_BW_25  0x9 // 1001 </span><br /><span class=\"co2\">#define ADXL345_BW_12  0x8 // 1000 </span><br /><span class=\"co2\">#define ADXL345_BW_6  0x7 // 0111</span><br /><span class=\"co2\">#define ADXL345_BW_3  0x6 // 0110</span><br /><br /><br /><span class=\"coMULTI\">/* <br />Interrupt PINs<br />INT1: 0<br />INT2: 1<br />*/</span><br /><span class=\"co2\">#define ADXL345_INT1_PIN 0x00</span><br /><span class=\"co2\">#define ADXL345_INT2_PIN 0x01</span><br /><br /><span class=\"coMULTI\">/* <br />Interrupt bit position<br />*/</span><br /><span class=\"co2\">#define ADXL345_INT_DATA_READY_BIT 0x07</span><br /><span class=\"co2\">#define ADXL345_INT_SINGLE_TAP_BIT 0x06</span><br /><span class=\"co2\">#define ADXL345_INT_DOUBLE_TAP_BIT 0x05</span><br /><span class=\"co2\">#define ADXL345_INT_ACTIVITY_BIT  0x04</span><br /><span class=\"co2\">#define ADXL345_INT_INACTIVITY_BIT 0x03</span><br /><span class=\"co2\">#define ADXL345_INT_FREE_FALL_BIT 0x02</span><br /><span class=\"co2\">#define ADXL345_INT_WATERMARK_BIT 0x01</span><br /><span class=\"co2\">#define ADXL345_INT_OVERRUNY_BIT  0x00</span><br /><br /><span class=\"co2\">#define ADXL345_OK  1 // no error</span><br /><span class=\"co2\">#define ADXL345_ERROR 0 // indicates error is predent</span><br /><br /><span class=\"co2\">#define ADXL345_NO_ERROR  0 // initial state</span><br /><span class=\"co2\">#define ADXL345_READ_ERROR 1 // problem reading accel</span><br /><span class=\"co2\">#define ADXL345_BAD_ARG  2 // bad method argument</span><br /><br />class ADXL345<br /><span class=\"br0\">&#123;</span><br />public<span class=\"sy0\">:</span><br /> bool status<span class=\"sy0\">;</span>      <span class=\"co1\">// set when error occurs </span><br />            <span class=\"co1\">// see error code for details</span><br /> byte error_code<span class=\"sy0\">;</span>    <span class=\"co1\">// Initial state</span><br /> <span class=\"kw4\">float</span> gains<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span>    <span class=\"co1\">// counts to Gs</span><br /><br /> ADXL345<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> powerOn<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readAccel<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"sy0\">*</span> xyx<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readAccel<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"sy0\">*</span> x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span> y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span> z<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> get_Gxyz<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>xyz<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw4\">void</span> setTapThreshold<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> tapThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getTapThreshold<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setAxisGains<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_gains<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> getAxisGains<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_gains<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setAxisOffset<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> z<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> getAxisOffset<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span><span class=\"sy0\">*</span> x<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span> y<span class=\"sy0\">,</span> <span class=\"kw4\">int</span><span class=\"sy0\">*</span>z<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setTapDuration<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> tapDuration<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getTapDuration<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setDoubleTapLatency<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> floatTapLatency<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getDoubleTapLatency<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setDoubleTapWindow<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> floatTapWindow<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getDoubleTapWindow<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setActivityThreshold<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> activityThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getActivityThreshold<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInactivityThreshold<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> inactivityThreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getInactivityThreshold<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setTimeInactivity<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> timeInactivity<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getTimeInactivity<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setFreeFallThreshold<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> freeFallthreshold<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getFreeFallThreshold<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setFreeFallDuration<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> freeFallDuration<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">int</span> getFreeFallDuration<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> bool isActivityXEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isActivityYEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isActivityZEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isInactivityXEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isInactivityYEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isInactivityZEnabled<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isActivityAc<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isInactivityAc<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setActivityAc<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInactivityAc<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> bool getSuppressBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setSuppressBit<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapDetectionOnX<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setTapDetectionOnX<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapDetectionOnY<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setTapDetectionOnY<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapDetectionOnZ<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setTapDetectionOnZ<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw4\">void</span> setActivityX<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setActivityY<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setActivityZ<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInactivityX<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInactivityY<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInactivityZ<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> bool isActivitySourceOnX<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isActivitySourceOnY<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isActivitySourceOnZ<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapSourceOnX<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapSourceOnY<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isTapSourceOnZ<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isAsleep<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> bool isLowPower<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setLowPower<span class=\"br0\">&#40;</span>bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">float</span> getRate<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setRate<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> rate<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> set_bw<span class=\"br0\">&#40;</span>byte bw_code<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte get_bw_code<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><br /> byte getInterruptSource<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getInterruptSource<span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getInterruptMapping<span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInterruptMapping<span class=\"br0\">&#40;</span>byte interruptBit<span class=\"sy0\">,</span> bool interruptPin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isInterruptEnabled<span class=\"br0\">&#40;</span>byte interruptBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInterrupt<span class=\"br0\">&#40;</span>byte interruptBit<span class=\"sy0\">,</span> bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw4\">void</span> getRangeSetting<span class=\"br0\">&#40;</span>byte<span class=\"sy0\">*</span> rangeSetting<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setRangeSetting<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getSelfTestBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setSelfTestBit<span class=\"br0\">&#40;</span>bool selfTestBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getSpiBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setSpiBit<span class=\"br0\">&#40;</span>bool spiBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getInterruptLevelBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setInterruptLevelBit<span class=\"br0\">&#40;</span>bool interruptLevelBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getFullResBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setFullResBit<span class=\"br0\">&#40;</span>bool fullResBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getJustifyBit<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setJustifyBit<span class=\"br0\">&#40;</span>bool justifyBit<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> printAllRegister<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> writeTo<span class=\"br0\">&#40;</span>byte address<span class=\"sy0\">,</span> byte val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />private<span class=\"sy0\">:</span><br /> <span class=\"kw4\">void</span> readFrom<span class=\"br0\">&#40;</span>byte address<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> num<span class=\"sy0\">,</span> byte buff<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setRegisterBit<span class=\"br0\">&#40;</span>byte regAdress<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> bitPos<span class=\"sy0\">,</span> bool state<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool getRegisterBit<span class=\"br0\">&#40;</span>byte regAdress<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> bitPos<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> byte _buff<span class=\"br0\">&#91;</span>6<span class=\"br0\">&#93;</span> <span class=\"sy0\">;</span>  <span class=\"co1\">//6 bytes buffer for saving data read from the device</span><br /> <span class=\"kw4\">int</span> _dev_address<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><span class=\"kw4\">void</span> print_byte<span class=\"br0\">&#40;</span>byte val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper cpp\" id=\"fc0b86317046c8c72482e74d59478112ae124f51\">  <p class=\"fileHead\">FIMU_ITG3200.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/****************************************************************************<br />* ITG3200.cpp - ITG-3200/I2C library v0.5 for Arduino             *<br />* Copyright 2010-2011 Filipe Vieira &amp; various contributors         *<br />* http://code.google.com/p/itg-3200driver                  *<br />* This file is part of ITG-3200 Arduino library.              *<br />*                                      *<br />* This library is free software: you can redistribute it and/or modify   *<br />* it under the terms of the GNU Lesser General Public License as published *<br />* by the Free Software Foundation, either version 3 of the License, or   *<br />* (at your option) any later version.                    *<br />*                                      *<br />* This program is distributed in the hope that it will be useful,      *<br />* but WITHOUT ANY WARRANTY; without even the implied warranty of      *<br />* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the       *<br />* GNU Lesser General Public License for more details.            *<br />*                                      *<br />* You should have received a copy of the GNU Lesser General Public License *<br />* along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.   *<br />****************************************************************************/</span><br /><span class=\"coMULTI\">/****************************************************************************<br />* Tested on Arduino Mega with ITG-3200 Breakout               *<br />* SCL   -&gt; pin 21   (no pull up resistors)               *<br />* SDA   -&gt; pin 20   (no pull up resistors)               *<br />* CLK &amp; GND -&gt; pin GND                           *<br />* INT    -&gt; not connected (but can be used)               *<br />* VIO &amp; VDD -&gt; pin 3.3V                           *<br />*****************************************************************************/</span><br /><span class=\"co2\">#include &quot;FIMU_ITG3200.h&quot;</span><br /><br /><br />ITG3200<span class=\"sy0\">::</span><span class=\"me2\">ITG3200</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> setGains<span class=\"br0\">&#40;</span>1.0<span class=\"sy0\">,</span>1.0<span class=\"sy0\">,</span>1.0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setOffsets<span class=\"br0\">&#40;</span>0.0<span class=\"sy0\">,</span>0.0<span class=\"sy0\">,</span>0.0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setRevPolarity<span class=\"br0\">&#40;</span>0<span class=\"sy0\">,</span>0<span class=\"sy0\">,</span>0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">//Wire.begin();    //Normally this code is called from setup() at user code</span><br />            <span class=\"co1\">//but some people reported that joining I2C bus earlier</span><br />            <span class=\"co1\">//apparently solved problems with master/slave conditions.</span><br />            <span class=\"co1\">//Uncomment if needed.</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> address<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"co1\">// Uncomment or change your default ITG3200 initialization</span><br /> <br /> <span class=\"co1\">// fast sample rate - divisor = 0 filter = 0 clocksrc = 0, 1, 2, or 3 (raw values)</span><br /> init<span class=\"br0\">&#40;</span>address<span class=\"sy0\">,</span> NOSRDIVIDER<span class=\"sy0\">,</span> RANGE2000<span class=\"sy0\">,</span> BW256_SR8<span class=\"sy0\">,</span> PLL_XGYRO_REF<span class=\"sy0\">,</span> <span class=\"kw2\">true</span><span class=\"sy0\">,</span> <span class=\"kw2\">true</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// slow sample rate - divisor = 0 filter = 1,2,3,4,5, or 6 clocksrc = 0, 1, 2, or 3 (raw values)</span><br /> <span class=\"co1\">//init(NOSRDIVIDER, RANGE2000, BW010_SR1, INTERNALOSC, true, true);</span><br /> <br /> <span class=\"co1\">// fast sample rate 32Khz external clock - divisor = 0 filter = 0 clocksrc = 4 (raw values)</span><br /> <span class=\"co1\">//init(NOSRDIVIDER, RANGE2000, BW256_SR8, PLL_EXTERNAL32, true, true);</span><br /> <br /> <span class=\"co1\">// slow sample rate 32Khz external clock - divisor = 0 filter = 1,2,3,4,5, or 6 clocksrc = 4 (raw values)</span><br /> <span class=\"co1\">//init(NOSRDIVIDER, RANGE2000, BW010_SR1, PLL_EXTERNAL32, true, true);</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> byte _SRateDiv<span class=\"sy0\">,</span> byte _Range<span class=\"sy0\">,</span> byte _filterBW<span class=\"sy0\">,</span> byte _ClockSrc<span class=\"sy0\">,</span> bool _ITGReady<span class=\"sy0\">,</span> bool _INTRawDataReady<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> _dev_address <span class=\"sy0\">=</span> address<span class=\"sy0\">;</span><br /> setSampleRateDiv<span class=\"br0\">&#40;</span>_SRateDiv<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setFSRange<span class=\"br0\">&#40;</span>_Range<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setFilterBW<span class=\"br0\">&#40;</span>_filterBW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setClockSource<span class=\"br0\">&#40;</span>_ClockSrc<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setITGReady<span class=\"br0\">&#40;</span>_ITGReady<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> setRawDataReady<span class=\"br0\">&#40;</span>_INTRawDataReady<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> delay<span class=\"br0\">&#40;</span>GYROSTART_UP_DELAY<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// startup </span><br /><span class=\"br0\">&#125;</span><br /><br />byte ITG3200<span class=\"sy0\">::</span><span class=\"me2\">getDevAddr</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"coMULTI\">/*readmem(WHO_AM_I, 1, &amp;_buff[0]); <br /> return _buff[0]; */</span><br /> <span class=\"kw1\">return</span> _dev_address<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setDevAddr</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> _addr<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> writemem<span class=\"br0\">&#40;</span>WHO_AM_I<span class=\"sy0\">,</span> _addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> _dev_address <span class=\"sy0\">=</span> _addr<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />byte ITG3200<span class=\"sy0\">::</span><span class=\"me2\">getSampleRateDiv</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>SMPLRT_DIV<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> _buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setSampleRateDiv</span><span class=\"br0\">&#40;</span>byte _SampleRate<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> writemem<span class=\"br0\">&#40;</span>SMPLRT_DIV<span class=\"sy0\">,</span> _SampleRate<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />byte ITG3200<span class=\"sy0\">::</span><span class=\"me2\">getFSRange</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> DLPFFS_FS_SEL<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setFSRange</span><span class=\"br0\">&#40;</span>byte _Range<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <br /> writemem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~DLPFFS_FS_SEL<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> <span class=\"br0\">&#40;</span>_Range <span class=\"sy0\">&lt;&lt;</span> 3<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />byte ITG3200<span class=\"sy0\">::</span><span class=\"me2\">getFilterBW</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> readmem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> DLPFFS_DLPF_CFG<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setFilterBW</span><span class=\"br0\">&#40;</span>byte _BW<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>DLPF_FS<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~DLPFFS_DLPF_CFG<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _BW<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isINTActiveOnLow</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_ACTL<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 7<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setINTLogiclvl</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_ACTL<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> <span class=\"br0\">&#40;</span>_State <span class=\"sy0\">&lt;&lt;</span> 7<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isINTOpenDrain</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_OPEN<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 6<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setINTDriveType</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_OPEN<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State <span class=\"sy0\">&lt;&lt;</span> 6<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isLatchUntilCleared</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_LATCH_INT_EN<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setLatchMode</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_LATCH_INT_EN<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State <span class=\"sy0\">&lt;&lt;</span> 5<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isAnyRegClrMode</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_INT_ANYRD_2CLEAR<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setLatchClearMode</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_INT_ANYRD_2CLEAR<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State <span class=\"sy0\">&lt;&lt;</span> 4<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isITGReadyOn</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_ITG_RDY_EN<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setITGReady</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_ITG_RDY_EN<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State <span class=\"sy0\">&lt;&lt;</span> 2<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isRawDataReadyOn</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTCFG_RAW_RDY_EN<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setRawDataReady</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>INT_CFG<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~INTCFG_RAW_RDY_EN<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isITGReady</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_STATUS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTSTATUS_ITG_RDY<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> 2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isRawDataReady</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>INT_STATUS<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> INTSTATUS_RAW_DATA_RDY<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readTemp</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_Temp<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>TEMP_OUT<span class=\"sy0\">,</span>2<span class=\"sy0\">,</span>_buff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_Temp <span class=\"sy0\">=</span> 35 <span class=\"sy0\">+</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">+</span> 13200<span class=\"br0\">&#41;</span> <span class=\"sy0\">/</span> <span class=\"nu16\">280.0</span><span class=\"sy0\">;</span>  <span class=\"co1\">// F=C*9/5+32 </span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyroRaw</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>GYRO_XOUT<span class=\"sy0\">,</span> 6<span class=\"sy0\">,</span> _buff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroX <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroY <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"sy0\">*</span>_GyroZ <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _buff<span class=\"br0\">&#91;</span>5<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyroRaw</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> readGyroRaw<span class=\"br0\">&#40;</span>_GyroXYZ<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>1<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setRevPolarity</span><span class=\"br0\">&#40;</span>bool _Xpol<span class=\"sy0\">,</span> bool _Ypol<span class=\"sy0\">,</span> bool _Zpol<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> polarities<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Xpol <span class=\"sy0\">?</span> <span class=\"sy0\">-</span>1 <span class=\"sy0\">:</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br /> polarities<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Ypol <span class=\"sy0\">?</span> <span class=\"sy0\">-</span>1 <span class=\"sy0\">:</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br /> polarities<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Zpol <span class=\"sy0\">?</span> <span class=\"sy0\">-</span>1 <span class=\"sy0\">:</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setGains</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> _Xgain<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> _Ygain<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> _Zgain<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> gains<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Xgain<span class=\"sy0\">;</span><br /> gains<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Ygain<span class=\"sy0\">;</span><br /> gains<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Zgain<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setOffsets</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> _Xoffset<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> _Yoffset<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> _Zoffset<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> offsets<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Xoffset<span class=\"sy0\">;</span><br /> offsets<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Yoffset<span class=\"sy0\">;</span><br /> offsets<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> _Zoffset<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">zeroCalibrate</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> totSamples<span class=\"sy0\">,</span> <span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> sampleDelayMS<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> xyz<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw4\">float</span> tmpOffsets<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#123;</span>0<span class=\"sy0\">,</span>0<span class=\"sy0\">,</span>0<span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw1\">for</span> <span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span>i <span class=\"sy0\">&lt;</span> totSamples<span class=\"sy0\">;</span>i<span class=\"sy0\">++</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  delay<span class=\"br0\">&#40;</span>sampleDelayMS<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  readGyroRaw<span class=\"br0\">&#40;</span>xyz<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  tmpOffsets<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> xyz<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />  tmpOffsets<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> xyz<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br />  tmpOffsets<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> xyz<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <br /> <span class=\"br0\">&#125;</span><br /> setOffsets<span class=\"br0\">&#40;</span><span class=\"sy0\">-</span>tmpOffsets<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">/</span> totSamples<span class=\"sy0\">,</span> <span class=\"sy0\">-</span>tmpOffsets<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">/</span> totSamples<span class=\"sy0\">,</span> <span class=\"sy0\">-</span>tmpOffsets<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">/</span> totSamples<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyroRawCal</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readGyroRaw<span class=\"br0\">&#40;</span>_GyroX<span class=\"sy0\">,</span> _GyroY<span class=\"sy0\">,</span> _GyroZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroX <span class=\"sy0\">+=</span> offsets<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroY <span class=\"sy0\">+=</span> offsets<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroZ <span class=\"sy0\">+=</span> offsets<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyroRawCal</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readGyroRawCal<span class=\"br0\">&#40;</span>_GyroXYZ<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>1<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyro</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">int</span> x<span class=\"sy0\">,</span> y<span class=\"sy0\">,</span> z<span class=\"sy0\">;</span><br /> <br /> readGyroRawCal<span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>x<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>y<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>z<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// x,y,z will contain calibrated integer values from the sensor</span><br /> <span class=\"sy0\">*</span>_GyroX <span class=\"sy0\">=</span> x <span class=\"sy0\">/</span> 14.375 <span class=\"sy0\">*</span> polarities<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> gains<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroY <span class=\"sy0\">=</span> y <span class=\"sy0\">/</span> 14.375 <span class=\"sy0\">*</span> polarities<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> gains<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"sy0\">*</span>_GyroZ <span class=\"sy0\">=</span> z <span class=\"sy0\">/</span> 14.375 <span class=\"sy0\">*</span> polarities<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> gains<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readGyro</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> readGyro<span class=\"br0\">&#40;</span>_GyroXYZ<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>1<span class=\"sy0\">,</span> _GyroXYZ<span class=\"sy0\">+</span>2<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">reset</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>   <br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> PWRMGM_HRESET<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> delay<span class=\"br0\">&#40;</span>GYROSTART_UP_DELAY<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//gyro startup </span><br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isLowPower</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_SLEEP<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> <span class=\"nu0\">6</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /> <br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setPowerMode</span><span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~PWRMGM_SLEEP<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _State <span class=\"sy0\">&lt;&lt;</span> 6<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isXgyroStandby</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_XG<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> <span class=\"nu0\">5</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isYgyroStandby</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_YG<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> <span class=\"nu0\">4</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />bool ITG3200<span class=\"sy0\">::</span><span class=\"me2\">isZgyroStandby</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_ZG<span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;&gt;</span> <span class=\"nu0\">3</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setXgyroStandby</span><span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_XG<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _Status <span class=\"sy0\">&lt;&lt;</span> 5<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setYgyroStandby</span><span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_YG<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _Status <span class=\"sy0\">&lt;&lt;</span> 4<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setZgyroStandby</span><span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_STBY_ZG<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _Status <span class=\"sy0\">&lt;&lt;</span> 3<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />byte ITG3200<span class=\"sy0\">::</span><span class=\"me2\">getClockSource</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> <span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> PWRMGM_CLK_SEL<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">setClockSource</span><span class=\"br0\">&#40;</span>byte _CLKsource<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span>  <br /> readmem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> 1<span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> writemem<span class=\"br0\">&#40;</span>PWR_MGM<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>_buff<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> ~PWRMGM_CLK_SEL<span class=\"br0\">&#41;</span> <span class=\"sy0\">|</span> _CLKsource<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">writemem</span><span class=\"br0\">&#40;</span>uint8_t _addr<span class=\"sy0\">,</span> uint8_t _val<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <span class=\"co1\">// start transmission to device </span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>_addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// send register address</span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>_val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// send value to write</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// end transmission</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> ITG3200<span class=\"sy0\">::</span><span class=\"me2\">readmem</span><span class=\"br0\">&#40;</span>uint8_t _addr<span class=\"sy0\">,</span> uint8_t _nbytes<span class=\"sy0\">,</span> uint8_t __buff<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start transmission to device </span><br /> Wire.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span>_addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// sends register address to read from</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// end transmission</span><br /> <br /> Wire.<span class=\"me1\">beginTransmission</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// start transmission to device </span><br /> Wire.<span class=\"me1\">requestFrom</span><span class=\"br0\">&#40;</span>_dev_address<span class=\"sy0\">,</span> _nbytes<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><span class=\"co1\">// send data n-bytes read</span><br /> uint8_t i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> <br /> <span class=\"kw1\">while</span> <span class=\"br0\">&#40;</span>Wire.<span class=\"me1\">available</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  __buff<span class=\"br0\">&#91;</span>i<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> Wire.<span class=\"me1\">read</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// receive DATA</span><br />  i<span class=\"sy0\">++;</span><br /> <span class=\"br0\">&#125;</span><br /> Wire.<span class=\"me1\">endTransmission</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// end transmission</span><br /><span class=\"br0\">&#125;</span><br /><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"6c7d80ef461c35aec60819ba8a48397c4dc1a557\">  <p class=\"fileHead\">FIMU_ITG3200.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/****************************************************************************<br />* ITG3200.h - ITG-3200/I2C library v0.5 for Arduino             *<br />* Copyright 2010-2011 Filipe Vieira &amp; various contributors         *<br />* http://code.google.com/p/itg-3200driver                  *<br />* This file is part of ITG-3200 Arduino library.              *<br />*                                      *<br />* This library is free software: you can redistribute it and/or modify   *<br />* it under the terms of the GNU Lesser General Public License as published *<br />* by the Free Software Foundation, either version 3 of the License, or   *<br />* (at your option) any later version.                    *<br />*                                      *<br />* This program is distributed in the hope that it will be useful,      *<br />* but WITHOUT ANY WARRANTY; without even the implied warranty of      *<br />* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the       *<br />* GNU Lesser General Public License for more details.            *<br />*                                      *<br />* You should have received a copy of the GNU Lesser General Public License *<br />* along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.   *<br />****************************************************************************/</span><br /><span class=\"coMULTI\">/****************************************************************************<br />* Tested on Arduino Mega with ITG-3200 Breakout               *<br />* SCL   -&gt; pin 21   (no pull up resistors)               *<br />* SDA   -&gt; pin 20   (no pull up resistors)               *<br />* CLK &amp; GND -&gt; pin GND                          *<br />* INT    -&gt; not connected (but can be used)               *<br />* VIO &amp; VDD -&gt; pin 3.3V                           *<br />*****************************************************************************/</span><br /><span class=\"co2\">#ifndef FIMU_ITG3200_h</span><br /><span class=\"co2\">#define FIMU_ITG3200_h</span><br /><br /><span class=\"co2\">#include &quot;Arduino.h&quot;</span><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><br /><span class=\"co2\">#define ITG3200_ADDR_AD0_HIGH 0x69  //AD0=1 0x69 I2C address when AD0 is connected to HIGH (VCC) - default for sparkfun breakout</span><br /><span class=\"co2\">#define ITG3200_ADDR_AD0_LOW  0x68  //AD0=0 0x68 I2C address when AD0 is connected to LOW (GND)</span><br /><span class=\"co1\">// &quot;The LSB bit of the 7 bit address is determined by the logic level on pin 9. </span><br /><span class=\"co1\">// This allows two ITG-3200 devices to be connected to the same I2C bus.</span><br /><span class=\"co1\">// One device should have pin9 (or bit0) LOW and the other should be HIGH.&quot; source: ITG3200 datasheet</span><br /><span class=\"co1\">// Note that pin9 (AD0 - I2C Slave Address LSB) may not be available on some breakout boards so check </span><br /><span class=\"co1\">// the schematics of your breakout board for the correct address to use.</span><br /><br /><br /><span class=\"co2\">#define GYROSTART_UP_DELAY 70  // 50ms from gyro startup + 20ms register r/w startup</span><br /><br /><span class=\"coMULTI\">/* ---- Registers ---- */</span><br /><span class=\"co2\">#define WHO_AM_I      0x00 // RW  SETUP: I2C address  </span><br /><span class=\"co2\">#define SMPLRT_DIV     0x15 // RW  SETUP: Sample Rate Divider    </span><br /><span class=\"co2\">#define DLPF_FS      0x16 // RW  SETUP: Digital Low Pass Filter/ Full Scale range</span><br /><span class=\"co2\">#define INT_CFG      0x17 // RW  Interrupt: Configuration</span><br /><span class=\"co2\">#define INT_STATUS     0x1A // R  Interrupt: Status</span><br /><span class=\"co2\">#define TEMP_OUT      0x1B // R  SENSOR: Temperature 2bytes</span><br /><span class=\"co2\">#define GYRO_XOUT     0x1D // R  SENSOR: Gyro X 2bytes </span><br /><span class=\"co2\">#define GYRO_YOUT     0x1F // R  SENSOR: Gyro Y 2bytes</span><br /><span class=\"co2\">#define GYRO_ZOUT     0x21 // R  SENSOR: Gyro Z 2bytes</span><br /><span class=\"co2\">#define PWR_MGM      0x3E // RW Power Management</span><br /><br /><span class=\"coMULTI\">/* ---- bit maps ---- */</span><br /><span class=\"co2\">#define DLPFFS_FS_SEL       0x18 // 00011000</span><br /><span class=\"co2\">#define DLPFFS_DLPF_CFG      0x07 // 00000111</span><br /><span class=\"co2\">#define INTCFG_ACTL        0x80 // 10000000</span><br /><span class=\"co2\">#define INTCFG_OPEN        0x40 // 01000000</span><br /><span class=\"co2\">#define INTCFG_LATCH_INT_EN    0x20 // 00100000</span><br /><span class=\"co2\">#define INTCFG_INT_ANYRD_2CLEAR  0x10 // 00010000</span><br /><span class=\"co2\">#define INTCFG_ITG_RDY_EN     0x04 // 00000100</span><br /><span class=\"co2\">#define INTCFG_RAW_RDY_EN     0x01 // 00000001</span><br /><span class=\"co2\">#define INTSTATUS_ITG_RDY     0x04 // 00000100</span><br /><span class=\"co2\">#define INTSTATUS_RAW_DATA_RDY  0x01 // 00000001</span><br /><span class=\"co2\">#define PWRMGM_HRESET       0x80 // 10000000</span><br /><span class=\"co2\">#define PWRMGM_SLEEP       0x40 // 01000000</span><br /><span class=\"co2\">#define PWRMGM_STBY_XG      0x20 // 00100000</span><br /><span class=\"co2\">#define PWRMGM_STBY_YG      0x10 // 00010000</span><br /><span class=\"co2\">#define PWRMGM_STBY_ZG      0x08 // 00001000</span><br /><span class=\"co2\">#define PWRMGM_CLK_SEL      0x07 // 00000111</span><br /><br /><span class=\"coMULTI\">/************************************/</span><br /><span class=\"coMULTI\">/*  REGISTERS PARAMETERS  */</span><br /><span class=\"coMULTI\">/************************************/</span><br /><span class=\"co1\">// Sample Rate Divider</span><br /><span class=\"co2\">#define NOSRDIVIDER     0 // default  FsampleHz=SampleRateHz/(divider+1)</span><br /><span class=\"co1\">// Gyro Full Scale Range</span><br /><span class=\"co2\">#define RANGE2000      3  // default</span><br /><span class=\"co1\">// Digital Low Pass Filter BandWidth and SampleRate</span><br /><span class=\"co2\">#define BW256_SR8      0  // default  256Khz BW and 8Khz SR</span><br /><span class=\"co2\">#define BW188_SR1      1</span><br /><span class=\"co2\">#define BW098_SR1      2</span><br /><span class=\"co2\">#define BW042_SR1      3</span><br /><span class=\"co2\">#define BW020_SR1      4</span><br /><span class=\"co2\">#define BW010_SR1      5</span><br /><span class=\"co2\">#define BW005_SR1      6</span><br /><span class=\"co1\">// Interrupt Active logic lvl</span><br /><span class=\"co2\">#define ACTIVE_ONHIGH    0 // default</span><br /><span class=\"co2\">#define ACTIVE_ONLOW    1</span><br /><span class=\"co1\">// Interrupt drive type</span><br /><span class=\"co2\">#define PUSH_PULL      0 // default</span><br /><span class=\"co2\">#define OPEN_DRAIN     1</span><br /><span class=\"co1\">// Interrupt Latch mode</span><br /><span class=\"co2\">#define PULSE_50US     0 // default</span><br /><span class=\"co2\">#define UNTIL_INT_CLEARED  1</span><br /><span class=\"co1\">// Interrupt Latch clear method</span><br /><span class=\"co2\">#define READ_STATUSREG   0 // default</span><br /><span class=\"co2\">#define READ_ANYREG     1</span><br /><span class=\"co1\">// Power management</span><br /><span class=\"co2\">#define NORMAL       0 // default</span><br /><span class=\"co2\">#define STANDBY       1</span><br /><span class=\"co1\">// Clock Source - user parameters</span><br /><span class=\"co2\">#define INTERNALOSC     0  // default</span><br /><span class=\"co2\">#define PLL_XGYRO_REF    1</span><br /><span class=\"co2\">#define PLL_YGYRO_REF    2</span><br /><span class=\"co2\">#define PLL_ZGYRO_REF    3</span><br /><span class=\"co2\">#define PLL_EXTERNAL32   4  // 32.768 kHz</span><br /><span class=\"co2\">#define PLL_EXTERNAL19   5  // 19.2 Mhz</span><br /><br />class ITG3200 <span class=\"br0\">&#123;</span><br /><br />public<span class=\"sy0\">:</span><br /> <span class=\"kw4\">float</span> gains<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw4\">int</span> offsets<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">float</span> polarities<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> ITG3200<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Gyro initialization</span><br /> <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> address<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> address<span class=\"sy0\">,</span> byte _SRateDiv<span class=\"sy0\">,</span> byte _Range<span class=\"sy0\">,</span> byte _filterBW<span class=\"sy0\">,</span> byte _ClockSrc<span class=\"sy0\">,</span> bool _ITGReady<span class=\"sy0\">,</span> bool _INTRawDataReady<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>   <br />  <br /> <span class=\"co1\">// Who Am I</span><br /> byte getDevAddr<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setDevAddr<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> _addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">// Sample Rate Divider</span><br /> byte getSampleRateDiv<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <br /> <span class=\"kw4\">void</span> setSampleRateDiv<span class=\"br0\">&#40;</span>byte _SampleRate<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">// Digital Low Pass Filter BandWidth and SampleRate </span><br /> byte getFSRange<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setFSRange<span class=\"br0\">&#40;</span>byte _Range<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// RANGE2000</span><br /> byte getFilterBW<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"kw4\">void</span> setFilterBW<span class=\"br0\">&#40;</span>byte _BW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// see register parameters above</span><br /> <span class=\"co1\">// Interrupt Configuration</span><br /> bool isINTActiveOnLow<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setINTLogiclvl<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//ACTIVE_ONHIGH, ACTIVE_ONLOW</span><br /> <span class=\"co1\">// Interrupt drive type</span><br /> bool isINTOpenDrain<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setINTDriveType<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//OPEN_DRAIN, PUSH_PULL</span><br /> <span class=\"co1\">// Interrupt Latch mode</span><br /> bool isLatchUntilCleared<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setLatchMode<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//UNTIL_INT_CLEARED, PULSE_50US</span><br /> <span class=\"co1\">// Interrupt Latch clear method</span><br /> bool isAnyRegClrMode<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setLatchClearMode<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//READ_ANYREG, READ_STATUSREG</span><br /> <span class=\"co1\">// INT pin triggers</span><br /> bool isITGReadyOn<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>     <br /> <span class=\"kw4\">void</span> setITGReady<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isRawDataReadyOn<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setRawDataReady<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>   <br /> <span class=\"co1\">// Trigger Status</span><br /> bool isITGReady<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isRawDataReady<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">// Gyro Sensors</span><br /> <span class=\"kw4\">void</span> readTemp<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_Temp<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readGyroRaw<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readGyroRaw<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setRevPolarity<span class=\"br0\">&#40;</span>bool _Xpol<span class=\"sy0\">,</span> bool _Ypol<span class=\"sy0\">,</span> bool _Zpol<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>   <span class=\"co1\">// true = Reversed false = default</span><br /> <span class=\"kw4\">void</span> setGains<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> _Xgain<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> _Ygain<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> _Zgain<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setOffsets<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> _Xoffset<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> _Yoffset<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> _Zoffset<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> zeroCalibrate<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> totSamples<span class=\"sy0\">,</span> <span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> sampleDelayMS<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>   <span class=\"co1\">// assuming gyroscope is stationary (updates XYZ offsets for zero)</span><br /> <span class=\"kw4\">void</span> readGyroRawCal<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readGyroRawCal<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readGyro<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroXYZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// includes gain and offset</span><br /> <span class=\"kw4\">void</span> readGyro<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroX<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroY<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> <span class=\"sy0\">*</span>_GyroZ<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// includes gain and offset  </span><br /> <span class=\"co1\">// Power management</span><br /> <span class=\"kw4\">void</span> reset<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// after reset all registers have default values</span><br /> bool isLowPower<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setPowerMode<span class=\"br0\">&#40;</span>bool _State<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// NORMAL, STANDBY</span><br /> bool isXgyroStandby<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>      <br /> bool isYgyroStandby<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> bool isZgyroStandby<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setXgyroStandby<span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// NORMAL, STANDBY</span><br /> <span class=\"kw4\">void</span> setYgyroStandby<span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setZgyroStandby<span class=\"br0\">&#40;</span>bool _Status<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> byte getClockSource<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> setClockSource<span class=\"br0\">&#40;</span>byte _CLKsource<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// see register parameters above</span><br /> <br /> <span class=\"kw4\">void</span> writemem<span class=\"br0\">&#40;</span>uint8_t _addr<span class=\"sy0\">,</span> uint8_t _val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">void</span> readmem<span class=\"br0\">&#40;</span>uint8_t _addr<span class=\"sy0\">,</span> uint8_t _nbytes<span class=\"sy0\">,</span> uint8_t __buff<span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br />private<span class=\"sy0\">:</span><br /><br /> uint8_t _dev_address<span class=\"sy0\">;</span><br /> uint8_t _buff<span class=\"br0\">&#91;</span>6<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span>   <br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><span class=\"co2\">#endif</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper cpp\" id=\"73ae3ed2adafe5709038a45e1364fa88f5293030\">  <p class=\"fileHead\">FreeSixIMU.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />FreeSixIMU.cpp - A libre and easy to use orientation sensing library for Arduino<br />Copyright (C) 2011 Fabio Varesano &lt;fabio at varesano dot net&gt;<br /><br />Development of this code has been supported by the Department of Computer Science,<br />Universita\' degli Studi di Torino, Italy within the Piemonte Project<br />http://www.piemonte.di.unito.it/<br /><br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span class=\"co2\">#include &lt;inttypes.h&gt;</span><br /><span class=\"co1\">//#define DEBUG</span><br /><span class=\"co2\">#include &quot;FreeSixIMU.h&quot;</span><br /><span class=\"co1\">// #include &quot;WireUtils.h&quot;</span><br /><span class=\"co1\">//#include &quot;DebugUtils.h&quot;</span><br /><br /><br />FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">FreeSixIMU</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />    acc <span class=\"sy0\">=</span> ADXL345<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    gyro <span class=\"sy0\">=</span> ITG3200<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <span class=\"co1\">//magn = HMC58X3();</span><br />    <br /> <span class=\"co1\">// initialize quaternion</span><br /> q0 <span class=\"sy0\">=</span> <span class=\"nu17\">1.0f</span><span class=\"sy0\">;</span><br /> q1 <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br /> q2 <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br /> q3 <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br /> exInt <span class=\"sy0\">=</span> <span class=\"nu16\">0.0</span><span class=\"sy0\">;</span><br /> eyInt <span class=\"sy0\">=</span> <span class=\"nu16\">0.0</span><span class=\"sy0\">;</span><br /> ezInt <span class=\"sy0\">=</span> <span class=\"nu16\">0.0</span><span class=\"sy0\">;</span><br /> twoKp <span class=\"sy0\">=</span> twoKpDef<span class=\"sy0\">;</span><br /> twoKi <span class=\"sy0\">=</span> twoKiDef<span class=\"sy0\">;</span><br /> integralFBx <span class=\"sy0\">=</span> 0.0f<span class=\"sy0\">,</span> integralFBy <span class=\"sy0\">=</span> 0.0f<span class=\"sy0\">,</span> integralFBz <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br /> lastUpdate <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br /> now <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> init<span class=\"br0\">&#40;</span>FIMU_ACC_ADDR<span class=\"sy0\">,</span> FIMU_ITG3200_DEF_ADDR<span class=\"sy0\">,</span> <span class=\"kw2\">false</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span>bool fastmode<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> init<span class=\"br0\">&#40;</span>FIMU_ACC_ADDR<span class=\"sy0\">,</span> FIMU_ITG3200_DEF_ADDR<span class=\"sy0\">,</span> fastmode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">init</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> acc_addr<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> gyro_addr<span class=\"sy0\">,</span> bool fastmode<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> delay<span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// disable internal pullups of the ATMEGA which Wire enable by default</span><br /> <span class=\"co2\">#if defined(__AVR_ATmega168__) || defined(__AVR_ATmega8__) || defined(__AVR_ATmega328P__)</span><br />  <span class=\"co1\">// deactivate internal pull-ups for twi</span><br />  <span class=\"co1\">// as per note from atmega8 manual pg167</span><br />  cbi<span class=\"br0\">&#40;</span>PORTC<span class=\"sy0\">,</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  cbi<span class=\"br0\">&#40;</span>PORTC<span class=\"sy0\">,</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co2\">#else</span><br />  <span class=\"co1\">// deactivate internal pull-ups for twi</span><br />  <span class=\"co1\">// as per note from atmega128 manual pg204</span><br />  cbi<span class=\"br0\">&#40;</span>PORTD<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  cbi<span class=\"br0\">&#40;</span>PORTD<span class=\"sy0\">,</span> 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co2\">#endif</span><br /> <br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>fastmode<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <span class=\"co1\">// switch to 400KHz I2C - eheheh</span><br />  TWBR <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>16000000L <span class=\"sy0\">/</span> 400000L<span class=\"br0\">&#41;</span> <span class=\"sy0\">-</span> 16<span class=\"br0\">&#41;</span> <span class=\"sy0\">/</span> <span class=\"nu0\">2</span><span class=\"sy0\">;</span> <span class=\"co1\">// see twi_init in Wire/utility/twi.c</span><br />  <span class=\"co1\">// TODO: make the above usable also for 8MHz arduinos..</span><br /> <span class=\"br0\">&#125;</span><br /> <br />    <span class=\"co1\">// init ADXL345</span><br />    acc.<span class=\"me1\">init</span><span class=\"br0\">&#40;</span>acc_addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <br /><br /> <span class=\"co1\">// init ITG3200</span><br /> gyro.<span class=\"me1\">init</span><span class=\"br0\">&#40;</span>gyro_addr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> delay<span class=\"br0\">&#40;</span>1000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">// calibrate the ITG3200</span><br /> gyro.<span class=\"me1\">zeroCalibrate</span><span class=\"br0\">&#40;</span>128<span class=\"sy0\">,</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// init HMC5843</span><br /> <span class=\"co1\">//magn.init(false); // Don\'t set mode yet, we\'ll do that later on.</span><br /> <span class=\"co1\">// Calibrate HMC using self test, not recommended to change the gain after calibration.</span><br /> <span class=\"co1\">//magn.calibrate(1); // Use gain 1=default, valid 0-7, 7 not recommended.</span><br /> <span class=\"co1\">// Single mode conversion was used in calibration, now set continuous mode</span><br /> <span class=\"co1\">//magn.setMode(0);</span><br /> <span class=\"co1\">//delay(10);</span><br /> <span class=\"co1\">//magn.setDOR(B110);</span><br /> <br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getRawValues</span><span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span> raw_values<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> acc.<span class=\"me1\">readAccel</span><span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> gyro.<span class=\"me1\">readGyroRaw</span><span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>raw_values<span class=\"br0\">&#91;</span>5<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"co1\">//magn.getValues(&amp;raw_values[6], &amp;raw_values[7], &amp;raw_values[8]);</span><br /> <br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getValues</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> values<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw4\">int</span> accval<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> acc.<span class=\"me1\">readAccel</span><span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>accval<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>accval<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> <span class=\"sy0\">&amp;</span>accval<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> values<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span><span class=\"br0\">&#41;</span> accval<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> values<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span><span class=\"br0\">&#41;</span> accval<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> values<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span><span class=\"br0\">&#41;</span> accval<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> gyro.<span class=\"me1\">readGyro</span><span class=\"br0\">&#40;</span><span class=\"sy0\">&amp;</span>values<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">//magn.getValues(&amp;values[6]);</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"co1\">// Quaternion implementation of the \'DCM filter\' [Mayhony et al]. Incorporates the magnetic distortion</span><br /><span class=\"co1\">// compensation algorithms from Sebastian Madgwick filter which eliminates the need for a reference</span><br /><span class=\"co1\">// direction of flux (bx bz) to be predefined and limits the effect of magnetic distortions to yaw</span><br /><span class=\"co1\">// axis only.</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// See: http://www.x-io.co.uk/node/8#open_source_ahrs_and_imu_algorithms</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">//=====================================================================================================</span><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">AHRSupdate</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> gx<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> gy<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> gz<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> ax<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> ay<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> az<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> mx<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> my<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> mz<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">float</span> recipNorm<span class=\"sy0\">;</span><br /> <span class=\"kw4\">float</span> q0q0<span class=\"sy0\">,</span> q0q1<span class=\"sy0\">,</span> q0q2<span class=\"sy0\">,</span> q0q3<span class=\"sy0\">,</span> q1q1<span class=\"sy0\">,</span> q1q2<span class=\"sy0\">,</span> q1q3<span class=\"sy0\">,</span> q2q2<span class=\"sy0\">,</span> q2q3<span class=\"sy0\">,</span> q3q3<span class=\"sy0\">;</span><br /> <span class=\"kw4\">float</span> halfex <span class=\"sy0\">=</span> 0.0f<span class=\"sy0\">,</span> halfey <span class=\"sy0\">=</span> 0.0f<span class=\"sy0\">,</span> halfez <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br /> <span class=\"kw4\">float</span> qa<span class=\"sy0\">,</span> qb<span class=\"sy0\">,</span> qc<span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">// Auxiliary variables to avoid repeated arithmetic</span><br /> q0q0 <span class=\"sy0\">=</span> q0 <span class=\"sy0\">*</span> q0<span class=\"sy0\">;</span><br /> q0q1 <span class=\"sy0\">=</span> q0 <span class=\"sy0\">*</span> q1<span class=\"sy0\">;</span><br /> q0q2 <span class=\"sy0\">=</span> q0 <span class=\"sy0\">*</span> q2<span class=\"sy0\">;</span><br /> q0q3 <span class=\"sy0\">=</span> q0 <span class=\"sy0\">*</span> q3<span class=\"sy0\">;</span><br /> q1q1 <span class=\"sy0\">=</span> q1 <span class=\"sy0\">*</span> q1<span class=\"sy0\">;</span><br /> q1q2 <span class=\"sy0\">=</span> q1 <span class=\"sy0\">*</span> q2<span class=\"sy0\">;</span><br /> q1q3 <span class=\"sy0\">=</span> q1 <span class=\"sy0\">*</span> q3<span class=\"sy0\">;</span><br /> q2q2 <span class=\"sy0\">=</span> q2 <span class=\"sy0\">*</span> q2<span class=\"sy0\">;</span><br /> q2q3 <span class=\"sy0\">=</span> q2 <span class=\"sy0\">*</span> q3<span class=\"sy0\">;</span><br /> q3q3 <span class=\"sy0\">=</span> q3 <span class=\"sy0\">*</span> q3<span class=\"sy0\">;</span><br /> <br /> <br /> <span class=\"coMULTI\">/*<br /> // Use magnetometer measurement only when valid (avoids NaN in magnetometer normalisation)<br /> if((mx != 0.0f) &amp;&amp; (my != 0.0f) &amp;&amp; (mz != 0.0f)) {<br />  float hx, hy, bx, bz;<br />  float halfwx, halfwy, halfwz;<br />  <br />  // Normalise magnetometer measurement<br />  recipNorm = invSqrt(mx * mx + my * my + mz * mz);<br />  mx *= recipNorm;<br />  my *= recipNorm;<br />  mz *= recipNorm;<br />  <br />  // Reference direction of Earth\'s magnetic field<br />  hx = 2.0f * (mx * (0.5f - q2q2 - q3q3) + my * (q1q2 - q0q3) + mz * (q1q3 + q0q2));<br />  hy = 2.0f * (mx * (q1q2 + q0q3) + my * (0.5f - q1q1 - q3q3) + mz * (q2q3 - q0q1));<br />  bx = sqrt(hx * hx + hy * hy);<br />  bz = 2.0f * (mx * (q1q3 - q0q2) + my * (q2q3 + q0q1) + mz * (0.5f - q1q1 - q2q2));<br />  <br />  // Estimated direction of magnetic field<br />  halfwx = bx * (0.5f - q2q2 - q3q3) + bz * (q1q3 - q0q2);<br />  halfwy = bx * (q1q2 - q0q3) + bz * (q0q1 + q2q3);<br />  halfwz = bx * (q0q2 + q1q3) + bz * (0.5f - q1q1 - q2q2);<br />  <br />  // Error is sum of cross product between estimated direction and measured direction of field vectors<br />  halfex = (my * halfwz - mz * halfwy);<br />  halfey = (mz * halfwx - mx * halfwz);<br />  halfez = (mx * halfwy - my * halfwx);<br /> }<br /> */</span><br /><br /> <span class=\"co1\">// Compute feedback only if accelerometer measurement valid (avoids NaN in accelerometer normalisation)</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>ax <span class=\"sy0\">!=</span> 0.0f<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span>ay <span class=\"sy0\">!=</span> 0.0f<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span>az <span class=\"sy0\">!=</span> 0.0f<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"kw4\">float</span> halfvx<span class=\"sy0\">,</span> halfvy<span class=\"sy0\">,</span> halfvz<span class=\"sy0\">;</span><br />  <br />  <span class=\"co1\">// Normalise accelerometer measurement</span><br />  recipNorm <span class=\"sy0\">=</span> invSqrt<span class=\"br0\">&#40;</span>ax <span class=\"sy0\">*</span> ax <span class=\"sy0\">+</span> ay <span class=\"sy0\">*</span> ay <span class=\"sy0\">+</span> az <span class=\"sy0\">*</span> az<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  ax <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br />  ay <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br />  az <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br />  <br />  <span class=\"co1\">// Estimated direction of gravity</span><br />  halfvx <span class=\"sy0\">=</span> q1q3 <span class=\"sy0\">-</span> q0q2<span class=\"sy0\">;</span><br />  halfvy <span class=\"sy0\">=</span> q0q1 <span class=\"sy0\">+</span> q2q3<span class=\"sy0\">;</span><br />  halfvz <span class=\"sy0\">=</span> q0q0 <span class=\"sy0\">-</span> 0.5f <span class=\"sy0\">+</span> q3q3<span class=\"sy0\">;</span><br /> <br />  <span class=\"co1\">// Error is sum of cross product between estimated direction and measured direction of field vectors</span><br />  halfex <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>ay <span class=\"sy0\">*</span> halfvz <span class=\"sy0\">-</span> az <span class=\"sy0\">*</span> halfvy<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  halfey <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>az <span class=\"sy0\">*</span> halfvx <span class=\"sy0\">-</span> ax <span class=\"sy0\">*</span> halfvz<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  halfez <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>ax <span class=\"sy0\">*</span> halfvy <span class=\"sy0\">-</span> ay <span class=\"sy0\">*</span> halfvx<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> <span class=\"co1\">// Apply feedback only when valid data has been gathered from the accelerometer or magnetometer</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>halfex <span class=\"sy0\">!=</span> <span class=\"nu17\">0.0f</span> <span class=\"sy0\">&amp;&amp;</span> halfey <span class=\"sy0\">!=</span> <span class=\"nu17\">0.0f</span> <span class=\"sy0\">&amp;&amp;</span> halfez <span class=\"sy0\">!=</span> <span class=\"nu17\">0.0f</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"co1\">// Compute and apply integral feedback if enabled</span><br />  <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>twoKi <span class=\"sy0\">&gt;</span> 0.0f<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />   integralFBx <span class=\"sy0\">+=</span> twoKi <span class=\"sy0\">*</span> halfex <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// integral error scaled by Ki</span><br />   integralFBy <span class=\"sy0\">+=</span> twoKi <span class=\"sy0\">*</span> halfey <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   integralFBz <span class=\"sy0\">+=</span> twoKi <span class=\"sy0\">*</span> halfez <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   gx <span class=\"sy0\">+=</span> integralFBx<span class=\"sy0\">;</span> <span class=\"co1\">// apply integral feedback</span><br />   gy <span class=\"sy0\">+=</span> integralFBy<span class=\"sy0\">;</span><br />   gz <span class=\"sy0\">+=</span> integralFBz<span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">else</span> <span class=\"br0\">&#123;</span><br />   integralFBx <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span> <span class=\"co1\">// prevent integral windup</span><br />   integralFBy <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br />   integralFBz <span class=\"sy0\">=</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><br />  <span class=\"co1\">// Apply proportional feedback</span><br />  gx <span class=\"sy0\">+=</span> twoKp <span class=\"sy0\">*</span> halfex<span class=\"sy0\">;</span><br />  gy <span class=\"sy0\">+=</span> twoKp <span class=\"sy0\">*</span> halfey<span class=\"sy0\">;</span><br />  gz <span class=\"sy0\">+=</span> twoKp <span class=\"sy0\">*</span> halfez<span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> <br /> <span class=\"co1\">// Integrate rate of change of quaternion</span><br /> gx <span class=\"sy0\">*=</span> <span class=\"br0\">&#40;</span>0.5f <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span>  <span class=\"co1\">// pre-multiply common factors</span><br /> gy <span class=\"sy0\">*=</span> <span class=\"br0\">&#40;</span>0.5f <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> gz <span class=\"sy0\">*=</span> <span class=\"br0\">&#40;</span>0.5f <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>1.0f <span class=\"sy0\">/</span> sampleFreq<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> qa <span class=\"sy0\">=</span> q0<span class=\"sy0\">;</span><br /> qb <span class=\"sy0\">=</span> q1<span class=\"sy0\">;</span><br /> qc <span class=\"sy0\">=</span> q2<span class=\"sy0\">;</span><br /> q0 <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">-</span>qb <span class=\"sy0\">*</span> gx <span class=\"sy0\">-</span> qc <span class=\"sy0\">*</span> gy <span class=\"sy0\">-</span> q3 <span class=\"sy0\">*</span> gz<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q1 <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>qa <span class=\"sy0\">*</span> gx <span class=\"sy0\">+</span> qc <span class=\"sy0\">*</span> gz <span class=\"sy0\">-</span> q3 <span class=\"sy0\">*</span> gy<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q2 <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>qa <span class=\"sy0\">*</span> gy <span class=\"sy0\">-</span> qb <span class=\"sy0\">*</span> gz <span class=\"sy0\">+</span> q3 <span class=\"sy0\">*</span> gx<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q3 <span class=\"sy0\">+=</span> <span class=\"br0\">&#40;</span>qa <span class=\"sy0\">*</span> gz <span class=\"sy0\">+</span> qb <span class=\"sy0\">*</span> gy <span class=\"sy0\">-</span> qc <span class=\"sy0\">*</span> gx<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"co1\">// Normalise quaternion</span><br /> recipNorm <span class=\"sy0\">=</span> invSqrt<span class=\"br0\">&#40;</span>q0 <span class=\"sy0\">*</span> q0 <span class=\"sy0\">+</span> q1 <span class=\"sy0\">*</span> q1 <span class=\"sy0\">+</span> q2 <span class=\"sy0\">*</span> q2 <span class=\"sy0\">+</span> q3 <span class=\"sy0\">*</span> q3<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q0 <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br /> q1 <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br /> q2 <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br /> q3 <span class=\"sy0\">*=</span> recipNorm<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getQ</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">float</span> val<span class=\"br0\">&#91;</span>9<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> getValues<span class=\"br0\">&#40;</span>val<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"coMULTI\">/*<br /> DEBUG_PRINT(val[3] * M_PI/180);<br /> DEBUG_PRINT(val[4] * M_PI/180);<br /> DEBUG_PRINT(val[5] * M_PI/180);<br /> DEBUG_PRINT(val[0]);<br /> DEBUG_PRINT(val[1]);<br /> DEBUG_PRINT(val[2]);<br /> DEBUG_PRINT(val[6]);<br /> DEBUG_PRINT(val[7]);<br /> DEBUG_PRINT(val[8]);<br /> */</span><br /> <br /> <br /> now <span class=\"sy0\">=</span> micros<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> sampleFreq <span class=\"sy0\">=</span> 1.0 <span class=\"sy0\">/</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>now <span class=\"sy0\">-</span> lastUpdate<span class=\"br0\">&#41;</span> <span class=\"sy0\">/</span> 1000000.0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> lastUpdate <span class=\"sy0\">=</span> now<span class=\"sy0\">;</span><br /> <span class=\"co1\">// gyro values are expressed in deg/sec, the * M_PI/180 will convert it to radians/sec</span><br /> <span class=\"co1\">//AHRSupdate(val[3] * M_PI/180, val[4] * M_PI/180, val[5] * M_PI/180, val[0], val[1], val[2], val[6], val[7], val[8]);</span><br /> <span class=\"co1\">// use the call below when using a 6DOF IMU</span><br /> AHRSupdate<span class=\"br0\">&#40;</span>val<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> M_PI<span class=\"sy0\">/</span>180<span class=\"sy0\">,</span> val<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> M_PI<span class=\"sy0\">/</span>180<span class=\"sy0\">,</span> val<span class=\"br0\">&#91;</span>5<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> M_PI<span class=\"sy0\">/</span>180<span class=\"sy0\">,</span> val<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> val<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> val<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 0<span class=\"sy0\">,</span> 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> q0<span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> q1<span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> q2<span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> q3<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Returns the Euler angles in radians defined with the Aerospace sequence.</span><br /><span class=\"co1\">// See Sebastian O.H. Madwick report </span><br /><span class=\"co1\">// &quot;An efficient orientation filter for inertial and intertial/magnetic sensor arrays&quot; Chapter 2 Quaternion representation</span><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getEuler</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> angles<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /><span class=\"kw4\">float</span> q<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">// quaternion</span><br /> getQ<span class=\"br0\">&#40;</span>q<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> angles<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> atan2<span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 1<span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span> <span class=\"co1\">// psi</span><br /> angles<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>asin<span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span> <span class=\"co1\">// theta</span><br /> angles<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> atan2<span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 1<span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span> <span class=\"co1\">// phi</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getAngles</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> angles<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">float</span> a<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">//Euler</span><br /> getEuler<span class=\"br0\">&#40;</span>a<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> angles<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> a<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> angles<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> a<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> angles<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> a<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;</span> 0<span class=\"br0\">&#41;</span>angles<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> <span class=\"nu0\">360</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;</span> 0<span class=\"br0\">&#41;</span>angles<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> <span class=\"nu0\">360</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">if</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;</span> 0<span class=\"br0\">&#41;</span>angles<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">+=</span> <span class=\"nu0\">360</span><span class=\"sy0\">;</span><br /><br /><span class=\"br0\">&#125;</span><br /><br /><br /><br /><br /><br /><span class=\"kw4\">void</span> FreeSixIMU<span class=\"sy0\">::</span><span class=\"me2\">getYawPitchRoll</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> ypr<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">float</span> q<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">// quaternion</span><br /> <span class=\"kw4\">float</span> gx<span class=\"sy0\">,</span> gy<span class=\"sy0\">,</span> gz<span class=\"sy0\">;</span> <span class=\"co1\">// estimated gravity direction</span><br /> getQ<span class=\"br0\">&#40;</span>q<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> gx <span class=\"sy0\">=</span> 2 <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> gy <span class=\"sy0\">=</span> 2 <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span>q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> gz <span class=\"sy0\">=</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> <br /> ypr<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> atan2<span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">,</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">+</span> 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">-</span> 1<span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span><br /> ypr<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> atan<span class=\"br0\">&#40;</span>gx <span class=\"sy0\">/</span> sqrt<span class=\"br0\">&#40;</span>gy<span class=\"sy0\">*</span>gy <span class=\"sy0\">+</span> gz<span class=\"sy0\">*</span>gz<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span><br /> ypr<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">=</span> atan<span class=\"br0\">&#40;</span>gy <span class=\"sy0\">/</span> sqrt<span class=\"br0\">&#40;</span>gx<span class=\"sy0\">*</span>gx <span class=\"sy0\">+</span> gz<span class=\"sy0\">*</span>gz<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">*</span> 180<span class=\"sy0\">/</span>M_PI<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">float</span> invSqrt<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> number<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw4\">volatile</span> <span class=\"kw4\">long</span> i<span class=\"sy0\">;</span><br /> <span class=\"kw4\">volatile</span> <span class=\"kw4\">float</span> x<span class=\"sy0\">,</span> y<span class=\"sy0\">;</span><br /> <span class=\"kw4\">volatile</span> <span class=\"kw4\">const</span> <span class=\"kw4\">float</span> f <span class=\"sy0\">=</span> <span class=\"nu17\">1.5F</span><span class=\"sy0\">;</span><br /><br /> x <span class=\"sy0\">=</span> number <span class=\"sy0\">*</span> <span class=\"nu17\">0.5F</span><span class=\"sy0\">;</span><br /> y <span class=\"sy0\">=</span> number<span class=\"sy0\">;</span><br /> i <span class=\"sy0\">=</span> <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span> <span class=\"kw4\">long</span> <span class=\"sy0\">*</span> <span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span>y<span class=\"sy0\">;</span><br /> i <span class=\"sy0\">=</span> 0x5f375a86 <span class=\"sy0\">-</span> <span class=\"br0\">&#40;</span> i <span class=\"sy0\">&gt;&gt;</span> 1 <span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> y <span class=\"sy0\">=</span> <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span> <span class=\"kw4\">float</span> <span class=\"sy0\">*</span> <span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;</span>i<span class=\"sy0\">;</span><br /> y <span class=\"sy0\">=</span> y <span class=\"sy0\">*</span> <span class=\"br0\">&#40;</span> f <span class=\"sy0\">-</span> <span class=\"br0\">&#40;</span> x <span class=\"sy0\">*</span> y <span class=\"sy0\">*</span> y <span class=\"br0\">&#41;</span> <span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">return</span> y<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"afcb431e16337e108dff5a931743db982cea13b5\">  <p class=\"fileHead\">FreeSixIMU.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"coMULTI\">/*<br />FreeSixIMU.h - A libre and easy to use orientation sensing library for Arduino<br />Copyright (C) 2011 Fabio Varesano &lt;fabio at varesano dot net&gt;<br /><br />Development of this code has been supported by the Department of Computer Science,<br />Universita\' degli Studi di Torino, Italy within the Piemonte Project<br />http://www.piemonte.di.unito.it/<br /><br /><br />This program is free software: you can redistribute it and/or modify<br />it under the terms of the version 3 GNU General Public License as<br />published by the Free Software Foundation.<br /><br />This program is distributed in the hope that it will be useful,<br />but WITHOUT ANY WARRANTY; without even the implied warranty of<br />MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />GNU General Public License for more details.<br /><br />You should have received a copy of the GNU General Public License<br />along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><span class=\"co2\">#include &quot;Arduino.h&quot;</span><br /><br /><span class=\"co2\">#include &lt;FIMU_ADXL345.h&gt;</span><br /><span class=\"co2\">#define FIMU_ACC_ADDR ADXL345_ADDR_ALT_LOW // SDO connected to GND</span><br /><span class=\"co2\">#include &lt;FIMU_ITG3200.h&gt;</span><br /><br /><br /><span class=\"co2\">#ifndef FreeSixIMU_h</span><br /><span class=\"co2\">#define FreeSixIMU_h</span><br /><br /><br /><span class=\"co2\">#define FIMU_BMA180_DEF_ADDR BMA180_ADDRESS_SDO_LOW</span><br /><span class=\"co2\">#define FIMU_ITG3200_DEF_ADDR ITG3200_ADDR_AD0_LOW // AD0 connected to GND</span><br /><span class=\"co1\">// HMC5843 address is fixed so don\'t bother to define it</span><br /><br /><br /><span class=\"co2\">#define twoKpDef (2.0f * 0.5f) // 2 * proportional gain</span><br /><span class=\"co2\">#define twoKiDef (2.0f * 0.1f) // 2 * integral gain</span><br /><br /><span class=\"co2\">#ifndef cbi</span><br /><span class=\"co2\">#define cbi(sfr, bit) (_SFR_BYTE(sfr) &amp;= ~_BV(bit))</span><br /><span class=\"co2\">#endif</span><br /><br />class FreeSixIMU<br /><span class=\"br0\">&#123;</span><br /> public<span class=\"sy0\">:</span><br />  FreeSixIMU<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span>bool fastmode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> init<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> acc_addr<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> gyro_addr<span class=\"sy0\">,</span> bool fastmode<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getRawValues<span class=\"br0\">&#40;</span><span class=\"kw4\">int</span> <span class=\"sy0\">*</span> raw_values<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getValues<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> values<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getQ<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getEuler<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> angles<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getYawPitchRoll<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> ypr<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw4\">void</span> getAngles<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> <span class=\"sy0\">*</span> angles<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  <br />    ADXL345 acc<span class=\"sy0\">;</span><br />  ITG3200 gyro<span class=\"sy0\">;</span><br />  <br />  <span class=\"kw4\">int</span><span class=\"sy0\">*</span> raw_acc<span class=\"sy0\">,</span> raw_gyro<span class=\"sy0\">,</span> raw_magn<span class=\"sy0\">;</span><br />  <br /> private<span class=\"sy0\">:</span><br />  <span class=\"kw4\">void</span> AHRSupdate<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> gx<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> gy<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> gz<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> ax<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> ay<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> az<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> mx<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> my<span class=\"sy0\">,</span> <span class=\"kw4\">float</span> mz<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"co1\">//float q0, q1, q2, q3; // quaternion elements representing the estimated orientation</span><br />  <span class=\"kw4\">float</span> iq0<span class=\"sy0\">,</span> iq1<span class=\"sy0\">,</span> iq2<span class=\"sy0\">,</span> iq3<span class=\"sy0\">;</span><br />  <span class=\"kw4\">float</span> exInt<span class=\"sy0\">,</span> eyInt<span class=\"sy0\">,</span> ezInt<span class=\"sy0\">;</span> <span class=\"co1\">// scaled integral error</span><br />  <span class=\"kw4\">volatile</span> <span class=\"kw4\">float</span> twoKp<span class=\"sy0\">;</span>   <span class=\"co1\">// 2 * proportional gain (Kp)</span><br />  <span class=\"kw4\">volatile</span> <span class=\"kw4\">float</span> twoKi<span class=\"sy0\">;</span>   <span class=\"co1\">// 2 * integral gain (Ki)</span><br />  <span class=\"kw4\">volatile</span> <span class=\"kw4\">float</span> q0<span class=\"sy0\">,</span> q1<span class=\"sy0\">,</span> q2<span class=\"sy0\">,</span> q3<span class=\"sy0\">;</span> <span class=\"co1\">// quaternion of sensor frame relative to auxiliary frame</span><br />  <span class=\"kw4\">volatile</span> <span class=\"kw4\">float</span> integralFBx<span class=\"sy0\">,</span> integralFBy<span class=\"sy0\">,</span> integralFBz<span class=\"sy0\">;</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">long</span> lastUpdate<span class=\"sy0\">,</span> now<span class=\"sy0\">;</span> <span class=\"co1\">// sample period expressed in milliseconds</span><br />  <span class=\"kw4\">float</span> sampleFreq<span class=\"sy0\">;</span> <span class=\"co1\">// half the sample period expressed in seconds</span><br />  <span class=\"kw4\">int</span> startLoopTime<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"kw4\">float</span> invSqrt<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> number<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co2\">#endif // FreeSixIMU_h</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"94a9ed024d3859793618152ea559a168bbcbb5e2\">  <p class=\"fileHead\">LICENSE.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />335<br />336<br />337<br />338<br />339<br />340<br />341<br />342<br />343<br />344<br />345<br />346<br />347<br />348<br />349<br />350<br />351<br />352<br />353<br />354<br />355<br />356<br />357<br />358<br />359<br />360<br />361<br />362<br />363<br />364<br />365<br />366<br />367<br />368<br />369<br />370<br />371<br />372<br />373<br />374<br />375<br />376<br />377<br />378<br />379<br />380<br />381<br />382<br />383<br />384<br />385<br />386<br />387<br />388<br />389<br />390<br />391<br />392<br />393<br />394<br />395<br />396<br />397<br />398<br />399<br />400<br />401<br />402<br />403<br />404<br />405<br />406<br />407<br />408<br />409<br />410<br />411<br />412<br />413<br />414<br />415<br />416<br />417<br />418<br />419<br />420<br />421<br />422<br />423<br />424<br />425<br />426<br />427<br />428<br />429<br />430<br />431<br />432<br />433<br />434<br />435<br />436<br />437<br />438<br />439<br />440<br />441<br />442<br />443<br />444<br />445<br />446<br />447<br />448<br />449<br />450<br />451<br />452<br />453<br />454<br />455<br />456<br />457<br />458<br />459<br />460<br />461<br />462<br />463<br />464<br />465<br />466<br />467<br />468<br />469<br />470<br />471<br />472<br />473<br />474<br />475<br />476<br />477<br />478<br />479<br />480<br />481<br />482<br />483<br />484<br />485<br />486<br />487<br />488<br />489<br />490<br />491<br />492<br />493<br />494<br />495<br />496<br />497<br />498<br />499<br />500<br />501<br />502<br />503<br />504<br />505<br />506<br />507<br />508<br />509<br />510<br />511<br />512<br />513<br />514<br />515<br />516<br />517<br />518<br />519<br />520<br />521<br />522<br />523<br />524<br />525<br />526<br />527<br />528<br />529<br />530<br />531<br />532<br />533<br />534<br />535<br />536<br />537<br />538<br />539<br />540<br />541<br />542<br />543<br />544<br />545<br />546<br />547<br />548<br />549<br />550<br />551<br />552<br />553<br />554<br />555<br />556<br />557<br />558<br />559<br />560<br />561<br />562<br />563<br />564<br />565<br />566<br />567<br />568<br />569<br />570<br />571<br />572<br />573<br />574<br />575<br />576<br />577<br />578<br />579<br />580<br />581<br />582<br />583<br />584<br />585<br />586<br />587<br />588<br />589<br />590<br />591<br />592<br />593<br />594<br />595<br />596<br />597<br />598<br />599<br />600<br />601<br />602<br />603<br />604<br />605<br />606<br />607<br />608<br />609<br />610<br />611<br />612<br />613<br />614<br />615<br />616<br />617<br />618<br />619<br />620<br />621<br />622<br />623<br />624<br />625<br />626<br />627<br />628<br />629<br />630<br />631<br />632<br />633<br />634<br />635<br />636<br />637<br />638<br />639<br />640<br />641<br />642<br />643<br />644<br />645<br />646<br />647<br />648<br />649<br />650<br />651<br />652<br />653<br />654<br />655<br />656<br />657<br />658<br />659<br />660<br />661<br />662<br />663<br />664<br />665<br />666<br />667<br />668<br />669<br />670<br />671<br />672<br />673<br />674<br />675<br />676<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>          GNU GENERAL PUBLIC LICENSE<br />           Version 3, 29 June 2007<br /><br />Copyright (C) 2007 Free Software Foundation, Inc. &lt;http://fsf.org/&gt;<br />Everyone is permitted to copy and distribute verbatim copies<br />of this license document, but changing it is not allowed.<br /><br />              Preamble<br /><br /> The GNU General Public License is a free, copyleft license for<br />software and other kinds of works.<br /><br /> The licenses for most software and other practical works are designed<br />to take away your freedom to share and change the works. By contrast,<br />the GNU General Public License is intended to guarantee your freedom to<br />share and change all versions of a program--to make sure it remains free<br />software for all its users. We, the Free Software Foundation, use the<br />GNU General Public License for most of our software; it applies also to<br />any other work released this way by its authors. You can apply it to<br />your programs, too.<br /><br /> When we speak of free software, we are referring to freedom, not<br />price. Our General Public Licenses are designed to make sure that you<br />have the freedom to distribute copies of free software (and charge for<br />them if you wish), that you receive source code or can get it if you<br />want it, that you can change the software or use pieces of it in new<br />free programs, and that you know you can do these things.<br /><br /> To protect your rights, we need to prevent others from denying you<br />these rights or asking you to surrender the rights. Therefore, you have<br />certain responsibilities if you distribute copies of the software, or if<br />you modify it: responsibilities to respect the freedom of others.<br /><br /> For example, if you distribute copies of such a program, whether<br />gratis or for a fee, you must pass on to the recipients the same<br />freedoms that you received. You must make sure that they, too, receive<br />or can get the source code. And you must show them these terms so they<br />know their rights.<br /><br /> Developers that use the GNU GPL protect your rights with two steps:<br />(1) assert copyright on the software, and (2) offer you this License<br />giving you legal permission to copy, distribute and/or modify it.<br /><br /> For the developers\' and authors\' protection, the GPL clearly explains<br />that there is no warranty for this free software. For both users\' and<br />authors\' sake, the GPL requires that modified versions be marked as<br />changed, so that their problems will not be attributed erroneously to<br />authors of previous versions.<br /><br /> Some devices are designed to deny users access to install or run<br />modified versions of the software inside them, although the manufacturer<br />can do so. This is fundamentally incompatible with the aim of<br />protecting users\' freedom to change the software. The systematic<br />pattern of such abuse occurs in the area of products for individuals to<br />use, which is precisely where it is most unacceptable. Therefore, we<br />have designed this version of the GPL to prohibit the practice for those<br />products. If such problems arise substantially in other domains, we<br />stand ready to extend this provision to those domains in future versions<br />of the GPL, as needed to protect the freedom of users.<br /><br /> Finally, every program is threatened constantly by software patents.<br />States should not allow patents to restrict development and use of<br />software on general-purpose computers, but in those that do, we wish to<br />avoid the special danger that patents applied to a free program could<br />make it effectively proprietary. To prevent this, the GPL assures that<br />patents cannot be used to render the program non-free.<br /><br /> The precise terms and conditions for copying, distribution and<br />modification follow.<br /><br />           TERMS AND CONDITIONS<br /><br /> 0. Definitions.<br /><br /> &quot;This License&quot; refers to version 3 of the GNU General Public License.<br /><br /> &quot;Copyright&quot; also means copyright-like laws that apply to other kinds of<br />works, such as semiconductor masks.<br /><br /> &quot;The Program&quot; refers to any copyrightable work licensed under this<br />License. Each licensee is addressed as &quot;you&quot;. &quot;Licensees&quot; and<br />&quot;recipients&quot; may be individuals or organizations.<br /><br /> To &quot;modify&quot; a work means to copy from or adapt all or part of the work<br />in a fashion requiring copyright permission, other than the making of an<br />exact copy. The resulting work is called a &quot;modified version&quot; of the<br />earlier work or a work &quot;based on&quot; the earlier work.<br /><br /> A &quot;covered work&quot; means either the unmodified Program or a work based<br />on the Program.<br /><br /> To &quot;propagate&quot; a work means to do anything with it that, without<br />permission, would make you directly or secondarily liable for<br />infringement under applicable copyright law, except executing it on a<br />computer or modifying a private copy. Propagation includes copying,<br />distribution (with or without modification), making available to the<br />public, and in some countries other activities as well.<br /><br /> To &quot;convey&quot; a work means any kind of propagation that enables other<br />parties to make or receive copies. Mere interaction with a user through<br />a computer network, with no transfer of a copy, is not conveying.<br /><br /> An interactive user interface displays &quot;Appropriate Legal Notices&quot;<br />to the extent that it includes a convenient and prominently visible<br />feature that (1) displays an appropriate copyright notice, and (2)<br />tells the user that there is no warranty for the work (except to the<br />extent that warranties are provided), that licensees may convey the<br />work under this License, and how to view a copy of this License. If<br />the interface presents a list of user commands or options, such as a<br />menu, a prominent item in the list meets this criterion.<br /><br /> 1. Source Code.<br /><br /> The &quot;source code&quot; for a work means the preferred form of the work<br />for making modifications to it. &quot;Object code&quot; means any non-source<br />form of a work.<br /><br /> A &quot;Standard Interface&quot; means an interface that either is an official<br />standard defined by a recognized standards body, or, in the case of<br />interfaces specified for a particular programming language, one that<br />is widely used among developers working in that language.<br /><br /> The &quot;System Libraries&quot; of an executable work include anything, other<br />than the work as a whole, that (a) is included in the normal form of<br />packaging a Major Component, but which is not part of that Major<br />Component, and (b) serves only to enable use of the work with that<br />Major Component, or to implement a Standard Interface for which an<br />implementation is available to the public in source code form. A<br />&quot;Major Component&quot;, in this context, means a major essential component<br />(kernel, window system, and so on) of the specific operating system<br />(if any) on which the executable work runs, or a compiler used to<br />produce the work, or an object code interpreter used to run it.<br /><br /> The &quot;Corresponding Source&quot; for a work in object code form means all<br />the source code needed to generate, install, and (for an executable<br />work) run the object code and to modify the work, including scripts to<br />control those activities. However, it does not include the work\'s<br />System Libraries, or general-purpose tools or generally available free<br />programs which are used unmodified in performing those activities but<br />which are not part of the work. For example, Corresponding Source<br />includes interface definition files associated with source files for<br />the work, and the source code for shared libraries and dynamically<br />linked subprograms that the work is specifically designed to require,<br />such as by intimate data communication or control flow between those<br />subprograms and other parts of the work.<br /><br /> The Corresponding Source need not include anything that users<br />can regenerate automatically from other parts of the Corresponding<br />Source.<br /><br /> The Corresponding Source for a work in source code form is that<br />same work.<br /><br /> 2. Basic Permissions.<br /><br /> All rights granted under this License are granted for the term of<br />copyright on the Program, and are irrevocable provided the stated<br />conditions are met. This License explicitly affirms your unlimited<br />permission to run the unmodified Program. The output from running a<br />covered work is covered by this License only if the output, given its<br />content, constitutes a covered work. This License acknowledges your<br />rights of fair use or other equivalent, as provided by copyright law.<br /><br /> You may make, run and propagate covered works that you do not<br />convey, without conditions so long as your license otherwise remains<br />in force. You may convey covered works to others for the sole purpose<br />of having them make modifications exclusively for you, or provide you<br />with facilities for running those works, provided that you comply with<br />the terms of this License in conveying all material for which you do<br />not control copyright. Those thus making or running the covered works<br />for you must do so exclusively on your behalf, under your direction<br />and control, on terms that prohibit them from making any copies of<br />your copyrighted material outside their relationship with you.<br /><br /> Conveying under any other circumstances is permitted solely under<br />the conditions stated below. Sublicensing is not allowed; section 10<br />makes it unnecessary.<br /><br /> 3. Protecting Users\' Legal Rights From Anti-Circumvention Law.<br /><br /> No covered work shall be deemed part of an effective technological<br />measure under any applicable law fulfilling obligations under article<br />11 of the WIPO copyright treaty adopted on 20 December 1996, or<br />similar laws prohibiting or restricting circumvention of such<br />measures.<br /><br /> When you convey a covered work, you waive any legal power to forbid<br />circumvention of technological measures to the extent such circumvention<br />is effected by exercising rights under this License with respect to<br />the covered work, and you disclaim any intention to limit operation or<br />modification of the work as a means of enforcing, against the work\'s<br />users, your or third parties\' legal rights to forbid circumvention of<br />technological measures.<br /><br /> 4. Conveying Verbatim Copies.<br /><br /> You may convey verbatim copies of the Program\'s source code as you<br />receive it, in any medium, provided that you conspicuously and<br />appropriately publish on each copy an appropriate copyright notice;<br />keep intact all notices stating that this License and any<br />non-permissive terms added in accord with section 7 apply to the code;<br />keep intact all notices of the absence of any warranty; and give all<br />recipients a copy of this License along with the Program.<br /><br /> You may charge any price or no price for each copy that you convey,<br />and you may offer support or warranty protection for a fee.<br /><br /> 5. Conveying Modified Source Versions.<br /><br /> You may convey a work based on the Program, or the modifications to<br />produce it from the Program, in the form of source code under the<br />terms of section 4, provided that you also meet all of these conditions:<br /><br />  a) The work must carry prominent notices stating that you modified<br />  it, and giving a relevant date.<br /><br />  b) The work must carry prominent notices stating that it is<br />  released under this License and any conditions added under section<br />  7. This requirement modifies the requirement in section 4 to<br />  &quot;keep intact all notices&quot;.<br /><br />  c) You must license the entire work, as a whole, under this<br />  License to anyone who comes into possession of a copy. This<br />  License will therefore apply, along with any applicable section 7<br />  additional terms, to the whole of the work, and all its parts,<br />  regardless of how they are packaged. This License gives no<br />  permission to license the work in any other way, but it does not<br />  invalidate such permission if you have separately received it.<br /><br />  d) If the work has interactive user interfaces, each must display<br />  Appropriate Legal Notices; however, if the Program has interactive<br />  interfaces that do not display Appropriate Legal Notices, your<br />  work need not make them do so.<br /><br /> A compilation of a covered work with other separate and independent<br />works, which are not by their nature extensions of the covered work,<br />and which are not combined with it such as to form a larger program,<br />in or on a volume of a storage or distribution medium, is called an<br />&quot;aggregate&quot; if the compilation and its resulting copyright are not<br />used to limit the access or legal rights of the compilation\'s users<br />beyond what the individual works permit. Inclusion of a covered work<br />in an aggregate does not cause this License to apply to the other<br />parts of the aggregate.<br /><br /> 6. Conveying Non-Source Forms.<br /><br /> You may convey a covered work in object code form under the terms<br />of sections 4 and 5, provided that you also convey the<br />machine-readable Corresponding Source under the terms of this License,<br />in one of these ways:<br /><br />  a) Convey the object code in, or embodied in, a physical product<br />  (including a physical distribution medium), accompanied by the<br />  Corresponding Source fixed on a durable physical medium<br />  customarily used for software interchange.<br /><br />  b) Convey the object code in, or embodied in, a physical product<br />  (including a physical distribution medium), accompanied by a<br />  written offer, valid for at least three years and valid for as<br />  long as you offer spare parts or customer support for that product<br />  model, to give anyone who possesses the object code either (1) a<br />  copy of the Corresponding Source for all the software in the<br />  product that is covered by this License, on a durable physical<br />  medium customarily used for software interchange, for a price no<br />  more than your reasonable cost of physically performing this<br />  conveying of source, or (2) access to copy the<br />  Corresponding Source from a network server at no charge.<br /><br />  c) Convey individual copies of the object code with a copy of the<br />  written offer to provide the Corresponding Source. This<br />  alternative is allowed only occasionally and noncommercially, and<br />  only if you received the object code with such an offer, in accord<br />  with subsection 6b.<br /><br />  d) Convey the object code by offering access from a designated<br />  place (gratis or for a charge), and offer equivalent access to the<br />  Corresponding Source in the same way through the same place at no<br />  further charge. You need not require recipients to copy the<br />  Corresponding Source along with the object code. If the place to<br />  copy the object code is a network server, the Corresponding Source<br />  may be on a different server (operated by you or a third party)<br />  that supports equivalent copying facilities, provided you maintain<br />  clear directions next to the object code saying where to find the<br />  Corresponding Source. Regardless of what server hosts the<br />  Corresponding Source, you remain obligated to ensure that it is<br />  available for as long as needed to satisfy these requirements.<br /><br />  e) Convey the object code using peer-to-peer transmission, provided<br />  you inform other peers where the object code and Corresponding<br />  Source of the work are being offered to the general public at no<br />  charge under subsection 6d.<br /><br /> A separable portion of the object code, whose source code is excluded<br />from the Corresponding Source as a System Library, need not be<br />included in conveying the object code work.<br /><br /> A &quot;User Product&quot; is either (1) a &quot;consumer product&quot;, which means any<br />tangible personal property which is normally used for personal, family,<br />or household purposes, or (2) anything designed or sold for incorporation<br />into a dwelling. In determining whether a product is a consumer product,<br />doubtful cases shall be resolved in favor of coverage. For a particular<br />product received by a particular user, &quot;normally used&quot; refers to a<br />typical or common use of that class of product, regardless of the status<br />of the particular user or of the way in which the particular user<br />actually uses, or expects or is expected to use, the product. A product<br />is a consumer product regardless of whether the product has substantial<br />commercial, industrial or non-consumer uses, unless such uses represent<br />the only significant mode of use of the product.<br /><br /> &quot;Installation Information&quot; for a User Product means any methods,<br />procedures, authorization keys, or other information required to install<br />and execute modified versions of a covered work in that User Product from<br />a modified version of its Corresponding Source. The information must<br />suffice to ensure that the continued functioning of the modified object<br />code is in no case prevented or interfered with solely because<br />modification has been made.<br /><br /> If you convey an object code work under this section in, or with, or<br />specifically for use in, a User Product, and the conveying occurs as<br />part of a transaction in which the right of possession and use of the<br />User Product is transferred to the recipient in perpetuity or for a<br />fixed term (regardless of how the transaction is characterized), the<br />Corresponding Source conveyed under this section must be accompanied<br />by the Installation Information. But this requirement does not apply<br />if neither you nor any third party retains the ability to install<br />modified object code on the User Product (for example, the work has<br />been installed in ROM).<br /><br /> The requirement to provide Installation Information does not include a<br />requirement to continue to provide support service, warranty, or updates<br />for a work that has been modified or installed by the recipient, or for<br />the User Product in which it has been modified or installed. Access to a<br />network may be denied when the modification itself materially and<br />adversely affects the operation of the network or violates the rules and<br />protocols for communication across the network.<br /><br /> Corresponding Source conveyed, and Installation Information provided,<br />in accord with this section must be in a format that is publicly<br />documented (and with an implementation available to the public in<br />source code form), and must require no special password or key for<br />unpacking, reading or copying.<br /><br /> 7. Additional Terms.<br /><br /> &quot;Additional permissions&quot; are terms that supplement the terms of this<br />License by making exceptions from one or more of its conditions.<br />Additional permissions that are applicable to the entire Program shall<br />be treated as though they were included in this License, to the extent<br />that they are valid under applicable law. If additional permissions<br />apply only to part of the Program, that part may be used separately<br />under those permissions, but the entire Program remains governed by<br />this License without regard to the additional permissions.<br /><br /> When you convey a copy of a covered work, you may at your option<br />remove any additional permissions from that copy, or from any part of<br />it. (Additional permissions may be written to require their own<br />removal in certain cases when you modify the work.) You may place<br />additional permissions on material, added by you to a covered work,<br />for which you have or can give appropriate copyright permission.<br /><br /> Notwithstanding any other provision of this License, for material you<br />add to a covered work, you may (if authorized by the copyright holders of<br />that material) supplement the terms of this License with terms:<br /><br />  a) Disclaiming warranty or limiting liability differently from the<br />  terms of sections 15 and 16 of this License; or<br /><br />  b) Requiring preservation of specified reasonable legal notices or<br />  author attributions in that material or in the Appropriate Legal<br />  Notices displayed by works containing it; or<br /><br />  c) Prohibiting misrepresentation of the origin of that material, or<br />  requiring that modified versions of such material be marked in<br />  reasonable ways as different from the original version; or<br /><br />  d) Limiting the use for publicity purposes of names of licensors or<br />  authors of the material; or<br /><br />  e) Declining to grant rights under trademark law for use of some<br />  trade names, trademarks, or service marks; or<br /><br />  f) Requiring indemnification of licensors and authors of that<br />  material by anyone who conveys the material (or modified versions of<br />  it) with contractual assumptions of liability to the recipient, for<br />  any liability that these contractual assumptions directly impose on<br />  those licensors and authors.<br /><br /> All other non-permissive additional terms are considered &quot;further<br />restrictions&quot; within the meaning of section 10. If the Program as you<br />received it, or any part of it, contains a notice stating that it is<br />governed by this License along with a term that is a further<br />restriction, you may remove that term. If a license document contains<br />a further restriction but permits relicensing or conveying under this<br />License, you may add to a covered work material governed by the terms<br />of that license document, provided that the further restriction does<br />not survive such relicensing or conveying.<br /><br /> If you add terms to a covered work in accord with this section, you<br />must place, in the relevant source files, a statement of the<br />additional terms that apply to those files, or a notice indicating<br />where to find the applicable terms.<br /><br /> Additional terms, permissive or non-permissive, may be stated in the<br />form of a separately written license, or stated as exceptions;<br />the above requirements apply either way.<br /><br /> 8. Termination.<br /><br /> You may not propagate or modify a covered work except as expressly<br />provided under this License. Any attempt otherwise to propagate or<br />modify it is void, and will automatically terminate your rights under<br />this License (including any patent licenses granted under the third<br />paragraph of section 11).<br /><br /> However, if you cease all violation of this License, then your<br />license from a particular copyright holder is reinstated (a)<br />provisionally, unless and until the copyright holder explicitly and<br />finally terminates your license, and (b) permanently, if the copyright<br />holder fails to notify you of the violation by some reasonable means<br />prior to 60 days after the cessation.<br /><br /> Moreover, your license from a particular copyright holder is<br />reinstated permanently if the copyright holder notifies you of the<br />violation by some reasonable means, this is the first time you have<br />received notice of violation of this License (for any work) from that<br />copyright holder, and you cure the violation prior to 30 days after<br />your receipt of the notice.<br /><br /> Termination of your rights under this section does not terminate the<br />licenses of parties who have received copies or rights from you under<br />this License. If your rights have been terminated and not permanently<br />reinstated, you do not qualify to receive new licenses for the same<br />material under section 10.<br /><br /> 9. Acceptance Not Required for Having Copies.<br /><br /> You are not required to accept this License in order to receive or<br />run a copy of the Program. Ancillary propagation of a covered work<br />occurring solely as a consequence of using peer-to-peer transmission<br />to receive a copy likewise does not require acceptance. However,<br />nothing other than this License grants you permission to propagate or<br />modify any covered work. These actions infringe copyright if you do<br />not accept this License. Therefore, by modifying or propagating a<br />covered work, you indicate your acceptance of this License to do so.<br /><br /> 10. Automatic Licensing of Downstream Recipients.<br /><br /> Each time you convey a covered work, the recipient automatically<br />receives a license from the original licensors, to run, modify and<br />propagate that work, subject to this License. You are not responsible<br />for enforcing compliance by third parties with this License.<br /><br /> An &quot;entity transaction&quot; is a transaction transferring control of an<br />organization, or substantially all assets of one, or subdividing an<br />organization, or merging organizations. If propagation of a covered<br />work results from an entity transaction, each party to that<br />transaction who receives a copy of the work also receives whatever<br />licenses to the work the party\'s predecessor in interest had or could<br />give under the previous paragraph, plus a right to possession of the<br />Corresponding Source of the work from the predecessor in interest, if<br />the predecessor has it or can get it with reasonable efforts.<br /><br /> You may not impose any further restrictions on the exercise of the<br />rights granted or affirmed under this License. For example, you may<br />not impose a license fee, royalty, or other charge for exercise of<br />rights granted under this License, and you may not initiate litigation<br />(including a cross-claim or counterclaim in a lawsuit) alleging that<br />any patent claim is infringed by making, using, selling, offering for<br />sale, or importing the Program or any portion of it.<br /><br /> 11. Patents.<br /><br /> A &quot;contributor&quot; is a copyright holder who authorizes use under this<br />License of the Program or a work on which the Program is based. The<br />work thus licensed is called the contributor\'s &quot;contributor version&quot;.<br /><br /> A contributor\'s &quot;essential patent claims&quot; are all patent claims<br />owned or controlled by the contributor, whether already acquired or<br />hereafter acquired, that would be infringed by some manner, permitted<br />by this License, of making, using, or selling its contributor version,<br />but do not include claims that would be infringed only as a<br />consequence of further modification of the contributor version. For<br />purposes of this definition, &quot;control&quot; includes the right to grant<br />patent sublicenses in a manner consistent with the requirements of<br />this License.<br /><br /> Each contributor grants you a non-exclusive, worldwide, royalty-free<br />patent license under the contributor\'s essential patent claims, to<br />make, use, sell, offer for sale, import and otherwise run, modify and<br />propagate the contents of its contributor version.<br /><br /> In the following three paragraphs, a &quot;patent license&quot; is any express<br />agreement or commitment, however denominated, not to enforce a patent<br />(such as an express permission to practice a patent or covenant not to<br />sue for patent infringement). To &quot;grant&quot; such a patent license to a<br />party means to make such an agreement or commitment not to enforce a<br />patent against the party.<br /><br /> If you convey a covered work, knowingly relying on a patent license,<br />and the Corresponding Source of the work is not available for anyone<br />to copy, free of charge and under the terms of this License, through a<br />publicly available network server or other readily accessible means,<br />then you must either (1) cause the Corresponding Source to be so<br />available, or (2) arrange to deprive yourself of the benefit of the<br />patent license for this particular work, or (3) arrange, in a manner<br />consistent with the requirements of this License, to extend the patent<br />license to downstream recipients. &quot;Knowingly relying&quot; means you have<br />actual knowledge that, but for the patent license, your conveying the<br />covered work in a country, or your recipient\'s use of the covered work<br />in a country, would infringe one or more identifiable patents in that<br />country that you have reason to believe are valid.<br /><br /> If, pursuant to or in connection with a single transaction or<br />arrangement, you convey, or propagate by procuring conveyance of, a<br />covered work, and grant a patent license to some of the parties<br />receiving the covered work authorizing them to use, propagate, modify<br />or convey a specific copy of the covered work, then the patent license<br />you grant is automatically extended to all recipients of the covered<br />work and works based on it.<br /><br /> A patent license is &quot;discriminatory&quot; if it does not include within<br />the scope of its coverage, prohibits the exercise of, or is<br />conditioned on the non-exercise of one or more of the rights that are<br />specifically granted under this License. You may not convey a covered<br />work if you are a party to an arrangement with a third party that is<br />in the business of distributing software, under which you make payment<br />to the third party based on the extent of your activity of conveying<br />the work, and under which the third party grants, to any of the<br />parties who would receive the covered work from you, a discriminatory<br />patent license (a) in connection with copies of the covered work<br />conveyed by you (or copies made from those copies), or (b) primarily<br />for and in connection with specific products or compilations that<br />contain the covered work, unless you entered into that arrangement,<br />or that patent license was granted, prior to 28 March 2007.<br /><br /> Nothing in this License shall be construed as excluding or limiting<br />any implied license or other defenses to infringement that may<br />otherwise be available to you under applicable patent law.<br /><br /> 12. No Surrender of Others\' Freedom.<br /><br /> If conditions are imposed on you (whether by court order, agreement or<br />otherwise) that contradict the conditions of this License, they do not<br />excuse you from the conditions of this License. If you cannot convey a<br />covered work so as to satisfy simultaneously your obligations under this<br />License and any other pertinent obligations, then as a consequence you may<br />not convey it at all. For example, if you agree to terms that obligate you<br />to collect a royalty for further conveying from those to whom you convey<br />the Program, the only way you could satisfy both those terms and this<br />License would be to refrain entirely from conveying the Program.<br /><br /> 13. Use with the GNU Affero General Public License.<br /><br /> Notwithstanding any other provision of this License, you have<br />permission to link or combine any covered work with a work licensed<br />under version 3 of the GNU Affero General Public License into a single<br />combined work, and to convey the resulting work. The terms of this<br />License will continue to apply to the part which is the covered work,<br />but the special requirements of the GNU Affero General Public License,<br />section 13, concerning interaction through a network will apply to the<br />combination as such.<br /><br /> 14. Revised Versions of this License.<br /><br /> The Free Software Foundation may publish revised and/or new versions of<br />the GNU General Public License from time to time. Such new versions will<br />be similar in spirit to the present version, but may differ in detail to<br />address new problems or concerns.<br /><br /> Each version is given a distinguishing version number. If the<br />Program specifies that a certain numbered version of the GNU General<br />Public License &quot;or any later version&quot; applies to it, you have the<br />option of following the terms and conditions either of that numbered<br />version or of any later version published by the Free Software<br />Foundation. If the Program does not specify a version number of the<br />GNU General Public License, you may choose any version ever published<br />by the Free Software Foundation.<br /><br /> If the Program specifies that a proxy can decide which future<br />versions of the GNU General Public License can be used, that proxy\'s<br />public statement of acceptance of a version permanently authorizes you<br />to choose that version for the Program.<br /><br /> Later license versions may give you additional or different<br />permissions. However, no additional obligations are imposed on any<br />author or copyright holder as a result of your choosing to follow a<br />later version.<br /><br /> 15. Disclaimer of Warranty.<br /><br /> THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY<br />APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT<br />HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM &quot;AS IS&quot; WITHOUT WARRANTY<br />OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,<br />THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR<br />PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM<br />IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF<br />ALL NECESSARY SERVICING, REPAIR OR CORRECTION.<br /><br /> 16. Limitation of Liability.<br /><br /> IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING<br />WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS<br />THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY<br />GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE<br />USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF<br />DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD<br />PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),<br />EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF<br />SUCH DAMAGES.<br /><br /> 17. Interpretation of Sections 15 and 16.<br /><br /> If the disclaimer of warranty and limitation of liability provided<br />above cannot be given local legal effect according to their terms,<br />reviewing courts shall apply local law that most closely approximates<br />an absolute waiver of all civil liability in connection with the<br />Program, unless a warranty or assumption of liability accompanies a<br />copy of the Program in return for a fee.<br /><br />          END OF TERMS AND CONDITIONS<br /><br />      How to Apply These Terms to Your New Programs<br /><br /> If you develop a new program, and you want it to be of the greatest<br />possible use to the public, the best way to achieve this is to make it<br />free software which everyone can redistribute and change under these terms.<br /><br /> To do so, attach the following notices to the program. It is safest<br />to attach them to the start of each source file to most effectively<br />state the exclusion of warranty; and each file should have at least<br />the &quot;copyright&quot; line and a pointer to where the full notice is found.<br /><br />  &lt;one line to give the program\'s name and a brief idea of what it does.&gt;<br />  Copyright (C) &lt;year&gt; &lt;name of author&gt;<br /><br />  This program is free software: you can redistribute it and/or modify<br />  it under the terms of the GNU General Public License as published by<br />  the Free Software Foundation, either version 3 of the License, or<br />  (at your option) any later version.<br /><br />  This program is distributed in the hope that it will be useful,<br />  but WITHOUT ANY WARRANTY; without even the implied warranty of<br />  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />  GNU General Public License for more details.<br /><br />  You should have received a copy of the GNU General Public License<br />  along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.<br /><br />Also add information on how to contact you by electronic and paper mail.<br /><br /> If the program does terminal interaction, make it output a short<br />notice like this when it starts in an interactive mode:<br /><br />  &lt;program&gt; Copyright (C) &lt;year&gt; &lt;name of author&gt;<br />  This program comes with ABSOLUTELY NO WARRANTY; for details type `show w\'.<br />  This is free software, and you are welcome to redistribute it<br />  under certain conditions; type `show c\' for details.<br /><br />The hypothetical commands `show w\' and `show c\' should show the appropriate<br />parts of the General Public License. Of course, your program\'s commands<br />might be different; for a GUI interface, you would use an &quot;about box&quot;.<br /><br /> You should also get your employer (if you work as a programmer) or school,<br />if any, to sign a &quot;copyright disclaimer&quot; for the program, if necessary.<br />For more information on this, and how to apply and follow the GNU GPL, see<br />&lt;http://www.gnu.org/licenses/&gt;.<br /><br /> The GNU General Public License does not permit incorporating your program<br />into proprietary programs. If your program is a subroutine library, you<br />may consider it more useful to permit linking proprietary applications with<br />the library. If this is what you want to do, use the GNU Lesser General<br />Public License instead of this License. But first, please read<br />&lt;http://www.gnu.org/philosophy/why-not-lgpl.html&gt;.<br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"b132efea8543fe82d1fd16a19298a9840f395e17\">  <p class=\"fileHead\">License.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>Copyright (c) 2010 bildr community<br /><br />Permission is hereby granted, free of charge, to any person obtaining a copy<br />of this software and associated documentation files (the &quot;Software&quot;), to deal<br />in the Software without restriction, including without limitation the rights<br />to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br />copies of the Software, and to permit persons to whom the Software is<br />furnished to do so, subject to the following conditions:<br /><br />The above copyright notice and this permission notice shall be included in<br />all copies or substantial portions of the Software.<br /><br />THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br />AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br />LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br />OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br />THE SOFTWARE.</code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"b78323cd9155c75d579f36ea335675627d214762\">  <p class=\"fileHead\">FreeSix_cube.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co1\">////////////////////////////////////////////////////////////</span><br /><span class=\"co1\">// Arduino firmware for use with FreeSixCube processing example</span><br /><span class=\"co1\">////////////////////////////////////////////////////////////</span><br /><br /><span class=\"co2\">#include &lt;FreeSixIMU.h&gt;</span><br /><span class=\"co2\">#include &lt;FIMU_ADXL345.h&gt;</span><br /><span class=\"co2\">#include &lt;FIMU_ITG3200.h&gt;</span><br /><br /><span class=\"co2\">#define DEBUG</span><br /><span class=\"co2\">#ifdef DEBUG</span><br /><span class=\"co2\">#include &quot;DebugUtils.h&quot;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co2\">#include &quot;CommunicationUtils.h&quot;</span><br /><span class=\"co2\">#include &quot;FreeSixIMU.h&quot;</span><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><br /><br /><span class=\"kw4\">float</span> q<span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">//hold q values</span><br /><br /><span class=\"co1\">// Set the FreeIMU object</span><br />FreeSixIMU my3IMU <span class=\"sy0\">=</span> FreeSixIMU<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span>115200<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> my3IMU.<span class=\"me1\">init</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> my3IMU.<span class=\"me1\">getQ</span><span class=\"br0\">&#40;</span>q<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> serialPrintFloatArr<span class=\"br0\">&#40;</span>q<span class=\"sy0\">,</span> 4<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//line break</span><br /><br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>60<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper pde\" id=\"68fba1a5c668994ab9d31e8690c17e7a4053f593\">  <p class=\"fileHead\">FreeSix_cube.pde</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"kw13\">import</span> processing.<span class=\"me1\">serial</span>.<span class=\"sy0\">*;</span><br /><br />Serial myPort<span class=\"sy0\">;</span> <span class=\"co1\">// Create object from Serial class</span><br /><br /><span class=\"kw6\">final</span> <span class=\"kw3\">String</span> serialPort = <span class=\"st0\">&quot;/dev/tty.usbmodem621&quot;</span><span class=\"sy0\">;</span> <span class=\"co1\">// replace this with your serial port. On windows you will need something like &quot;COM1&quot;.</span><br /><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> q = <span class=\"kw12\">new</span> <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> hq = <span class=\"kw5\">null</span><span class=\"sy0\">;</span><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> Euler = <span class=\"kw12\">new</span> <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">// psi, theta, phi</span><br /><br /><span class=\"kw3\">int</span> lf = <span class=\"nu0\">10</span><span class=\"sy0\">;</span> <span class=\"co1\">// 10 is \'\\n\' in ASCII</span><br /><span class=\"kw3\">byte</span><span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> inBuffer = <span class=\"kw12\">new</span> <span class=\"kw3\">byte</span><span class=\"br0\">&#91;</span>22<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">// this is the number of chars on each line from the Arduino (including /r/n)</span><br /><br /><span class=\"kw3\">PFont</span> font<span class=\"sy0\">;</span><br /><br /><span class=\"kw3\">void</span> <span class=\"kw2\">setup</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <br /><span class=\"br0\">&#123;</span><br /> <span class=\"kw2\">size</span><span class=\"br0\">&#40;</span>800, 600, <span class=\"kw14\">P3D</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> myPort = <span class=\"kw12\">new</span> Serial<span class=\"br0\">&#40;</span><span class=\"kw13\">this</span>, serialPort, 115200<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><br /> font = <span class=\"kw2\">createFont</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Courier&quot;</span>, 32<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <br /><br /> <span class=\"coMULTI\">/*<br /> float [] axis = new float[3];<br /> axis[0] = 0.0;<br /> axis[1] = 0.0;<br /> axis[2] = 1.0;<br /> float angle = PI/2.0;<br /> <br /> hq = quatAxisAngle(axis, angle);<br /> <br /> hq = new float[4];<br /> hq[0] = 0.0;<br /> hq[1] = 0.0;<br /> hq[2] = 0.0;<br /> hq[3] = 1.0;<br /> */</span><br /><br /> <span class=\"kw2\">delay</span><span class=\"br0\">&#40;</span>100<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> myPort.<span class=\"me1\">clear</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> myPort.<span class=\"me1\">write</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;1&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw3\">float</span> decodeFloat<span class=\"br0\">&#40;</span><span class=\"kw3\">String</span> inString<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw3\">byte</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> inData = <span class=\"kw12\">new</span> <span class=\"kw3\">byte</span><span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span>inString.<span class=\"kw2\">length</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> == 8<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  inData<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = <span class=\"br0\">&#40;</span><span class=\"kw3\">byte</span><span class=\"br0\">&#41;</span> <span class=\"kw2\">unhex</span><span class=\"br0\">&#40;</span>inString.<span class=\"kw2\">substring</span><span class=\"br0\">&#40;</span>0, 2<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  inData<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = <span class=\"br0\">&#40;</span><span class=\"kw3\">byte</span><span class=\"br0\">&#41;</span> <span class=\"kw2\">unhex</span><span class=\"br0\">&#40;</span>inString.<span class=\"kw2\">substring</span><span class=\"br0\">&#40;</span>2, 4<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  inData<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = <span class=\"br0\">&#40;</span><span class=\"kw3\">byte</span><span class=\"br0\">&#41;</span> <span class=\"kw2\">unhex</span><span class=\"br0\">&#40;</span>inString.<span class=\"kw2\">substring</span><span class=\"br0\">&#40;</span>4, 6<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  inData<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> = <span class=\"br0\">&#40;</span><span class=\"kw3\">byte</span><span class=\"br0\">&#41;</span> <span class=\"kw2\">unhex</span><span class=\"br0\">&#40;</span>inString.<span class=\"kw2\">substring</span><span class=\"br0\">&#40;</span>6, 8<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> <span class=\"kw3\">int</span> intbits = <span class=\"br0\">&#40;</span>inData<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">&lt;&lt;</span> 24<span class=\"br0\">&#41;</span> | <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>inData<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> 0xff<span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;&lt;</span> 16<span class=\"br0\">&#41;</span> | <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>inData<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> 0xff<span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;&lt;</span> 8<span class=\"br0\">&#41;</span> | <span class=\"br0\">&#40;</span>inData<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">&amp;</span> 0xff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw8\">return</span> <span class=\"kw3\">Float</span>.<span class=\"me1\">intBitsToFloat</span><span class=\"br0\">&#40;</span>intbits<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><br /><br /><br /><br /><br /><span class=\"kw3\">void</span> readQ<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span>myPort.<span class=\"me1\">available</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;</span>= 18<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"kw3\">String</span> inputString = myPort.<span class=\"me1\">readStringUntil</span><span class=\"br0\">&#40;</span>lf<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"co1\">//print(inputString);</span><br />  <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span>inputString <span class=\"sy0\">!</span>= <span class=\"kw5\">null</span> <span class=\"sy0\">&amp;&amp;</span> inputString.<span class=\"kw2\">length</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">&gt;</span> 0<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />   <span class=\"kw3\">String</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> inputStringArr = <span class=\"kw2\">split</span><span class=\"br0\">&#40;</span>inputString, <span class=\"st0\">&quot;,&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span>inputStringArr.<span class=\"kw2\">length</span> <span class=\"sy0\">&gt;</span>= <span class=\"nu0\">5</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <span class=\"co1\">// q1,q2,q3,q4,\\r\\n so we have 5 elements</span><br />    q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = decodeFloat<span class=\"br0\">&#40;</span>inputStringArr<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = decodeFloat<span class=\"br0\">&#40;</span>inputStringArr<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = decodeFloat<span class=\"br0\">&#40;</span>inputStringArr<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> = decodeFloat<span class=\"br0\">&#40;</span>inputStringArr<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />   <span class=\"br0\">&#125;</span><br />  <span class=\"br0\">&#125;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw3\">void</span> buildBoxShape<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"co1\">//box(60, 10, 40);</span><br /> <span class=\"kw2\">noStroke</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">beginShape</span><span class=\"br0\">&#40;</span><span class=\"kw14\">QUADS</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//Z+ (to the drawing area)</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#00ff00<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//Z-</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#0000ff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//X-</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#ff0000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//X+</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#ffff00<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//Y-</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#ff00ff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, -5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">//Y+</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#00ffff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, -20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">vertex</span><span class=\"br0\">&#40;</span>-30, 5, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw2\">endShape</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw3\">void</span> drawCube<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <span class=\"kw2\">pushMatrix</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">translate</span><span class=\"br0\">&#40;</span>800/2, 600/2 + 50, 0<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">scale</span><span class=\"br0\">&#40;</span>5, 5, 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"co1\">// a demonstration of the following is at </span><br /> <span class=\"co1\">// http://www.varesano.net/blog/fabio/ahrs-sensor-fusion-orientation-filter-3d-graphical-rotating-cube</span><br /> <span class=\"kw2\">rotateZ</span><span class=\"br0\">&#40;</span>-Euler<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">rotateX</span><span class=\"br0\">&#40;</span>-Euler<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">rotateY</span><span class=\"br0\">&#40;</span>-Euler<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> buildBoxShape<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw2\">popMatrix</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw3\">void</span> <span class=\"kw2\">draw</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw2\">background</span><span class=\"br0\">&#40;</span>#000000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">fill</span><span class=\"br0\">&#40;</span>#ffffff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> readQ<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span>hq <span class=\"sy0\">!</span>= <span class=\"kw5\">null</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <span class=\"co1\">// use home quaternion</span><br />  quaternionToEuler<span class=\"br0\">&#40;</span>quatProd<span class=\"br0\">&#40;</span>hq, q<span class=\"br0\">&#41;</span>, Euler<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw2\">text</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Disable home position by pressing <span class=\"es0\">\\&quot;</span>n<span class=\"es0\">\\&quot;</span>&quot;</span>, 20, 600 - 30<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw7\">else</span> <span class=\"br0\">&#123;</span><br />  quaternionToEuler<span class=\"br0\">&#40;</span>q, Euler<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw2\">text</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Point FreeIMU\'s X axis to your monitor then press <span class=\"es0\">\\&quot;</span>h<span class=\"es0\">\\&quot;</span>&quot;</span>, 20, 600 - 30<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><br /> <span class=\"kw2\">textFont</span><span class=\"br0\">&#40;</span>font, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">textAlign</span><span class=\"br0\">&#40;</span><span class=\"kw14\">LEFT</span>, <span class=\"kw14\">TOP</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">text</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Q:<span class=\"es0\">\\n</span>&quot;</span> + q<span class=\"br0\">&#91;</span><span class=\"nu0\">0</span><span class=\"br0\">&#93;</span> + <span class=\"st0\">&quot;<span class=\"es0\">\\n</span>&quot;</span> + q<span class=\"br0\">&#91;</span><span class=\"nu0\">1</span><span class=\"br0\">&#93;</span> + <span class=\"st0\">&quot;<span class=\"es0\">\\n</span>&quot;</span> + q<span class=\"br0\">&#91;</span><span class=\"nu0\">2</span><span class=\"br0\">&#93;</span> + <span class=\"st0\">&quot;<span class=\"es0\">\\n</span>&quot;</span> + q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span>, 20, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw2\">text</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;Euler Angles:<span class=\"es0\">\\n</span>Yaw (psi) : &quot;</span> + <span class=\"kw2\">degrees</span><span class=\"br0\">&#40;</span>Euler<span class=\"br0\">&#91;</span><span class=\"nu0\">0</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> + <span class=\"st0\">&quot;<span class=\"es0\">\\n</span>Pitch (theta): &quot;</span> + <span class=\"kw2\">degrees</span><span class=\"br0\">&#40;</span>Euler<span class=\"br0\">&#91;</span><span class=\"nu0\">1</span><span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span> + <span class=\"st0\">&quot;<span class=\"es0\">\\n</span>Roll (phi) : &quot;</span> + <span class=\"kw2\">degrees</span><span class=\"br0\">&#40;</span>Euler<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span>, 200, 20<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> drawCube<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"kw3\">void</span> <span class=\"kw1\">keyPressed</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span><span class=\"kw1\">key</span> == <span class=\"st0\">\'h\'</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"kw2\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;pressed h&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// set hq the home quaternion as the quatnion conjugate coming from the sensor fusion</span><br />  hq = quatConjugate<span class=\"br0\">&#40;</span>q<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /> <span class=\"kw7\">else</span> <span class=\"kw7\">if</span> <span class=\"br0\">&#40;</span><span class=\"kw1\">key</span> == <span class=\"st0\">\'n\'</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br />  <span class=\"kw2\">println</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot;pressed n&quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  hq = <span class=\"kw5\">null</span><span class=\"sy0\">;</span><br /> <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// See Sebastian O.H. Madwick report </span><br /><span class=\"co1\">// &quot;An efficient orientation filter for inertial and intertial/magnetic sensor arrays&quot; Chapter 2 Quaternion representation</span><br /><br /><span class=\"kw3\">void</span> quaternionToEuler<span class=\"br0\">&#40;</span><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> q, <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> euler<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> euler<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = <span class=\"kw2\">atan2</span><span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> - 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span>, 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">*</span>q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> + 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> - 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// psi</span><br /> euler<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = -<span class=\"kw2\">asin</span><span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> + 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// theta</span><br /> euler<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = <span class=\"kw2\">atan2</span><span class=\"br0\">&#40;</span>2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> - 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span>, 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> + 2 <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> - 1<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// phi</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> quatProd<span class=\"br0\">&#40;</span><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> a, <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> b<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> q = <span class=\"kw12\">new</span> <span class=\"kw3\">float</span><span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = a<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = a<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = a<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> = a<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> - a<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> + a<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> b<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw8\">return</span> q<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// returns a quaternion from an axis angle representation</span><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> quatAxisAngle<span class=\"br0\">&#40;</span><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> axis, <span class=\"kw3\">float</span> angle<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> q = <span class=\"kw12\">new</span> <span class=\"kw3\">float</span><span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw3\">float</span> halfAngle = angle / <span class=\"nu0\">2.0</span><span class=\"sy0\">;</span><br /> <span class=\"kw3\">float</span> sinHalfAngle = <span class=\"kw2\">sin</span><span class=\"br0\">&#40;</span>halfAngle<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = <span class=\"kw2\">cos</span><span class=\"br0\">&#40;</span>halfAngle<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = -axis<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> sinHalfAngle<span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = -axis<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> sinHalfAngle<span class=\"sy0\">;</span><br /> q<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> = -axis<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> <span class=\"sy0\">*</span> sinHalfAngle<span class=\"sy0\">;</span><br /><br /> <span class=\"kw8\">return</span> q<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// return the quaternion conjugate of quat</span><br /><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> quatConjugate<span class=\"br0\">&#40;</span><span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> quat<span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span><br /> <span class=\"kw3\">float</span> <span class=\"br0\">&#91;</span><span class=\"br0\">&#93;</span> conj = <span class=\"kw12\">new</span> <span class=\"kw3\">float</span><span class=\"br0\">&#91;</span>4<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> conj<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span> = quat<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> conj<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span> = -quat<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> conj<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span> = -quat<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /> conj<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span> = -quat<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span><br /><br /> <span class=\"kw8\">return</span> conj<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper md\" id=\"c7c5e82c47fdeded89f62f94f57dddce9499946a\">  <p class=\"fileHead\">README.md</p>    <div class=\"fileCodeWrapper\">    <div class=\"code\">  <div class=\"markdown\"><h1>Sparkfun 6DOF</h1><p>Arduino/processing code for the sparkfun 6DOF sensor: <a href=\"https://www.sparkfun.com/products/10121\">https://www.sparkfun.com/products/10121</a></p><p>For complete hookup and tutorial see: <a href=\"http://adam-meyer.com/arduino/6dof\">http://adam-meyer.com/arduino/6dof</a></p><p>The code is provided under the MIT license please use, edit, change, and share. </p><p><strong>Big Thanks to varesano.net for the freeimu code this is based off of.</strong></p><p><em>Before loading the sixDOF_Example code, or even opening the arduino software, place the FreeSixIMU folder in your arduino library.</em></p><h5>ARDUINO LIBRARY LOCATION</h5><ul><li>On your Mac:: In (home directory)/Documents/Arduino/libraries  </li><li>On your PC:: My Documents -&gt; Arduino -&gt; libraries  </li><li>On your Linux box: (home directory)/sketchbook/libraries  </li></ul><p>For all my arduino articles: <a href=\"http://adam-meyer.com/arduino/\">http://adam-meyer.com/arduino/</a></p></div>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"07c65fa3d5a69c794b8f3e8cb1cb9374e7bd2939\">  <p class=\"fileHead\">sixDOF_Example.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co2\">#include &lt;FreeSixIMU.h&gt;</span><br /><span class=\"co2\">#include &lt;FIMU_ADXL345.h&gt;</span><br /><span class=\"co2\">#include &lt;FIMU_ITG3200.h&gt;</span><br /><br /><span class=\"co2\">#include &lt;Wire.h&gt;</span><br /><br /><span class=\"kw4\">float</span> angles<span class=\"br0\">&#91;</span>3<span class=\"br0\">&#93;</span><span class=\"sy0\">;</span> <span class=\"co1\">// yaw pitch roll</span><br /><br /><span class=\"co1\">// Set the FreeSixIMU object</span><br />FreeSixIMU sixDOF <span class=\"sy0\">=</span> FreeSixIMU<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span>9600<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> Wire.<span class=\"me1\">begin</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> sixDOF.<span class=\"me1\">init</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//begin the IMU</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"br0\">&#123;</span> <br /> <br /> sixDOF.<span class=\"me1\">getEuler</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>0<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot; | &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>1<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">print</span><span class=\"br0\">&#40;</span><span class=\"st0\">&quot; | &quot;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <a href=\"geshi/redirect.php?language=arduino&search=Serial\"><span class=\"kw3\">Serial</span></a>.<span class=\"me1\">println</span><span class=\"br0\">&#40;</span>angles<span class=\"br0\">&#91;</span>2<span class=\"br0\">&#93;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> <a href=\"geshi/redirect.php?language=arduino&search=delay\"><span class=\"kw3\">delay</span></a><span class=\"br0\">&#40;</span>100<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><span class=\"br0\">&#125;</span><br /><br /></code></pre>  </div>  </div>  </div>    </div></div><div class=\"footer\">powered by <a title=\"github.com\" href=\"http://github.com\">github</a><!-- Served in 0.0062978267669678 sec - loaded from cache: yes - limitLeft:  of  --!></div></div>');
new Embed("6dof_sidebar", "6dof_code", {"sha":"b236da3f0fb4839ff11f9eb7efa246e9ce7000a7","url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/trees\/b236da3f0fb4839ff11f9eb7efa246e9ce7000a7","tree":[{"path":"FreeSixIMU\/CommunicationUtils.cpp","mode":"100644","type":"blob","sha":"315018db7e2cb723a91e39a66e90b05a951fcb71","size":925,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/315018db7e2cb723a91e39a66e90b05a951fcb71"},{"path":"FreeSixIMU\/CommunicationUtils.h","mode":"100644","type":"blob","sha":"a58fdf5c11051f7133794e60c2f053656f1a85fa","size":310,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/a58fdf5c11051f7133794e60c2f053656f1a85fa"},{"path":"FreeSixIMU\/DebugUtils.h","mode":"100644","type":"blob","sha":"c7d1b38c44e07cc9d609181dff4b6952a7163d15","size":1305,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/c7d1b38c44e07cc9d609181dff4b6952a7163d15"},{"path":"FreeSixIMU\/FIMU_ADXL345.cpp","mode":"100644","type":"blob","sha":"e61585105cfa006bb8903cebd8082a7f5702da6f","size":18592,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/e61585105cfa006bb8903cebd8082a7f5702da6f"},{"path":"FreeSixIMU\/FIMU_ADXL345.h","mode":"100644","type":"blob","sha":"6dd8aff419621ebb1f8baed1f12a8f07ecedc563","size":6771,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/6dd8aff419621ebb1f8baed1f12a8f07ecedc563"},{"path":"FreeSixIMU\/FIMU_ITG3200.cpp","mode":"100644","type":"blob","sha":"fc0b86317046c8c72482e74d59478112ae124f51","size":10806,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/fc0b86317046c8c72482e74d59478112ae124f51"},{"path":"FreeSixIMU\/FIMU_ITG3200.h","mode":"100644","type":"blob","sha":"6c7d80ef461c35aec60819ba8a48397c4dc1a557","size":8632,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/6c7d80ef461c35aec60819ba8a48397c4dc1a557"},{"path":"FreeSixIMU\/FreeSixIMU.cpp","mode":"100644","type":"blob","sha":"73ae3ed2adafe5709038a45e1364fa88f5293030","size":10129,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/73ae3ed2adafe5709038a45e1364fa88f5293030"},{"path":"FreeSixIMU\/FreeSixIMU.h","mode":"100644","type":"blob","sha":"afcb431e16337e108dff5a931743db982cea13b5","size":2713,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/afcb431e16337e108dff5a931743db982cea13b5"},{"path":"FreeSixIMU\/LICENSE.txt","mode":"100644","type":"blob","sha":"94a9ed024d3859793618152ea559a168bbcbb5e2","size":35147,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/94a9ed024d3859793618152ea559a168bbcbb5e2"},{"path":"License.txt","mode":"100644","type":"blob","sha":"b132efea8543fe82d1fd16a19298a9840f395e17","size":1073,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/b132efea8543fe82d1fd16a19298a9840f395e17"},{"path":"Processing_Example\/Arduino\/FreeSix_cube.ino","mode":"100644","type":"blob","sha":"b78323cd9155c75d579f36ea335675627d214762","size":704,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/b78323cd9155c75d579f36ea335675627d214762"},{"path":"Processing_Example\/Processing\/FreeSix_cube.pde","mode":"100644","type":"blob","sha":"68fba1a5c668994ab9d31e8690c17e7a4053f593","size":5421,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/68fba1a5c668994ab9d31e8690c17e7a4053f593"},{"path":"README.md","mode":"100644","type":"blob","sha":"c7c5e82c47fdeded89f62f94f57dddce9499946a","size":749,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/c7c5e82c47fdeded89f62f94f57dddce9499946a"},{"path":"sixDOF_Example.ino","mode":"100644","type":"blob","sha":"07c65fa3d5a69c794b8f3e8cb1cb9374e7bd2939","size":513,"url":"https:\/\/api.github.com\/repos\/ameyer\/6dof\/git\/blobs\/07c65fa3d5a69c794b8f3e8cb1cb9374e7bd2939"}],"truncated":false})

<!-- Served in 0.14434885978699 sec - loaded from cache: yes - limitLeft:  of  --!>