document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');document.write('<link rel="stylesheet" href="../arduino/style/githubEmbed.css"/>');/*
---
script: Fx.Scroll.js
name: Fx.Scroll
description: Effect to smoothly scroll any element, including the window.
license: MIT-style license
authors:
  - Valerio Proietti
requires:
  - Core/Fx
  - Core/Element.Event
  - Core/Element.Dimensions
  - MooTools.More
provides: [Fx.Scroll]
...
*/

function GHE_isBody(element){
	return (/^(?:body|html)$/i).test(element.tagName);
}

Fx.Scroll = new Class({
	Extends: Fx,
	options: {
		offset: {x: 0, y: 0},
		wheelStops: true
	},
	initialize: function(element, options){
		this.element = this.subject = document.id(element);
		this.parent(options);
		if (typeOf(this.element) != 'element') this.element = document.id(this.element.getDocument().body);
		if (this.options.wheelStops){
			var stopper = this.element,
				cancel = this.cancel.pass(false, this);
			this.addEvent('start', function(){
				stopper.addEvent('mousewheel', cancel);
			}, true);
			this.addEvent('complete', function(){
				stopper.removeEvent('mousewheel', cancel);
			}, true);
		}
	},
	set: function(){
		var now = Array.flatten(arguments);
		if (Browser.firefox) now = [Math.round(now[0]), Math.round(now[1])]; // not needed anymore in newer firefox versions
		this.element.scrollTo(now[0], now[1]);
		return this;
	},
	compute: function(from, to, delta){
		return [0, 1].map(function(i){
			return Fx.compute(from[i], to[i], delta);
		});
	},
	start: function(x, y){
		if (!this.check(x, y)) return this;
		var scroll = this.element.getScroll();
		return this.parent([scroll.x, scroll.y], [x, y]);
	},
	calculateScroll: function(x, y){
		var element = this.element,
			scrollSize = element.getScrollSize(),
			scroll = element.getScroll(),
			size = element.getSize(),
			offset = this.options.offset,
			values = {x: x, y: y};
		for (var z in values){
			if (!values[z] && values[z] !== 0) values[z] = scroll[z];
			if (typeOf(values[z]) != 'number') values[z] = scrollSize[z] - size[z];
			values[z] += offset[z];
		}
		return [values.x, values.y];
	},
	toElement: function(el, axes){
		axes = axes ? Array.from(axes) : ['x', 'y'];
		var scroll = GHE_isBody(this.element) ? {x: 0, y: 0} : this.element.getScroll();
		var position = Object.map(document.id(el).getPosition(this.element), function(value, axis){
			return axes.contains(axis) ? value + scroll[axis] : false;
		});
		return this.start.apply(this, this.calculateScroll(position.x, position.y));
	}
});

var Embed = new Class({
	Implements: [Events],
	initialize: function(wrapper, codeWrapper, data){

		this.wrapper = document.id(wrapper);
		this.codeWrapper = document.id(codeWrapper);
		this.data = data;
		this.codeScroll = new Fx.Scroll(this.codeWrapper, {link: 'cancel'});
		this.files = [];
		this.rawTree = [];
		for (var i = 0; i < data.tree.length; i++) {
			var file = {};
			file.path = this.getPath(this.data.tree[i].path);
			file.mode = this.data.tree[i].mode;
			file.sha = this.data.tree[i].sha;
			file.url = this.data.tree[i].url;
			file.name = file.path.pop();
			file.extension = file.name.split('.').pop();
			file.type = (this.data.tree[i].type == "tree")? 'folder' : 'file';
			this.rawTree.push(file);
		}
		this.filelist = new GHE_Filelist(this.wrapper);
		//loop through files, and make structure.
		for (var i = 0; i < this.rawTree.length; i++) {
			var file = this.rawTree[i];
			var path = this.filelist;
			//find/create file path
			while(file.path.length > 0){
				var segment = file.path.shift();
				if(!path[segment]){
					path[segment] =  new GHE_Folder(path.fileHousing, file, segment);
				}
				path = path[segment];
			}
			if(file.type == 'file'){
				if(file.extension != 'gitignore' && file.extension != 'pdf'){
					path[file.name] = new GHE_File(path.fileHousing,file);
					path[file.name].addEvent('clicked', this.fileClicked.bind(this));
					this.files.push(path[file.name]);
				}
			}else{
				path[file.name] = new GHE_Folder(path.fileHousing,file);
			}
		}
		this.files[0].select();
		console.log(this.fileList);
	},
	fileClicked: function(file){
		for (var i = 0; i < this.files.length; i++) {
			this.files[i].unselect();
		}
		file.select();
		console.log(file);
		this.codeScroll.toElement(document.id(file.sha));
	},
	getPath: function(path){
		return path.split("/");
	}
});var GHE_Filelist = new Class({
	Implements: [Events],
	initialize: function(wrapper){
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'fileList'}).inject(this.wrapper);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.body);
		//console.log(this);
	},
});
var GHE_File = new Class({
	Implements: [Events],
	initialize: function(wrapper, data){
		this.data = data;
		this.name = data.name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		this.buildUI();
	},
	buildUI: function(){
		this.body = new Element('div', {'class': 'file'}).inject(this.wrapper);
			this.nameEl = new Element('div', {'class': 'name', html: this.data.name}).inject(this.body);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	select: function(){
		this.body.addClass('selected');
	},
	unselect: function(){
		this.body.removeClass('selected');
	}
});var GHE_Folder = new Class({
	Implements: [Events],
	initialize: function(wrapper, data, name){
		this.data = data;
		this.name = name;
		this.sha = data.sha;
		this.url = data.url;
		this.mode = data.mode;
		this.wrapper = document.id(wrapper);
		
		this.buildUI();
	},
	buildUI: function(){
		this.folderWrapper = new Element('div', {'class': 'folderWrapper'}).inject(this.wrapper);
			this.body = new Element('div', {'class': 'folder'}).inject(this.folderWrapper);
				this.nameEl = new Element('div', {'class': 'name', html: this.name}).inject(this.body);
			this.fileHousing = new Element('div', {'class': 'fileHousing'}).inject(this.folderWrapper);
		this.body.addEvent('click', this.clicked.bind(this));
	},
	clicked: function(){
		this.fireEvent('clicked', this);
	},
	addFile: function(file){
		this.fileHousing.inject(file.body);
	}
});
document.write('<div class=\"githubEmbed_projectWrapper\"><div class=\"projectHeader\" ><span class=\"projectTitle\"><a title=\"github.com: ameyer/AccelStepper\" href=\"http://github.com/ameyer/AccelStepper\">AccelStepper</a> </span><a class=\"downloadButton\" title=\"download prject from github\" href=\"https://github.com/ameyer/AccelStepper/archive/master.zip\">download</a></div><div class=\"body\"><div class=\"sideBar\" id=\"AccelStepper_sidebar\"></div><div class=\"projectCode\" id=\"AccelStepper_code\">   <div class=\"fileWrapper cpp\" id=\"e6ca34f1adf1f509f2b3ba5111982e072f8453a1\">  <p class=\"fileHead\">AccelStepper.cpp</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />335<br />336<br />337<br />338<br />339<br />340<br />341<br />342<br />343<br />344<br />345<br />346<br />347<br />348<br />349<br />350<br />351<br />352<br />353<br />354<br />355<br />356<br />357<br />358<br />359<br />360<br />361<br />362<br />363<br />364<br />365<br />366<br />367<br />368<br />369<br />370<br />371<br />372<br />373<br />374<br />375<br />376<br />377<br />378<br />379<br />380<br />381<br />382<br />383<br />384<br />385<br />386<br />387<br />388<br />389<br />390<br />391<br />392<br />393<br />394<br />395<br />396<br />397<br />398<br />399<br />400<br />401<br />402<br />403<br />404<br />405<br />406<br />407<br />408<br />409<br />410<br />411<br />412<br />413<br />414<br />415<br />416<br />417<br />418<br />419<br />420<br />421<br />422<br />423<br />424<br />425<br />426<br />427<br />428<br />429<br />430<br />431<br />432<br />433<br />434<br />435<br />436<br />437<br />438<br />439<br />440<br />441<br />442<br />443<br />444<br />445<br />446<br />447<br />448<br />449<br />450<br />451<br />452<br />453<br />454<br />455<br />456<br />457<br />458<br />459<br />460<br />461<br />462<br />463<br />464<br />465<br />466<br />467<br />468<br />469<br />470<br />471<br />472<br />473<br />474<br />475<br />476<br />477<br />478<br />479<br />480<br />481<br />482<br />483<br />484<br />485<br />486<br />487<br />488<br />489<br />490<br />491<br />492<br />493<br />494<br />495<br />496<br />497<br />498<br />499<br />500<br />501<br />502<br />503<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co1\">// AccelStepper.cpp</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">// Copyright (C) 2009 Mike McCauley</span><br /><span class=\"co1\">// $Id: AccelStepper.cpp,v 1.5 2012/01/28 22:45:25 mikem Exp mikem $</span><br /><br /><span class=\"co2\">#include &quot;AccelStepper.h&quot;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">moveTo</span><span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> absolute<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _targetPos <span class=\"sy0\">=</span> absolute<span class=\"sy0\">;</span><br />  computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">move</span><span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> relative<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  moveTo<span class=\"br0\">&#40;</span>_currentPos <span class=\"sy0\">+</span> relative<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Implements steps according to the current speed</span><br /><span class=\"co1\">// You must call this at least once per step</span><br /><span class=\"co1\">// returns true if a step occurred</span><br />boolean AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">runSpeed</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"co1\">// Dont do anything unless we actually have a speed</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">==</span> 0.0f<span class=\"br0\">&#41;</span><br />    <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br /><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">long</span> time <span class=\"sy0\">=</span> micros<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"co1\">// Gymnastics to detect wrapping of either the nextStepTime and/or the current time</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">long</span> nextStepTime <span class=\"sy0\">=</span> _lastStepTime <span class=\"sy0\">+</span> _stepInterval<span class=\"sy0\">;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>  <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>nextStepTime <span class=\"sy0\">&gt;=</span> _lastStepTime<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>time <span class=\"sy0\">&gt;=</span> nextStepTime<span class=\"br0\">&#41;</span> <span class=\"sy0\">||</span> <span class=\"br0\">&#40;</span>time <span class=\"sy0\">&lt;</span> _lastStepTime<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br />    <span class=\"sy0\">||</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>nextStepTime <span class=\"sy0\">&lt;</span> _lastStepTime<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>time <span class=\"sy0\">&gt;=</span> nextStepTime<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span>time <span class=\"sy0\">&lt;</span> _lastStepTime<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br /><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">&gt;</span> <span class=\"nu17\">0.0f</span><span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />      <span class=\"co1\">// Clockwise</span><br />      _currentPos <span class=\"sy0\">+=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">&lt;</span> <span class=\"nu17\">0.0f</span><span class=\"br0\">&#41;</span><br />    <span class=\"br0\">&#123;</span><br />      <span class=\"co1\">// Anticlockwise </span><br />      _currentPos <span class=\"sy0\">-=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />    <span class=\"br0\">&#125;</span><br />    step<span class=\"br0\">&#40;</span>_currentPos <span class=\"sy0\">&amp;</span> 0x7<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Bottom 3 bits (same as mod 8, but works with + and - numbers) </span><br /><br />    _lastStepTime <span class=\"sy0\">=</span> time<span class=\"sy0\">;</span><br />    <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">else</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">long</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">distanceToGo</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">return</span> _targetPos <span class=\"sy0\">-</span> _currentPos<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">long</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">targetPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">return</span> _targetPos<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">long</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">currentPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">return</span> _currentPos<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Useful during initialisations or after initial positioning</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setCurrentPosition</span><span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> position<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _targetPos <span class=\"sy0\">=</span> _currentPos <span class=\"sy0\">=</span> position<span class=\"sy0\">;</span><br />  computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Expect speed of 0</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">computeNewSpeed</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  setSpeed<span class=\"br0\">&#40;</span>desiredSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Work out and return a new speed.</span><br /><span class=\"co1\">// Subclasses can override if they want</span><br /><span class=\"co1\">// Implement acceleration, deceleration and max speed</span><br /><span class=\"co1\">// Negative speed is anticlockwise</span><br /><span class=\"co1\">// This is called:</span><br /><span class=\"co1\">// after each step</span><br /><span class=\"co1\">// after user changes:</span><br /><span class=\"co1\">//  maxSpeed</span><br /><span class=\"co1\">//  acceleration</span><br /><span class=\"co1\">//  target position (relative or absolute)</span><br /><span class=\"kw4\">float</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">desiredSpeed</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw4\">float</span> requiredSpeed<span class=\"sy0\">;</span><br />  <span class=\"kw4\">long</span> distanceTo <span class=\"sy0\">=</span> distanceToGo<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// +ve is clockwise from curent location</span><br /><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>distanceTo <span class=\"sy0\">==</span> 0<span class=\"br0\">&#41;</span><br />    <span class=\"kw1\">return</span> <span class=\"nu17\">0.0f</span><span class=\"sy0\">;</span> <span class=\"co1\">// We\'re there</span><br /><br />  <span class=\"co1\">// sqrSpeed is the signed square of _speed.</span><br />  <span class=\"kw4\">float</span> sqrSpeed <span class=\"sy0\">=</span> sq<span class=\"br0\">&#40;</span>_speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">&lt;</span> 0.0<span class=\"br0\">&#41;</span><br />   sqrSpeed <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>sqrSpeed<span class=\"sy0\">;</span><br />  <span class=\"kw4\">float</span> twoa <span class=\"sy0\">=</span> 2.0f <span class=\"sy0\">*</span> _acceleration<span class=\"sy0\">;</span> <span class=\"co1\">// 2ag</span><br />  <span class=\"co1\">// if v^^2/2as is the the left of target, we will arrive at 0 speed too far -ve, need to accelerate clockwise</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>sqrSpeed <span class=\"sy0\">/</span> twoa<span class=\"br0\">&#41;</span> <span class=\"sy0\">&lt;</span> distanceTo<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"co1\">// Accelerate clockwise</span><br />    <span class=\"co1\">// Need to accelerate in clockwise direction</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">==</span> 0.0f<span class=\"br0\">&#41;</span><br />      requiredSpeed <span class=\"sy0\">=</span> sqrt<span class=\"br0\">&#40;</span>twoa<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">else</span><br />      requiredSpeed <span class=\"sy0\">=</span> _speed <span class=\"sy0\">+</span> fabs<span class=\"br0\">&#40;</span>_acceleration <span class=\"sy0\">/</span> _speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>requiredSpeed <span class=\"sy0\">&gt;</span> _maxSpeed<span class=\"br0\">&#41;</span><br />      requiredSpeed <span class=\"sy0\">=</span> _maxSpeed<span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">else</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"co1\">// Decelerate clockwise, accelerate anticlockwise</span><br />    <span class=\"co1\">// Need to accelerate in clockwise direction</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">==</span> 0.0f<span class=\"br0\">&#41;</span><br />      requiredSpeed <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>sqrt<span class=\"br0\">&#40;</span>twoa<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">else</span><br />      requiredSpeed <span class=\"sy0\">=</span> _speed <span class=\"sy0\">-</span> fabs<span class=\"br0\">&#40;</span>_acceleration <span class=\"sy0\">/</span> _speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>requiredSpeed <span class=\"sy0\">&lt;</span> <span class=\"sy0\">-</span>_maxSpeed<span class=\"br0\">&#41;</span><br />      requiredSpeed <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>_maxSpeed<span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <br /><span class=\"co1\">//  Serial.println(requiredSpeed);</span><br />  <span class=\"kw1\">return</span> requiredSpeed<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Run the motor to implement speed and acceleration in order to proceed to the target position</span><br /><span class=\"co1\">// You must call this at least once per step, preferably in your main loop</span><br /><span class=\"co1\">// If the motor is in the desired position, the cost is very small</span><br /><span class=\"co1\">// returns true if we are still running to position</span><br />boolean AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">run</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_targetPos <span class=\"sy0\">==</span> _currentPos<span class=\"br0\">&#41;</span><br />    <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>runSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br />    computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">AccelStepper</span><span class=\"br0\">&#40;</span>uint8_t pins<span class=\"sy0\">,</span> uint8_t pin1<span class=\"sy0\">,</span> uint8_t pin2<span class=\"sy0\">,</span> uint8_t pin3<span class=\"sy0\">,</span> uint8_t pin4<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _pins <span class=\"sy0\">=</span> pins<span class=\"sy0\">;</span><br />  _currentPos <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _targetPos <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _speed <span class=\"sy0\">=</span> <span class=\"nu16\">0.0</span><span class=\"sy0\">;</span><br />  _maxSpeed <span class=\"sy0\">=</span> <span class=\"nu16\">1.0</span><span class=\"sy0\">;</span><br />  _acceleration <span class=\"sy0\">=</span> <span class=\"nu16\">1.0</span><span class=\"sy0\">;</span><br />  _stepInterval <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _minPulseWidth <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  _dirInverted <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  _stepInverted <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  _enablePin <span class=\"sy0\">=</span> <span class=\"nu12\">0xff</span><span class=\"sy0\">;</span><br />  _lastStepTime <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _pin1 <span class=\"sy0\">=</span> pin1<span class=\"sy0\">;</span><br />  _pin2 <span class=\"sy0\">=</span> pin2<span class=\"sy0\">;</span><br />  _pin3 <span class=\"sy0\">=</span> pin3<span class=\"sy0\">;</span><br />  _pin4 <span class=\"sy0\">=</span> pin4<span class=\"sy0\">;</span><br /><span class=\"co1\">//_stepInterval = 20000;</span><br /><span class=\"co1\">//_speed = 50.0;</span><br /><span class=\"co1\">//_lastRunTime = 0xffffffff - 20000;</span><br /><span class=\"co1\">//_lastStepTime = 0xffffffff - 20000 - 10000;</span><br />  enableOutputs<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">AccelStepper</span><span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>forward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">,</span> <span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>backward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _pins <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _currentPos <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _targetPos <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _speed <span class=\"sy0\">=</span> <span class=\"nu16\">0.0</span><span class=\"sy0\">;</span><br />  _maxSpeed <span class=\"sy0\">=</span> <span class=\"nu16\">1.0</span><span class=\"sy0\">;</span><br />  _acceleration <span class=\"sy0\">=</span> <span class=\"nu16\">1.0</span><span class=\"sy0\">;</span><br />  _stepInterval <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _minPulseWidth <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br />  _dirInverted <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  _stepInverted <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br />  _enablePin <span class=\"sy0\">=</span> <span class=\"nu12\">0xff</span><span class=\"sy0\">;</span><br />  _lastStepTime <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _pin1 <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _pin2 <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _pin3 <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _pin4 <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br />  _forward <span class=\"sy0\">=</span> forward<span class=\"sy0\">;</span><br />  _backward <span class=\"sy0\">=</span> backward<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setMaxSpeed</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> speed<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _maxSpeed <span class=\"sy0\">=</span> speed<span class=\"sy0\">;</span><br />  computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setAcceleration</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> acceleration<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _acceleration <span class=\"sy0\">=</span> acceleration<span class=\"sy0\">;</span><br />  computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setSpeed</span><span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> speed<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>speed <span class=\"sy0\">==</span> _speed<span class=\"br0\">&#41;</span><br />    <span class=\"kw1\">return</span><span class=\"sy0\">;</span><br /><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>speed <span class=\"sy0\">&gt;</span> 0.0f<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span>speed <span class=\"sy0\">&gt;</span> _maxSpeed<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br />    _speed <span class=\"sy0\">=</span> _maxSpeed<span class=\"sy0\">;</span><br />  <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span><span class=\"br0\">&#40;</span>speed <span class=\"sy0\">&lt;</span> 0.0f<span class=\"br0\">&#41;</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">&#40;</span>speed <span class=\"sy0\">&lt;</span> <span class=\"sy0\">-</span>_maxSpeed<span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br />    _speed <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>_maxSpeed<span class=\"sy0\">;</span><br />  <span class=\"kw1\">else</span><br />    _speed <span class=\"sy0\">=</span> speed<span class=\"sy0\">;</span><br />  _stepInterval <span class=\"sy0\">=</span> fabs<span class=\"br0\">&#40;</span>1000000.0 <span class=\"sy0\">/</span> _speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">float</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">speed</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">return</span> _speed<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Subclasses can override</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step</span><span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">switch</span> <span class=\"br0\">&#40;</span>_pins<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">case</span> 0<span class=\"sy0\">:</span><br />      step0<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />    <span class=\"kw1\">case</span> 1<span class=\"sy0\">:</span><br />      step1<span class=\"br0\">&#40;</span>step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <br />    <span class=\"kw1\">case</span> 2<span class=\"sy0\">:</span><br />      step2<span class=\"br0\">&#40;</span>step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <br />    <span class=\"kw1\">case</span> 4<span class=\"sy0\">:</span><br />      step4<span class=\"br0\">&#40;</span>step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span> <br /><br />    <span class=\"kw1\">case</span> 8<span class=\"sy0\">:</span><br />      step8<span class=\"br0\">&#40;</span>step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span> <br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// 0 pin step function (ie for functional usage)</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step0</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">&gt;</span> 0<span class=\"br0\">&#41;</span><br />  _forward<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <span class=\"kw1\">else</span><br />  _backward<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// 1 pin step function (ie for stepper drivers)</span><br /><span class=\"co1\">// This is passed the current step number (0 to 7)</span><br /><span class=\"co1\">// Subclasses can override</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step1</span><span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> <span class=\"br0\">&#40;</span>_speed <span class=\"sy0\">&gt;</span> 0<span class=\"br0\">&#41;</span> <span class=\"sy0\">^</span> _dirInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">// Direction</span><br />  <span class=\"co1\">// Caution 200ns setup time </span><br />  digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH <span class=\"sy0\">^</span> _stepInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"co1\">// Delay the minimum allowed pulse width</span><br />  delayMicroseconds<span class=\"br0\">&#40;</span>_minPulseWidth<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW <span class=\"sy0\">^</span> _stepInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// 2 pin step function</span><br /><span class=\"co1\">// This is passed the current step number (0 to 7)</span><br /><span class=\"co1\">// Subclasses can override</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step2</span><span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">switch</span> <span class=\"br0\">&#40;</span>step <span class=\"sy0\">&amp;</span> 0x3<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">0</span><span class=\"sy0\">:</span> <span class=\"coMULTI\">/* 01 */</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">1</span><span class=\"sy0\">:</span> <span class=\"coMULTI\">/* 11 */</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">2</span><span class=\"sy0\">:</span> <span class=\"coMULTI\">/* 10 */</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">3</span><span class=\"sy0\">:</span> <span class=\"coMULTI\">/* 00 */</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// 4 pin step function for half stepper</span><br /><span class=\"co1\">// This is passed the current step number (0 to 7)</span><br /><span class=\"co1\">// Subclasses can override</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step4</span><span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">switch</span> <span class=\"br0\">&#40;</span>step <span class=\"sy0\">&amp;</span> 0x3<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">0</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 1010</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">1</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 0110</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">2</span><span class=\"sy0\">:</span>  <span class=\"co1\">//0101</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br /><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">3</span><span class=\"sy0\">:</span>  <span class=\"co1\">//1001</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"co1\">// 4 pin step function</span><br /><span class=\"co1\">// This is passed the current step number (0 to 7)</span><br /><span class=\"co1\">// Subclasses can override</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">step8</span><span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">switch</span> <span class=\"br0\">&#40;</span>step <span class=\"sy0\">&amp;</span> 0x7<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"kw1\">case</span> <span class=\"nu0\">0</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 1000</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">1</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 1010</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">2</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 0010</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">3</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 0110</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">4</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 0100</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">5</span><span class=\"sy0\">:</span>  <span class=\"co1\">//0101</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">6</span><span class=\"sy0\">:</span>  <span class=\"co1\">// 0001</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />      <br />    <span class=\"kw1\">case</span> <span class=\"nu0\">7</span><span class=\"sy0\">:</span>  <span class=\"co1\">//1001</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> HIGH<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />      <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br />  <br /><span class=\"co1\">// Prevents power consumption on the outputs</span><br /><span class=\"kw4\">void</span>  AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">disableOutputs</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span>  <br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">!</span> _pins<span class=\"br0\">&#41;</span> <span class=\"kw1\">return</span><span class=\"sy0\">;</span><br /><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_pins <span class=\"sy0\">==</span> <span class=\"nu0\">1</span><span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    <span class=\"co1\">// Invert only applies for stepper drivers.</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW <span class=\"sy0\">^</span> _stepInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW <span class=\"sy0\">^</span> _dirInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <span class=\"kw1\">else</span><br />  <span class=\"br0\">&#123;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br />  <br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_pins <span class=\"sy0\">==</span> 4 <span class=\"sy0\">||</span> _pins <span class=\"sy0\">==</span> 8<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> LOW<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_enablePin <span class=\"sy0\">!=</span> 0xff<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_enablePin<span class=\"sy0\">,</span> LOW <span class=\"sy0\">^</span> _enableInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span>  AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">enableOutputs</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">!</span> _pins<span class=\"br0\">&#41;</span> <br />    <span class=\"kw1\">return</span><span class=\"sy0\">;</span><br /><br />  pinMode<span class=\"br0\">&#40;</span>_pin1<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  pinMode<span class=\"br0\">&#40;</span>_pin2<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_pins <span class=\"sy0\">==</span> 4 <span class=\"sy0\">||</span> _pins <span class=\"sy0\">==</span> 8<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    pinMode<span class=\"br0\">&#40;</span>_pin3<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    pinMode<span class=\"br0\">&#40;</span>_pin4<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><br />    <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_enablePin <span class=\"sy0\">!=</span> 0xff<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    pinMode<span class=\"br0\">&#40;</span>_enablePin<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_enablePin<span class=\"sy0\">,</span> HIGH <span class=\"sy0\">^</span> _enableInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setMinPulseWidth</span><span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> minWidth<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _minPulseWidth <span class=\"sy0\">=</span> minWidth<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setEnablePin</span><span class=\"br0\">&#40;</span>uint8_t enablePin<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _enablePin <span class=\"sy0\">=</span> enablePin<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">// This happens after construction, so init pin now.</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_enablePin <span class=\"sy0\">!=</span> 0xff<span class=\"br0\">&#41;</span><br />  <span class=\"br0\">&#123;</span><br />    pinMode<span class=\"br0\">&#40;</span>_enablePin<span class=\"sy0\">,</span> OUTPUT<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />    digitalWrite<span class=\"br0\">&#40;</span>_enablePin<span class=\"sy0\">,</span> HIGH <span class=\"sy0\">^</span> _enableInverted<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"br0\">&#125;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">setPinsInverted</span><span class=\"br0\">&#40;</span>bool direction<span class=\"sy0\">,</span> bool step<span class=\"sy0\">,</span> bool enable<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  _dirInverted  <span class=\"sy0\">=</span> direction<span class=\"sy0\">;</span><br />  _stepInverted  <span class=\"sy0\">=</span> step<span class=\"sy0\">;</span><br />  _enableInverted <span class=\"sy0\">=</span> enable<span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><br /><span class=\"co1\">// Blocks until the target position is reached</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">runToPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">while</span> <span class=\"br0\">&#40;</span>run<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><br />    <span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br />boolean AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">runSpeedToPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>_targetPos <span class=\"sy0\">&gt;</span>_currentPos<span class=\"br0\">&#41;</span><br />    _speed <span class=\"sy0\">=</span> fabs<span class=\"br0\">&#40;</span>_speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">else</span><br />    _speed <span class=\"sy0\">=</span> <span class=\"sy0\">-</span>fabs<span class=\"br0\">&#40;</span>_speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <span class=\"kw1\">return</span> _targetPos<span class=\"sy0\">!=</span>_currentPos <span class=\"sy0\">?</span> runSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">:</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"co1\">// Blocks until the new target position is reached</span><br /><span class=\"kw4\">void</span> AccelStepper<span class=\"sy0\">::</span><span class=\"me2\">runToNewPosition</span><span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> position<span class=\"br0\">&#41;</span><br /><span class=\"br0\">&#123;</span><br />  moveTo<span class=\"br0\">&#40;</span>position<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  runToPosition<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper h\" id=\"d15cbb27deec6b6c33aaf78382c3eb757cff7422\">  <p class=\"fileHead\">AccelStepper.h</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />81<br />82<br />83<br />84<br />85<br />86<br />87<br />88<br />89<br />90<br />91<br />92<br />93<br />94<br />95<br />96<br />97<br />98<br />99<br />100<br />101<br />102<br />103<br />104<br />105<br />106<br />107<br />108<br />109<br />110<br />111<br />112<br />113<br />114<br />115<br />116<br />117<br />118<br />119<br />120<br />121<br />122<br />123<br />124<br />125<br />126<br />127<br />128<br />129<br />130<br />131<br />132<br />133<br />134<br />135<br />136<br />137<br />138<br />139<br />140<br />141<br />142<br />143<br />144<br />145<br />146<br />147<br />148<br />149<br />150<br />151<br />152<br />153<br />154<br />155<br />156<br />157<br />158<br />159<br />160<br />161<br />162<br />163<br />164<br />165<br />166<br />167<br />168<br />169<br />170<br />171<br />172<br />173<br />174<br />175<br />176<br />177<br />178<br />179<br />180<br />181<br />182<br />183<br />184<br />185<br />186<br />187<br />188<br />189<br />190<br />191<br />192<br />193<br />194<br />195<br />196<br />197<br />198<br />199<br />200<br />201<br />202<br />203<br />204<br />205<br />206<br />207<br />208<br />209<br />210<br />211<br />212<br />213<br />214<br />215<br />216<br />217<br />218<br />219<br />220<br />221<br />222<br />223<br />224<br />225<br />226<br />227<br />228<br />229<br />230<br />231<br />232<br />233<br />234<br />235<br />236<br />237<br />238<br />239<br />240<br />241<br />242<br />243<br />244<br />245<br />246<br />247<br />248<br />249<br />250<br />251<br />252<br />253<br />254<br />255<br />256<br />257<br />258<br />259<br />260<br />261<br />262<br />263<br />264<br />265<br />266<br />267<br />268<br />269<br />270<br />271<br />272<br />273<br />274<br />275<br />276<br />277<br />278<br />279<br />280<br />281<br />282<br />283<br />284<br />285<br />286<br />287<br />288<br />289<br />290<br />291<br />292<br />293<br />294<br />295<br />296<br />297<br />298<br />299<br />300<br />301<br />302<br />303<br />304<br />305<br />306<br />307<br />308<br />309<br />310<br />311<br />312<br />313<br />314<br />315<br />316<br />317<br />318<br />319<br />320<br />321<br />322<br />323<br />324<br />325<br />326<br />327<br />328<br />329<br />330<br />331<br />332<br />333<br />334<br />335<br />336<br />337<br />338<br />339<br />340<br />341<br />342<br />343<br />344<br />345<br />346<br />347<br />348<br />349<br />350<br />351<br />352<br />353<br />354<br />355<br />356<br />357<br />358<br />359<br />360<br />361<br />362<br />363<br />364<br />365<br />366<br />367<br />368<br />369<br />370<br />371<br />372<br />373<br />374<br />375<br />376<br />377<br />378<br />379<br />380<br />381<br />382<br />383<br />384<br />385<br />386<br />387<br />388<br />389<br />390<br />391<br />392<br />393<br />394<br />395<br />396<br />397<br />398<br />399<br />400<br />401<br />402<br />403<br />404<br />405<br />406<br />407<br />408<br />409<br />410<br />411<br />412<br />413<br />414<br />415<br />416<br />417<br />418<br />419<br />420<br />421<br />422<br />423<br />424<br />425<br />426<br />427<br />428<br />429<br />430<br />431<br />432<br />433<br />434<br />435<br />436<br />437<br />438<br />439<br />440<br />441<br />442<br />443<br />444<br />445<br />446<br />447<br />448<br />449<br />450<br />451<br />452<br />453<br />454<br />455<br />456<br />457<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co1\">// AccelStepper.h</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">/// \\mainpage AccelStepper library for Arduino</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// This is the Arduino AccelStepper library.</span><br /><span class=\"co1\">/// It provides an object-oriented interface for 2 or 4 pin stepper motors.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// The standard Arduino IDE includes the Stepper library</span><br /><span class=\"co1\">/// (http://arduino.cc/en/Reference/Stepper) for stepper motors. It is</span><br /><span class=\"co1\">/// perfectly adequate for simple, single motor applications.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// AccelStepper significantly improves on the standard Arduino Stepper library in several ways:</span><br /><span class=\"co1\">/// \\li Supports acceleration and deceleration</span><br /><span class=\"co1\">/// \\li Supports multiple simultaneous steppers, with independent concurrent stepping on each stepper</span><br /><span class=\"co1\">/// \\li API functions never delay() or block</span><br /><span class=\"co1\">/// \\li Supports 2 and 4 wire steppers, plus 4 wire half steppers.</span><br /><span class=\"co1\">/// \\li Supports alternate stepping functions to enable support of AFMotor (https://github.com/adafruit/Adafruit-Motor-Shield-library)</span><br /><span class=\"co1\">/// \\li Supports stepper drivers such as the Sparkfun EasyDriver (based on 3967 driver chip)</span><br /><span class=\"co1\">/// \\li Very slow speeds are supported</span><br /><span class=\"co1\">/// \\li Extensive API</span><br /><span class=\"co1\">/// \\li Subclass support</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// The latest version of this documentation can be downloaded from </span><br /><span class=\"co1\">/// http://www.open.com.au/mikem/arduino/AccelStepper</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// Example Arduino programs are included to show the main modes of use.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// The version of the package that this documentation refers to can be downloaded </span><br /><span class=\"co1\">/// from http://www.open.com.au/mikem/arduino/AccelStepper/AccelStepper-1.18.zip</span><br /><span class=\"co1\">/// You can find the latest version at http://www.open.com.au/mikem/arduino/AccelStepper</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// You can also find online help and disussion at http://groups.google.com/group/accelstepper</span><br /><span class=\"co1\">/// Please use that group for all questions and discussions on this topic. </span><br /><span class=\"co1\">/// Do not contact the author directly, unless it is to discuss commercial licensing.</span><br /><span class=\"co1\">//</span><br /><span class=\"co1\">/// Tested on Arduino Diecimila and Mega with arduino-0018 &amp; arduino-0021 </span><br /><span class=\"co1\">/// on OpenSuSE 11.1 and avr-libc-1.6.1-1.15,</span><br /><span class=\"co1\">/// cross-avr-binutils-2.19-9.1, cross-avr-gcc-4.1.3_20080612-26.5.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\par Installation</span><br /><span class=\"co1\">/// Install in the usual way: unzip the distribution zip file to the libraries</span><br /><span class=\"co1\">/// sub-folder of your sketchbook. </span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// This software is Copyright (C) 2010 Mike McCauley. Use is subject to license</span><br /><span class=\"co1\">/// conditions. The main licensing options available are GPL V2 or Commercial:</span><br /><span class=\"co1\">/// </span><br /><span class=\"co1\">/// \\par Open Source Licensing GPL V2</span><br /><span class=\"co1\">/// This is the appropriate option if you want to share the source code of your</span><br /><span class=\"co1\">/// application with everyone you distribute it to, and you also want to give them</span><br /><span class=\"co1\">/// the right to share who uses it. If you wish to use this software under Open</span><br /><span class=\"co1\">/// Source Licensing, you must contribute all your source code to the open source</span><br /><span class=\"co1\">/// community in accordance with the GPL Version 2 when your application is</span><br /><span class=\"co1\">/// distributed. See http://www.gnu.org/copyleft/gpl.html</span><br /><span class=\"co1\">/// </span><br /><span class=\"co1\">/// \\par Commercial Licensing</span><br /><span class=\"co1\">/// This is the appropriate option if you are creating proprietary applications</span><br /><span class=\"co1\">/// and you are not prepared to distribute and share the source code of your</span><br /><span class=\"co1\">/// application. Contact info@open.com.au for details.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\par Revision History</span><br /><span class=\"co1\">/// \\version 1.0 Initial release</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\version 1.1 Added speed() function to get the current speed.</span><br /><span class=\"co1\">/// \\version 1.2 Added runSpeedToPosition() submitted by Gunnar Arndt.</span><br /><span class=\"co1\">/// \\version 1.3 Added support for stepper drivers (ie with Step and Direction inputs) with _pins == 1</span><br /><span class=\"co1\">/// \\version 1.4 Added functional contructor to support AFMotor, contributed by Limor, with example sketches.</span><br /><span class=\"co1\">/// \\version 1.5 Improvements contributed by Peter Mousley: Use of microsecond steps and other speed improvements</span><br /><span class=\"co1\">///       to increase max stepping speed to about 4kHz. New option for user to set the min allowed pulse width.</span><br /><span class=\"co1\">///       Added checks for already running at max speed and skip further calcs if so. </span><br /><span class=\"co1\">/// \\version 1.6 Fixed a problem with wrapping of microsecond stepping that could cause stepping to hang. </span><br /><span class=\"co1\">///       Reported by Sandy Noble.</span><br /><span class=\"co1\">///       Removed redundant _lastRunTime member.</span><br /><span class=\"co1\">/// \\version 1.7 Fixed a bug where setCurrentPosition() did always work as expected. Reported by Peter Linhart.</span><br /><span class=\"co1\">///       Reported by Sandy Noble.</span><br /><span class=\"co1\">///       Removed redundant _lastRunTime member.</span><br /><span class=\"co1\">/// \\version 1.8 Added support for 4 pin half-steppers, requested by Harvey Moon</span><br /><span class=\"co1\">/// \\version 1.9 setCurrentPosition() now also sets motor speed to 0.</span><br /><span class=\"co1\">/// \\version 1.10 Builds on Arduino 1.0</span><br /><span class=\"co1\">/// \\version 1.11 Improvments from Michael Ellison:</span><br /><span class=\"co1\">///  Added optional enable line support for stepper drivers</span><br /><span class=\"co1\">///  Added inversion for step/direction/enable lines for stepper drivers</span><br /><span class=\"co1\">/// \\version 1.12 Announce Google Group</span><br /><span class=\"co1\">/// \\version 1.13 Improvements to speed calculation. Cost of calculation is now less in the worst case, </span><br /><span class=\"co1\">///  and more or less constant in all cases. This should result in slightly beter high speed performance, and</span><br /><span class=\"co1\">///  reduce anomalous speed glitches when other steppers are accelerating. </span><br /><span class=\"co1\">///  However, its hard to see how to replace the sqrt() required at the very first step from 0 speed.</span><br /><span class=\"co1\">/// \\version 1.14 Fixed a problem with compiling under arduino 0021 reported by EmbeddedMan</span><br /><span class=\"co1\">/// \\version 1.15 Fixed a problem with runSpeedToPosition which did not correctly handle</span><br /><span class=\"co1\">///  running backwards to a smaller target position. Added examples</span><br /><span class=\"co1\">/// \\version 1.16 Fixed some cases in the code where abs() was used instead of fabs().</span><br /><span class=\"co1\">/// \\version 1.17 Added example ProportionalControl</span><br /><span class=\"co1\">/// \\version 1.18 Fixed a problem: If one calls the funcion runSpeed() when Speed is zero, it makes steps </span><br /><span class=\"co1\">///  without counting. reported by Friedrich, Klappenbach.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\author Mike McCauley (mikem@open.com.au)</span><br /><span class=\"co1\">// Copyright (C) 2009 Mike McCauley</span><br /><span class=\"co1\">// $Id: AccelStepper.h,v 1.6 2012/01/28 22:45:28 mikem Exp mikem $</span><br /><br /><span class=\"co2\">#ifndef AccelStepper_h</span><br /><span class=\"co2\">#define AccelStepper_h</span><br /><br /><span class=\"co2\">#include &lt;stdlib.h&gt;</span><br /><span class=\"co2\">#if ARDUINO &gt;= 100</span><br /><span class=\"co2\">#include &lt;Arduino.h&gt;</span><br /><span class=\"co2\">#else</span><br /><span class=\"co2\">#include &lt;WProgram.h&gt;</span><br /><span class=\"co2\">#include &lt;wiring.h&gt;</span><br /><span class=\"co2\">#endif</span><br /><br /><span class=\"co1\">// These defs cause trouble on some versions of Arduino</span><br /><span class=\"co2\">#undef round</span><br /><br /><span class=\"co1\">/////////////////////////////////////////////////////////////////////</span><br /><span class=\"co1\">/// \\class AccelStepper AccelStepper.h &lt;AccelStepper.h&gt;</span><br /><span class=\"co1\">/// \\brief Support for stepper motors with acceleration etc.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// This defines a single 2 or 4 pin stepper motor, or stepper moter with fdriver chip, with optional</span><br /><span class=\"co1\">/// acceleration, deceleration, absolute positioning commands etc. Multiple</span><br /><span class=\"co1\">/// simultaneous steppers are supported, all moving </span><br /><span class=\"co1\">/// at different speeds and accelerations. </span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\par Operation</span><br /><span class=\"co1\">/// This module operates by computing a step time in microseconds. The step</span><br /><span class=\"co1\">/// time is recomputed after each step and after speed and acceleration</span><br /><span class=\"co1\">/// parameters are changed by the caller. The time of each step is recorded in</span><br /><span class=\"co1\">/// microseconds. The run() function steps the motor if a new step is due.</span><br /><span class=\"co1\">/// The run() function must be called frequently until the motor is in the</span><br /><span class=\"co1\">/// desired position, after which time run() will do nothing.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\par Positioning</span><br /><span class=\"co1\">/// Positions are specified by a signed long integer. At</span><br /><span class=\"co1\">/// construction time, the current position of the motor is consider to be 0. Positive</span><br /><span class=\"co1\">/// positions are clockwise from the initial position; negative positions are</span><br /><span class=\"co1\">/// anticlockwise. The curent position can be altered for instance after</span><br /><span class=\"co1\">/// initialization positioning.</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// \\par Caveats</span><br /><span class=\"co1\">/// This is an open loop controller: If the motor stalls or is oversped,</span><br /><span class=\"co1\">/// AccelStepper will not have a correct </span><br /><span class=\"co1\">/// idea of where the motor really is (since there is no feedback of the motor\'s</span><br /><span class=\"co1\">/// real position. We only know where we _think_ it is, relative to the</span><br /><span class=\"co1\">/// initial starting point).</span><br /><span class=\"co1\">///</span><br /><span class=\"co1\">/// The fastest motor speed that can be reliably supported is 4000 steps per</span><br /><span class=\"co1\">/// second (4 kHz) at a clock frequency of 16 MHz. However, any speed less than that</span><br /><span class=\"co1\">/// down to very slow speeds (much less than one per second) are also supported,</span><br /><span class=\"co1\">/// provided the run() function is called frequently enough to step the motor</span><br /><span class=\"co1\">/// whenever required for the speed set.</span><br />class AccelStepper<br /><span class=\"br0\">&#123;</span><br />public<span class=\"sy0\">:</span><br />  <span class=\"co1\">/// Constructor. You can have multiple simultaneous steppers, all moving</span><br />  <span class=\"co1\">/// at different speeds and accelerations, provided you call their run()</span><br />  <span class=\"co1\">/// functions at frequent enough intervals. Current Position is set to 0, target</span><br />  <span class=\"co1\">/// position is set to 0. MaxSpeed and Acceleration default to 1.0.</span><br />  <span class=\"co1\">/// The motor pins will be initialised to OUTPUT mode during the</span><br />  <span class=\"co1\">/// constructor by a call to enableOutputs().</span><br />  <span class=\"co1\">/// \\param[in] pins Number of pins to interface to. 1, 2 or 4 are</span><br />  <span class=\"co1\">/// supported. 1 means a stepper driver (with Step and Direction pins).</span><br />  <span class=\"co1\">/// If an enable line is also needed, call setEnablePin() after construction.</span><br />  <span class=\"co1\">/// You may also invert the pins using setPinsInverted().</span><br />  <span class=\"co1\">/// 2 means a 2 wire stepper. 4 means a 4 wire stepper. 8 means a 4 wire half stepper</span><br />  <span class=\"co1\">/// Defaults to 4 pins.</span><br />  <span class=\"co1\">/// \\param[in] pin1 Arduino digital pin number for motor pin 1. Defaults</span><br />  <span class=\"co1\">/// to pin 2. For a driver (pins==1), this is the Step input to the driver. Low to high transition means to step)</span><br />  <span class=\"co1\">/// \\param[in] pin2 Arduino digital pin number for motor pin 2. Defaults</span><br />  <span class=\"co1\">/// to pin 3. For a driver (pins==1), this is the Direction input the driver. High means forward.</span><br />  <span class=\"co1\">/// \\param[in] pin3 Arduino digital pin number for motor pin 3. Defaults</span><br />  <span class=\"co1\">/// to pin 4.</span><br />  <span class=\"co1\">/// \\param[in] pin4 Arduino digital pin number for motor pin 4. Defaults</span><br />  <span class=\"co1\">/// to pin 5.</span><br />  AccelStepper<span class=\"br0\">&#40;</span>uint8_t pins <span class=\"sy0\">=</span> 4<span class=\"sy0\">,</span> uint8_t pin1 <span class=\"sy0\">=</span> 2<span class=\"sy0\">,</span> uint8_t pin2 <span class=\"sy0\">=</span> 3<span class=\"sy0\">,</span> uint8_t pin3 <span class=\"sy0\">=</span> 4<span class=\"sy0\">,</span> uint8_t pin4 <span class=\"sy0\">=</span> 5<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Alternate Constructor which will call your own functions for forward and backward steps. </span><br />  <span class=\"co1\">/// You can have multiple simultaneous steppers, all moving</span><br />  <span class=\"co1\">/// at different speeds and accelerations, provided you call their run()</span><br />  <span class=\"co1\">/// functions at frequent enough intervals. Current Position is set to 0, target</span><br />  <span class=\"co1\">/// position is set to 0. MaxSpeed and Acceleration default to 1.0.</span><br />  <span class=\"co1\">/// Any motor initialization should happen before hand, no pins are used or initialized.</span><br />  <span class=\"co1\">/// \\param[in] forward void-returning procedure that will make a forward step</span><br />  <span class=\"co1\">/// \\param[in] backward void-returning procedure that will make a backward step</span><br />  AccelStepper<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>forward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">,</span> <span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>backward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />  <span class=\"co1\">/// Set the target position. The run() function will try to move the motor</span><br />  <span class=\"co1\">/// from the current position to the target position set by the most</span><br />  <span class=\"co1\">/// recent call to this function. Caution: moveTo() also recalculates the speed for the next step. </span><br />  <span class=\"co1\">/// If you are trying to use constant speed movements, you should call setSpeed() after calling moveTo().</span><br />  <span class=\"co1\">/// \\param[in] absolute The desired absolute position. Negative is</span><br />  <span class=\"co1\">/// anticlockwise from the 0 position.</span><br />  <span class=\"kw4\">void</span>  moveTo<span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> absolute<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><br />  <span class=\"co1\">/// Set the target position relative to the current position</span><br />  <span class=\"co1\">/// \\param[in] relative The desired position relative to the current position. Negative is</span><br />  <span class=\"co1\">/// anticlockwise from the current position.</span><br />  <span class=\"kw4\">void</span>  move<span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> relative<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Poll the motor and step it if a step is due, implementing</span><br />  <span class=\"co1\">/// accelerations and decelerations to acheive the target position. You must call this as</span><br />  <span class=\"co1\">/// frequently as possible, but at least once per minimum step interval,</span><br />  <span class=\"co1\">/// preferably in your main loop.</span><br />  <span class=\"co1\">/// \\return true if the motor is at the target position.</span><br />  boolean run<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Poll the motor and step it if a step is due, implmenting a constant</span><br />  <span class=\"co1\">/// speed as set by the most recent call to setSpeed(). You must call this as</span><br />  <span class=\"co1\">/// frequently as possible, but at least once per step interval,</span><br />  <span class=\"co1\">/// \\return true if the motor was stepped.</span><br />  boolean runSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the maximum permitted speed. the run() function will accelerate</span><br />  <span class=\"co1\">/// up to the speed set by this function.</span><br />  <span class=\"co1\">/// \\param[in] speed The desired maximum speed in steps per second. Must</span><br />  <span class=\"co1\">/// be &gt; 0. Speeds of more than 1000 steps per second are unreliable. </span><br />  <span class=\"kw4\">void</span>  setMaxSpeed<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the acceleration and deceleration parameter.</span><br />  <span class=\"co1\">/// \\param[in] acceleration The desired acceleration in steps per second</span><br />  <span class=\"co1\">/// per second. Must be &gt; 0.</span><br />  <span class=\"kw4\">void</span>  setAcceleration<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> acceleration<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the desired constant speed for use with runSpeed().</span><br />  <span class=\"co1\">/// \\param[in] speed The desired constant speed in steps per</span><br />  <span class=\"co1\">/// second. Positive is clockwise. Speeds of more than 1000 steps per</span><br />  <span class=\"co1\">/// second are unreliable. Very slow speeds may be set (eg 0.00027777 for</span><br />  <span class=\"co1\">/// once per hour, approximately. Speed accuracy depends on the Arduino</span><br />  <span class=\"co1\">/// crystal. Jitter depends on how frequently you call the runSpeed() function.</span><br />  <span class=\"kw4\">void</span>  setSpeed<span class=\"br0\">&#40;</span><span class=\"kw4\">float</span> speed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The most recently set speed</span><br />  <span class=\"co1\">/// \\return the most recent speed in steps per second</span><br />  <span class=\"kw4\">float</span>  speed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The distance from the current position to the target position.</span><br />  <span class=\"co1\">/// \\return the distance from the current position to the target position</span><br />  <span class=\"co1\">/// in steps. Positive is clockwise from the current position.</span><br />  <span class=\"kw4\">long</span>  distanceToGo<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The most recently set target position.</span><br />  <span class=\"co1\">/// \\return the target position</span><br />  <span class=\"co1\">/// in steps. Positive is clockwise from the 0 position.</span><br />  <span class=\"kw4\">long</span>  targetPosition<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><br />  <span class=\"co1\">/// The currently motor position.</span><br />  <span class=\"co1\">/// \\return the current motor position</span><br />  <span class=\"co1\">/// in steps. Positive is clockwise from the 0 position.</span><br />  <span class=\"kw4\">long</span>  currentPosition<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><br />  <span class=\"co1\">/// Resets the current position of the motor, so that wherever the motor</span><br />  <span class=\"co1\">/// happens to be right now is considered to be the new 0 position. Useful</span><br />  <span class=\"co1\">/// for setting a zero position on a stepper after an initial hardware</span><br />  <span class=\"co1\">/// positioning move.</span><br />  <span class=\"co1\">/// Has the side effect of setting the current motor speed to 0.</span><br />  <span class=\"co1\">/// \\param[in] position The position in steps of wherever the motor</span><br />  <span class=\"co1\">/// happens to be right now.</span><br />  <span class=\"kw4\">void</span>  setCurrentPosition<span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> position<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br />  <br />  <span class=\"co1\">/// Moves the motor at the currently selected constant speed (forward or reverse) </span><br />  <span class=\"co1\">/// to the target position and blocks until it is at</span><br />  <span class=\"co1\">/// position. Dont use this in event loops, since it blocks.</span><br />  <span class=\"kw4\">void</span>  runToPosition<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Runs at the currently selected speed until the target position is reached</span><br />  <span class=\"co1\">/// Does not implement accelerations.</span><br />  <span class=\"co1\">/// \\return true if it stepped</span><br />  boolean runSpeedToPosition<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Moves the motor to the new target position and blocks until it is at</span><br />  <span class=\"co1\">/// position. Dont use this in event loops, since it blocks.</span><br />  <span class=\"co1\">/// \\param[in] position The new target position.</span><br />  <span class=\"kw4\">void</span>  runToNewPosition<span class=\"br0\">&#40;</span><span class=\"kw4\">long</span> position<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Disable motor pin outputs by setting them all LOW</span><br />  <span class=\"co1\">/// Depending on the design of your electronics this may turn off</span><br />  <span class=\"co1\">/// the power to the motor coils, saving power.</span><br />  <span class=\"co1\">/// This is useful to support Arduino low power modes: disable the outputs</span><br />  <span class=\"co1\">/// during sleep and then reenable with enableOutputs() before stepping</span><br />  <span class=\"co1\">/// again.</span><br />  <span class=\"kw4\">void</span>  disableOutputs<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Enable motor pin outputs by setting the motor pins to OUTPUT</span><br />  <span class=\"co1\">/// mode. Called automatically by the constructor.</span><br />  <span class=\"kw4\">void</span>  enableOutputs<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the minimum pulse width allowed by the stepper driver.</span><br />  <span class=\"co1\">/// \\param[in] minWidth The minimum pulse width in microseconds.</span><br />  <span class=\"kw4\">void</span>  setMinPulseWidth<span class=\"br0\">&#40;</span><span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span> minWidth<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the enable pin number for stepper drivers.</span><br />    <span class=\"co1\">/// 0xFF indicates unused (default).</span><br />  <span class=\"co1\">/// Otherwise, if a pin is set, the pin will be turned on when </span><br />  <span class=\"co1\">/// enableOutputs() is called and switched off when disableOutputs() </span><br />  <span class=\"co1\">/// is called.</span><br />  <span class=\"co1\">/// \\param[in] enablePin Arduino digital pin number for motor enable</span><br />  <span class=\"co1\">/// \\sa setPinsInverted</span><br />  <span class=\"kw4\">void</span>  setEnablePin<span class=\"br0\">&#40;</span>uint8_t enablePin <span class=\"sy0\">=</span> 0xff<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Sets the inversion for stepper driver pins</span><br />  <span class=\"co1\">/// \\param[in] direction True for inverted direction pin, false for non-inverted</span><br />  <span class=\"co1\">/// \\param[in] step   True for inverted step pin, false for non-inverted</span><br />  <span class=\"co1\">/// \\param[in] enable  True for inverted enable pin, false (default) for non-inverted</span><br />  <span class=\"kw4\">void</span>  setPinsInverted<span class=\"br0\">&#40;</span>bool direction<span class=\"sy0\">,</span> bool step<span class=\"sy0\">,</span> bool enable <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />protected<span class=\"sy0\">:</span><br /><br />  <span class=\"co1\">/// Forces the library to compute a new instantaneous speed and set that as</span><br />  <span class=\"co1\">/// the current speed. Calls</span><br />  <span class=\"co1\">/// desiredSpeed(), which can be overridden by subclasses. It is called by</span><br />  <span class=\"co1\">/// the library:</span><br />  <span class=\"co1\">/// \\li after each step</span><br />  <span class=\"co1\">/// \\li after change to maxSpeed through setMaxSpeed()</span><br />  <span class=\"co1\">/// \\li after change to acceleration through setAcceleration()</span><br />  <span class=\"co1\">/// \\li after change to target position (relative or absolute) through</span><br />  <span class=\"co1\">/// move() or moveTo()</span><br />  <span class=\"kw4\">void</span>      computeNewSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step. Only called when a new step is</span><br />  <span class=\"co1\">/// required. Subclasses may override to implement new stepping</span><br />  <span class=\"co1\">/// interfaces. The default calls step1(), step2(), step4() or step8() depending on the</span><br />  <span class=\"co1\">/// number of pins defined for the stepper.</span><br />  <span class=\"co1\">/// \\param[in] step The current step phase number (0 to 7)</span><br />  virtual <span class=\"kw4\">void</span>  step<span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step using stepper functions (pins = 0) Only called when a new step is</span><br />  <span class=\"co1\">/// required. Calls _forward() or _backward() to perform the step</span><br />  virtual <span class=\"kw4\">void</span>  step0<span class=\"br0\">&#40;</span><span class=\"kw4\">void</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step on a stepper drover (ie where pins == 1). Only called when a new step is</span><br />  <span class=\"co1\">/// required. Subclasses may override to implement new stepping</span><br />  <span class=\"co1\">/// interfaces. The default sets or clears the outputs of Step pin1 to step, </span><br />  <span class=\"co1\">/// and sets the output of _pin2 to the desired direction. The Step pin (_pin1) is pulsed for 1 microsecond</span><br />  <span class=\"co1\">/// which is the minimum STEP pulse width for the 3967 driver.</span><br />  <span class=\"co1\">/// \\param[in] step The current step phase number (0 to 7)</span><br />  virtual <span class=\"kw4\">void</span>  step1<span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step on a 2 pin motor. Only called when a new step is</span><br />  <span class=\"co1\">/// required. Subclasses may override to implement new stepping</span><br />  <span class=\"co1\">/// interfaces. The default sets or clears the outputs of pin1 and pin2</span><br />  <span class=\"co1\">/// \\param[in] step The current step phase number (0 to 7)</span><br />  virtual <span class=\"kw4\">void</span>  step2<span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step on a 4 pin motor. Only called when a new step is</span><br />  <span class=\"co1\">/// required. Subclasses may override to implement new stepping</span><br />  <span class=\"co1\">/// interfaces. The default sets or clears the outputs of pin1, pin2,</span><br />  <span class=\"co1\">/// pin3, pin4.</span><br />  <span class=\"co1\">/// \\param[in] step The current step phase number (0 to 7)</span><br />  virtual <span class=\"kw4\">void</span>  step4<span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Called to execute a step on a 4 pin half-steper motor. Only called when a new step is</span><br />  <span class=\"co1\">/// required. Subclasses may override to implement new stepping</span><br />  <span class=\"co1\">/// interfaces. The default sets or clears the outputs of pin1, pin2,</span><br />  <span class=\"co1\">/// pin3, pin4.</span><br />  <span class=\"co1\">/// \\param[in] step The current step phase number (0 to 7)</span><br />  virtual <span class=\"kw4\">void</span>  step8<span class=\"br0\">&#40;</span>uint8_t step<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Compute and return the desired speed. The default algorithm uses</span><br />  <span class=\"co1\">/// maxSpeed, acceleration and the current speed to set a new speed to</span><br />  <span class=\"co1\">/// move the motor from teh current position to the target</span><br />  <span class=\"co1\">/// position. Subclasses may override this to provide an alternate</span><br />  <span class=\"co1\">/// algorithm (but do not block). Called by computeNewSpeed whenever a new speed neds to be</span><br />  <span class=\"co1\">/// computed. </span><br />  virtual <span class=\"kw4\">float</span> desiredSpeed<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />  <br />private<span class=\"sy0\">:</span><br />  <span class=\"co1\">/// Number of pins on the stepper motor. Permits 2 or 4. 2 pins is a</span><br />  <span class=\"co1\">/// bipolar, and 4 pins is a unipolar.</span><br />  uint8_t    _pins<span class=\"sy0\">;</span>     <span class=\"co1\">// 2 or 4</span><br /><br />  <span class=\"co1\">/// Arduino pin number for the 2 or 4 pins required to interface to the</span><br />  <span class=\"co1\">/// stepper motor.</span><br />  uint8_t    _pin1<span class=\"sy0\">,</span> _pin2<span class=\"sy0\">,</span> _pin3<span class=\"sy0\">,</span> _pin4<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The current absolution position in steps.</span><br />  <span class=\"kw4\">long</span>      _currentPos<span class=\"sy0\">;</span>  <span class=\"co1\">// Steps</span><br /><br />  <span class=\"co1\">/// The target position in steps. The AccelStepper library will move the</span><br />  <span class=\"co1\">/// motor from the _currentPos to the _targetPos, taking into account the</span><br />  <span class=\"co1\">/// max speed, acceleration and deceleration</span><br />  <span class=\"kw4\">long</span>      _targetPos<span class=\"sy0\">;</span>   <span class=\"co1\">// Steps</span><br /><br />  <span class=\"co1\">/// The current motos speed in steps per second</span><br />  <span class=\"co1\">/// Positive is clockwise</span><br />  <span class=\"kw4\">float</span>     _speed<span class=\"sy0\">;</span>     <span class=\"co1\">// Steps per second</span><br /><br />  <span class=\"co1\">/// The maximum permitted speed in steps per second. Must be &gt; 0.</span><br />  <span class=\"kw4\">float</span>     _maxSpeed<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The acceleration to use to accelerate or decelerate the motor in steps</span><br />  <span class=\"co1\">/// per second per second. Must be &gt; 0</span><br />  <span class=\"kw4\">float</span>     _acceleration<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The current interval between steps in microseconds</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">long</span> _stepInterval<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The last step time in microseconds</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">long</span> _lastStepTime<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The minimum allowed pulse width in microseconds</span><br />  <span class=\"kw4\">unsigned</span> <span class=\"kw4\">int</span>  _minPulseWidth<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Is the direction pin inverted?</span><br />  bool      _dirInverted<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Is the step pin inverted?</span><br />  bool      _stepInverted<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Is the enable pin inverted?</span><br />  bool      _enableInverted<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// Enable pin for stepper driver, or 0xFF if unused.</span><br />  uint8_t    _enablePin<span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The pointer to a forward-step procedure</span><br />  <span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>_forward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br />  <span class=\"co1\">/// The pointer to a backward-step procedure</span><br />  <span class=\"kw4\">void</span> <span class=\"br0\">&#40;</span><span class=\"sy0\">*</span>_backward<span class=\"br0\">&#41;</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span><span class=\"sy0\">;</span><br /><br /><span class=\"co1\">/// @example Random.pde</span><br /><span class=\"co1\">/// Make a single stepper perform random changes in speed, position and acceleration</span><br /><br /><span class=\"co1\">/// @example Overshoot.pde</span><br /><span class=\"co1\">/// Check overshoot handling</span><br /><span class=\"co1\">/// which sets a new target position and then waits until the stepper has </span><br /><span class=\"co1\">/// achieved it. This is used for testing the handling of overshoots</span><br /><br /><span class=\"co1\">/// @example MultiStepper.pde</span><br /><span class=\"co1\">/// Shows how to multiple simultaneous steppers</span><br /><span class=\"co1\">/// Runs one stepper forwards and backwards, accelerating and decelerating</span><br /><span class=\"co1\">/// at the limits. Runs other steppers at the same time</span><br /><br /><span class=\"co1\">/// @example ConstantSpeed.pde</span><br /><span class=\"co1\">/// Shows how to run AccelStepper in the simplest,</span><br /><span class=\"co1\">/// fixed speed mode with no accelerations</span><br /><br /><span class=\"co1\">/// @example Blocking.pde </span><br /><span class=\"co1\">/// Shows how to use the blocking call runToNewPosition</span><br /><span class=\"co1\">/// Which sets a new target position and then waits until the stepper has </span><br /><span class=\"co1\">/// achieved it.</span><br /><br /><span class=\"co1\">/// @example AFMotor_MultiStepper.pde</span><br /><span class=\"co1\">/// Control both Stepper motors at the same time with different speeds</span><br /><span class=\"co1\">/// and accelerations. </span><br /><br /><span class=\"co1\">/// @example AFMotor_ConstantSpeed.pde</span><br /><span class=\"co1\">/// Shows how to run AccelStepper in the simplest,</span><br /><span class=\"co1\">/// fixed speed mode with no accelerations</span><br /><br /><span class=\"co1\">/// @example ProportionalControl.pde</span><br /><span class=\"co1\">/// Make a single stepper follow the analog value read from a pot or whatever</span><br /><span class=\"co1\">/// The stepper will move at a constant speed to each newly set posiiton, </span><br /><span class=\"co1\">/// depending on the value of the pot.</span><br /><br /><span class=\"co2\">#endif </span><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper LICENSE\" id=\"da124e128e76986181065bb6cb7a773d88d3b10e\">  <p class=\"fileHead\">LICENSE</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>This software is Copyright (C) 2008 Mike McCauley. Use is subject to license<br />conditions. The main licensing options available are GPL V2 or Commercial:<br /><br />Open Source Licensing GPL V2<br /><br />This is the appropriate option if you want to share the source code of your<br />application with everyone you distribute it to, and you also want to give them<br />the right to share who uses it. If you wish to use this software under Open<br />Source Licensing, you must contribute all your source code to the open source<br />community in accordance with the GPL Version 2 when your application is<br />distributed. See http://www.gnu.org/copyleft/gpl.html<br /><br />Commercial Licensing<br /><br />This is the appropriate option if you are creating proprietary applications<br />and you are not prepared to distribute and share the source code of your<br />application. Contact info@open.com.au for details.<br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"0d4e95c36929b172465e301dfa4a7ed13fe3791f\">  <p class=\"fileHead\">keywords.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>#######################################<br /># Syntax Coloring Map For AccelStepper<br />#######################################<br /><br />#######################################<br /># Datatypes (KEYWORD1)<br />#######################################<br /><br />AccelStepper      KEYWORD1<br /><br />#######################################<br /># Methods and Functions (KEYWORD2)<br />#######################################<br /><br />moveTo         KEYWORD2<br />move          KEYWORD2<br />run           KEYWORD2<br />runSpeed        KEYWORD2<br />setMaxSpeed       KEYWORD2<br />setAcceleration     KEYWORD2<br />setSpeed        KEYWORD2<br />speed          KEYWORD2<br />distanceToGo      KEYWORD2<br />targetPosition     KEYWORD2<br />currentPosition     KEYWORD2<br />steCurrentPosition   KEYWORD2<br />runToPosition      KEYWORD2<br />runSpeedToPosition   KEYWORD2<br />runToNewPosition    KEYWORD2<br />disableOutputs     KEYWORD2<br />enableOutputs      KEYWORD2<br />setMinPulseWidth    KEYWORD2<br /><br />#######################################<br /># Constants (LITERAL1)<br />#######################################<br /><br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper txt\" id=\"58759e2d1b2e49c264d59489dfe0e1aca7d3bc1d\">  <p class=\"fileHead\">License.txt</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code>MIT License<br />Copyright (c) 2010 bildr community<br /><br />Permission is hereby granted, free of charge, to any person obtaining a copy<br />of this software and associated documentation files (the &quot;Software&quot;), to deal<br />in the Software without restriction, including without limitation the rights<br />to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br />copies of the Software, and to permit persons to whom the Software is<br />furnished to do so, subject to the following conditions:<br /><br />The above copyright notice and this permission notice shall be included in<br />all copies or substantial portions of the Software.<br /><br />THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br />AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br />LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br />OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br />THE SOFTWARE.<br /></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper md\" id=\"c7e580b8ec07c7d62d22cd45f54c06a75bc63609\">  <p class=\"fileHead\">README.md</p>    <div class=\"fileCodeWrapper\">    <div class=\"code\">  <div class=\"markdown\"><h1>AccelStepper</h1><p>Arduino code for the Easy Driver step motor controller</p><p>For complete hookup and tutorial see: <a href=\"http://adam-meyer.com/arduino/big_easy\">http://adam-meyer.com/arduino/big_easy</a></p><p>The code is provided under the MIT license please use, edit, change, and share. </p><p><em>Before loading any of the examples, or even opening the arduino software, place the AccelStepper folder in your arduino library.</em></p><h5>ARDUINO LIBRARY LOCATION</h5><ul><li>On your Mac:: In (home directory)/Documents/Arduino/libraries  </li><li>On your PC:: My Documents -&gt; Arduino -&gt; libraries  </li><li>On your Linux box: (home directory)/sketchbook/libraries  </li></ul><p>For all my arduino articles: <a href=\"http://adam-meyer.com/arduino/\">http://adam-meyer.com/arduino/</a></p></div>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"0713cc245297096653ed590b58834f1f0eb387c2\">  <p class=\"fileHead\">one_stepper_example.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co1\">//This is an example of how you would control 1 stepper</span><br /><br /><span class=\"co2\">#include &lt;AccelStepper.h&gt;</span><br /><br /><span class=\"kw4\">int</span> motorSpeed <span class=\"sy0\">=</span> <span class=\"nu0\">9600</span><span class=\"sy0\">;</span> <span class=\"co1\">//maximum steps per second (about 3rps / at 16 microsteps)</span><br /><span class=\"kw4\">int</span> motorAccel <span class=\"sy0\">=</span> <span class=\"nu0\">80000</span><span class=\"sy0\">;</span> <span class=\"co1\">//steps/second/second to accelerate</span><br /><br /><span class=\"kw4\">int</span> motorDirPin <span class=\"sy0\">=</span> <span class=\"nu0\">2</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 2</span><br /><span class=\"kw4\">int</span> motorStepPin <span class=\"sy0\">=</span> <span class=\"nu0\">3</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 3</span><br /><br /><span class=\"co1\">//set up the accelStepper intance</span><br /><span class=\"co1\">//the &quot;1&quot; tells it we are using a driver</span><br />AccelStepper stepper<span class=\"br0\">&#40;</span>1<span class=\"sy0\">,</span> motorStepPin<span class=\"sy0\">,</span> motorDirPin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /><br /><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> stepper.<span class=\"me1\">setMaxSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper.<span class=\"me1\">setSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper.<span class=\"me1\">setAcceleration</span><span class=\"br0\">&#40;</span>motorAccel<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> stepper.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span>32000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//move 32000 steps (should be 10 rev)</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <br /> <span class=\"co1\">//if stepper is at desired location</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>stepper.<span class=\"me1\">distanceToGo</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">==</span> <span class=\"nu0\">0</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  <span class=\"co1\">//go the other way the same amount of steps</span><br />  <span class=\"co1\">//so if current position is 400 steps out, go position -400</span><br />  stepper.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span><span class=\"sy0\">-</span>stepper.<span class=\"me1\">currentPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"br0\">&#125;</span><br /> <br /><br /> <br /> <span class=\"co1\">//these must be called as often as possible to ensure smooth operation</span><br /> <span class=\"co1\">//any delay will cause jerky motion</span><br /> stepper.<span class=\"me1\">run</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span></code></pre>  </div>  </div>  </div>      <div class=\"fileWrapper ino\" id=\"a06730d044ef09238e4a721985cdda654e56dd9e\">  <p class=\"fileHead\">two_steppers.ino</p>    <div class=\"fileCodeWrapper\">    <div class=\"lineNumbers\">  1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br />54<br />55<br />56<br />  </div>  <div class=\"code\">  <pre class=\"code\"><code><span class=\"co1\">//This is an example of how you would control 2 steppers at the same time</span><br /><br /><span class=\"co2\">#include &lt;AccelStepper.h&gt;</span><br /><br /><span class=\"kw4\">int</span> motorSpeed <span class=\"sy0\">=</span> <span class=\"nu0\">9600</span><span class=\"sy0\">;</span> <span class=\"co1\">//maximum steps per second (about 3rps / at 16 microsteps)</span><br /><span class=\"kw4\">int</span> motorAccel <span class=\"sy0\">=</span> <span class=\"nu0\">80000</span><span class=\"sy0\">;</span> <span class=\"co1\">//steps/second/second to accelerate</span><br /><br /><span class=\"kw4\">int</span> motor1DirPin <span class=\"sy0\">=</span> <span class=\"nu0\">2</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 2</span><br /><span class=\"kw4\">int</span> motor1StepPin <span class=\"sy0\">=</span> <span class=\"nu0\">3</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 3</span><br /><br /><span class=\"kw4\">int</span> motor2DirPin <span class=\"sy0\">=</span> <span class=\"nu0\">4</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 4</span><br /><span class=\"kw4\">int</span> motor2StepPin <span class=\"sy0\">=</span> <span class=\"nu0\">5</span><span class=\"sy0\">;</span> <span class=\"co1\">//digital pin 5</span><br /><br /><span class=\"co1\">//set up the accelStepper intances</span><br /><span class=\"co1\">//the &quot;1&quot; tells it we are using a driver</span><br />AccelStepper stepper1<span class=\"br0\">&#40;</span>1<span class=\"sy0\">,</span> motor1StepPin<span class=\"sy0\">,</span> motor1DirPin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br />AccelStepper stepper2<span class=\"br0\">&#40;</span>1<span class=\"sy0\">,</span> motor2StepPin<span class=\"sy0\">,</span> motor2DirPin<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /><br /><span class=\"kw4\">void</span> setup<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> stepper1.<span class=\"me1\">setMaxSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper2.<span class=\"me1\">setMaxSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> stepper1.<span class=\"me1\">setSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper2.<span class=\"me1\">setSpeed</span><span class=\"br0\">&#40;</span>motorSpeed<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><br /> stepper1.<span class=\"me1\">setAcceleration</span><span class=\"br0\">&#40;</span>motorAccel<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper2.<span class=\"me1\">setAcceleration</span><span class=\"br0\">&#40;</span>motorAccel<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> <br /> stepper1.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span>32000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//move 32000 steps (should be 10 rev)</span><br /> stepper2.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span>15000<span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <span class=\"co1\">//move 15000 steps</span><br /><span class=\"br0\">&#125;</span><br /><br /><span class=\"kw4\">void</span> loop<span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br /> <br /> <span class=\"co1\">//if stepper1 is at desired location</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>stepper1.<span class=\"me1\">distanceToGo</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">==</span> <span class=\"nu0\">0</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  <span class=\"co1\">//go the other way the same amount of steps</span><br />  <span class=\"co1\">//so if current position is 400 steps out, go position -400</span><br />  stepper1.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span><span class=\"sy0\">-</span>stepper1.<span class=\"me1\">currentPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"br0\">&#125;</span><br /> <br /> <span class=\"co1\">//if stepper2 is at desired location</span><br /> <span class=\"kw1\">if</span> <span class=\"br0\">&#40;</span>stepper2.<span class=\"me1\">distanceToGo</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span> <span class=\"sy0\">==</span> <span class=\"nu0\">0</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#123;</span><br />  <span class=\"co1\">//go the other way the same amount of steps</span><br />  <span class=\"co1\">//so if current position is 400 steps out, go position -400</span><br />  stepper2.<span class=\"me1\">moveTo</span><span class=\"br0\">&#40;</span><span class=\"sy0\">-</span>stepper2.<span class=\"me1\">currentPosition</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span> <br /> <span class=\"br0\">&#125;</span>   <br /><br /> <br /> <span class=\"co1\">//these must be called as often as possible to ensure smooth operation</span><br /> <span class=\"co1\">//any delay will cause jerky motion</span><br /> stepper1.<span class=\"me1\">run</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /> stepper2.<span class=\"me1\">run</span><span class=\"br0\">&#40;</span><span class=\"br0\">&#41;</span><span class=\"sy0\">;</span><br /><span class=\"br0\">&#125;</span></code></pre>  </div>  </div>  </div>    </div></div><div class=\"footer\">powered by <a title=\"github.com\" href=\"http://github.com\">github</a><!-- Served in 0.0075669288635254 sec - loaded from cache: yes - limitLeft:  of  --!></div></div>');
new Embed("AccelStepper_sidebar", "AccelStepper_code", {"sha":"cd0600451abcee4c5fd198363a8620404f887559","url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/trees\/cd0600451abcee4c5fd198363a8620404f887559","tree":[{"path":"AccelStepper\/AccelStepper.cpp","mode":"100755","type":"blob","sha":"e6ca34f1adf1f509f2b3ba5111982e072f8453a1","size":11382,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/e6ca34f1adf1f509f2b3ba5111982e072f8453a1"},{"path":"AccelStepper\/AccelStepper.h","mode":"100755","type":"blob","sha":"d15cbb27deec6b6c33aaf78382c3eb757cff7422","size":22220,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/d15cbb27deec6b6c33aaf78382c3eb757cff7422"},{"path":"AccelStepper\/LICENSE","mode":"100755","type":"blob","sha":"da124e128e76986181065bb6cb7a773d88d3b10e","size":841,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/da124e128e76986181065bb6cb7a773d88d3b10e"},{"path":"AccelStepper\/keywords.txt","mode":"100755","type":"blob","sha":"0d4e95c36929b172465e301dfa4a7ed13fe3791f","size":877,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/0d4e95c36929b172465e301dfa4a7ed13fe3791f"},{"path":"License.txt","mode":"100644","type":"blob","sha":"58759e2d1b2e49c264d59489dfe0e1aca7d3bc1d","size":1086,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/58759e2d1b2e49c264d59489dfe0e1aca7d3bc1d"},{"path":"README.md","mode":"100644","type":"blob","sha":"c7e580b8ec07c7d62d22cd45f54c06a75bc63609","size":636,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/c7e580b8ec07c7d62d22cd45f54c06a75bc63609"},{"path":"one_stepper_example.ino","mode":"100755","type":"blob","sha":"0713cc245297096653ed590b58834f1f0eb387c2","size":1014,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/0713cc245297096653ed590b58834f1f0eb387c2"},{"path":"two_steppers.ino","mode":"100755","type":"blob","sha":"a06730d044ef09238e4a721985cdda654e56dd9e","size":1596,"url":"https:\/\/api.github.com\/repos\/ameyer\/AccelStepper\/git\/blobs\/a06730d044ef09238e4a721985cdda654e56dd9e"}],"truncated":false})

<!-- Served in 0.0088210105895996 sec - loaded from cache: yes - limitLeft:  of  --!>