<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>Muxing Around With The CD74HC4067 + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2011/01/CD74HC4067.jpg"/></p>
<div class="wideBody">
Have you ever found yourself running out of pins to read an array of analog sensors? Don't worry, you're not alone, it happens to the best of us, and there is something you can do about it. An analog / digital multiplexer like the CD74HC4067 (mux for short) can help multiply the amount of pins you have, and it is insanely easy to connect to your arduino or other microcontroller
</div>
<div class="columnBody">
<div class="leftColumn">
<p>The CD74HC4067 is a 16-Channel Analog Multiplexer/Demultiplexer. It is available in a breadboard-ready DIP package, or, if you are as addicted to breakout boards as I am, <a href="http://sparkfun.com">SparkFun</a> offers a breakout board SSOP <a href="http://www.sparkfun.com/products/9056">version</a>. What it allows you to do is use 4 digital pins, to control the flow of one pin to 16 others. It can actually be used in either direction, and even with serial or other digital interfaces. For this tutorial we are just going to read the value from 16 pots because buying 16 analog sensors for this would have been overkill.</p>
<p>A multiplexer of this sort really just acts as a 16 to one 1 switch. The 4 digital pins are used to set HIGH or LOW, in a binary fashion (0-15) to determine what pin "SIG" is connected to. So bringing all 4 pins LOW would switch the CD74HC4067 to channel 0 (so SIG and C0 would be connected), bringing them all HIGH would switch it to 15 (so SIG and C15 would be connected). It is simple binary, but in the off chance you are one of the 99.8% of the world who doesn't know binary, here is a simple table on the right.
</p></div>
<div class="rightColumn">
To simplify things, 1 is HIGH, 0 is LOW<br/>
0000 - 0<br/>
1000 - 1<br/>
0100 - 2<br/>
1100 - 3<br/>
0010 - 4<br/>
1010 - 5<br/>
0110 - 6<br/>
1110 - 7<br/>
0001 - 8<br/>
1001 - 9<br/>
0101 - 10<br/>
1101 - 11<br/>
0011 - 12<br/>
1011 - 13<br/>
0111 - 14<br/>
1111 - 15
</div>
</div>
<p>The schematic may seem complicated, but it is not. Not at all. And to prove it, look at the version on the left with out the pots; Much easier, right? The potentiometers are just connected with to ground and 5v, and the middle pin connected to one of the 16 channels on the CD74HC4067. 16 pots is just enough to make anything look scary little scary. Also of note is the EN, or enable, pin. The EN pin is a kill switch: pull it up to 5v to disable all channels, and ground it to enable them. Im just going to leave it at ground so we can use it and simplify things, but feel free to connect it to a digital pin, and control when the mux is enabled or disabled.</p>
<div class="columnBody">
<div class="leftColumn">
<a href="images/2011/01/CD74HC4067_Empty.png"><img alt="" class="noFrame" src="images/2011/01/CD74HC4067_Empty-1024x476.png" title="CD74HC4067_Empty"/></a><br/>
<strong>Nice and simple right?</strong>
</div>
<div class="rightColumn">
<a href="images/2011/01/CD74HC4067_withPots.png"><img alt="" class="noFrame" src="images/2011/01/CD74HC4067_withPots-1024x544.png" title="CD74HC4067_withPots"/></a><br/>
<strong>Same, but with pots connected to the 16 channel pins.</strong>
</div>
</div>
<p>For the code example I just took the binary table, made it into a simple array, and put it in a function that does this: You give the function a number 0-15. It looks up that number in the binary array, then it loops through those 4 numbers and sets S0, S1, S2, and S3 appropriately. (In the arduino software HIGH is the same as1 &amp; LOW is the same as 0). After it sets the pins so that SIG is connected to the correct channel, it then reads analog 0 (where SIG is connected to) and returns that value. So all you need to do is something like this</p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;"><span class="co1">//switch mux to channel 15 and read the value</span>
  <span class="kw4">int</span> val <span class="sy0">=</span> readMux<span class="br0">(</span>15<span class="br0">)</span><span class="sy0">;</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
<p>Here is the complete code. It loops through each channel on the mux, reads the value, then prints the value in the serial monitor.</p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;"><span class="co1">//Mux control pins</span>
<span class="kw4">int</span> s0 <span class="sy0">=</span> <span class="nu0">8</span><span class="sy0">;</span>
<span class="kw4">int</span> s1 <span class="sy0">=</span> <span class="nu0">9</span><span class="sy0">;</span>
<span class="kw4">int</span> s2 <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span>
<span class="kw4">int</span> s3 <span class="sy0">=</span> <span class="nu0">11</span><span class="sy0">;</span>

<span class="co1">//Mux in "SIG" pin</span>
<span class="kw4">int</span> SIG_pin <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>


<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>s0<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span> 
  <span class="kw3">pinMode</span><span class="br0">(</span>s1<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span> 
  <span class="kw3">pinMode</span><span class="br0">(</span>s2<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span> 
  <span class="kw3">pinMode</span><span class="br0">(</span>s3<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span> 

  <span class="kw3">digitalWrite</span><span class="br0">(</span>s0<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>s1<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>s2<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>s3<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">Serial</span>.<span class="me1">begin</span><span class="br0">(</span>9600<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>


<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>

  <span class="co1">//Loop through and read all 16 values</span>
  <span class="co1">//Reports back Value at channel 6 is: 346</span>
  <span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">16</span><span class="sy0">;</span> i <span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span>
    <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">"Value at channel "</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>i<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">"is : "</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span>readMux<span class="br0">(</span>i<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">delay</span><span class="br0">(</span>1000<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>

<span class="br0">}</span>


<span class="kw4">int</span> readMux<span class="br0">(</span><span class="kw4">int</span> channel<span class="br0">)</span><span class="br0">{</span>
  <span class="kw4">int</span> controlPin<span class="br0">[</span><span class="br0">]</span> <span class="sy0">=</span> <span class="br0">{</span>s0<span class="sy0">,</span> s1<span class="sy0">,</span> s2<span class="sy0">,</span> s3<span class="br0">}</span><span class="sy0">;</span>

  <span class="kw4">int</span> muxChannel<span class="br0">[</span><span class="nu0">16</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">4</span><span class="br0">]</span><span class="sy0">=</span><span class="br0">{</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 0</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 1</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 2</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 3</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 4</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 5</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 6</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 7</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 8</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 9</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 10</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 11</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 12</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 13</span>
    <span class="br0">{</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span><span class="sy0">,</span> <span class="co1">//channel 14</span>
    <span class="br0">{</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">}</span>  <span class="co1">//channel 15</span>
  <span class="br0">}</span><span class="sy0">;</span>

  <span class="co1">//loop through the 4 sig</span>
  <span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">4</span><span class="sy0">;</span> i <span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span>
    <span class="kw3">digitalWrite</span><span class="br0">(</span>controlPin<span class="br0">[</span>i<span class="br0">]</span><span class="sy0">,</span> muxChannel<span class="br0">[</span>channel<span class="br0">]</span><span class="br0">[</span>i<span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>

  <span class="co1">//read the value at the SIG pin</span>
  <span class="kw4">int</span> val <span class="sy0">=</span> <span class="kw3">analogRead</span><span class="br0">(</span>SIG_pin<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">//return the value</span>
  <span class="kw1">return</span> val<span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
<h3>Not just for reading</h3>
<p>The CD74HC4067 is capable of more than reading analog signals. It can be uses in either direction. So you could connect SIG to 5v, and then be able to switch the 5v to one of 16 channel pins if you needed to control 16 relays. It also works with serial. So... if you had 16 RFID readers that output serial, you could connect the SIG pin of the CD74HC4067 to digital 0 on the arduino (Serial RX pin) and the serial out of an RFID reader to one of the channels and be able to read from all 16 RFID readers.</p>
<p>The CD74HC4067 is a super simple to use bidirectional mux that can make your life a lot easier. So please, put this to good use, and don't let me see you controlling 16 LEDs with it.</p>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/cd74hc4067-arduino">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>