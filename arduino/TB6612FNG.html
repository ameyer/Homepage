<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>Controlling 2 motors with the TB6612FNG + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2012/03/TB6612FNG.jpg"/></p>
<div class="columnBody">
<div class="leftColumn">
<strong>First off</strong>: I know... we went overboard with the motor illustration.
<p>In <a href="./rfp30n06le-arduino">previous articles</a> we have discussed how to control motors with simple transistors. And... with PWM you could control the speed. But that is just one motor, and you can only go one direction. Today we are going to talk about the TB6612FNG dual motor driver, specifically the <a href="http://www.sparkfun.com/products/9457">TB6612FNG breakout board</a> from <a href="http://www.sparkfun.com/">sparkfun</a>.</p>
<p>The TB6612FNG isn't just a dual motor driver, it is a dual H-bridge. An h-bridge is basically a specific setup of transistors that allow you to switch direction of current. So hooked up to a motor, that means you can have it spin in both directions, and with PWM input, you can use your arduino to make them spin at any speed. Because the TB6612FNG has 2 H-bridges, you can not only make a robot go forwards and backwards, but also turn around by having each wheel spin in a different direction.</p>
<p><strong>Quick stats on this guy</strong>: It is capable of supplying up to 13V and 1.2A (3.2 peak)
</p></div>
<div class="rightColumn">
<p><a href="images/2012/03/TB6612FNG_arduino_hookup.png"><img alt="" class="alignleft size-medium wp-image-2060" height="306" src="images/2012/03/TB6612FNG_arduino_hookup-400x306.png" title="TB6612FNG_arduino_hookup" width="400"/></a></p>
</div>
</div>
<div class="wideBody">
<h3>Hooking it up</h3>
<p>As you can tell from the illustration this guy requires a few pins from your arduino to get it running. And it probably looks complicated at first. But it's not that bad. The first thing to notice however, is that you do need an external power source for your motors (<strong>the TB6612FNG can work with 2.5 to 13v</strong>), the 5v pin on the arduino just can not source enough power to drive 2 motors, and you could damage your arduino if you do.</p>
<p>But why it uses so many pins is for several reasons. First, there is a standby pin, if this pin is held LOW, the motors are basically disconnected from power. And... Each motor also has 3 control pins, 2 for direction, and one for speed.</p>
<h3>Code</h3>
<p>The code for this is very basic. We created a function for you that makes controlling the TB6612FNG from your arduino easier, but you can also change it up and do it your own way.</p>
<p>As I mentioned above, Each motor has 3 control pins, 2 for direction, and one for speed. When one direction pin is HIGH and the other is LOW the motor will spin one direction, flip them and it spins the other direction (both HIGH or both LOW and the motor stops). The PWM pin allows you to analogWrite to this pin to control the speed of that one motor. andlogWrite 0 and the motor stops, 255, and it will go full speed.</p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;"><span class="co1">//motor A connected between A01 and A02</span>
<span class="co1">//motor B connected between B01 and B02</span>

<span class="kw4">int</span> STBY <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="co1">//standby</span>

<span class="co1">//Motor A</span>
<span class="kw4">int</span> PWMA <span class="sy0">=</span> <span class="nu0">3</span><span class="sy0">;</span> <span class="co1">//Speed control </span>
<span class="kw4">int</span> AIN1 <span class="sy0">=</span> <span class="nu0">9</span><span class="sy0">;</span> <span class="co1">//Direction</span>
<span class="kw4">int</span> AIN2 <span class="sy0">=</span> <span class="nu0">8</span><span class="sy0">;</span> <span class="co1">//Direction</span>

<span class="co1">//Motor B</span>
<span class="kw4">int</span> PWMB <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span> <span class="co1">//Speed control</span>
<span class="kw4">int</span> BIN1 <span class="sy0">=</span> <span class="nu0">11</span><span class="sy0">;</span> <span class="co1">//Direction</span>
<span class="kw4">int</span> BIN2 <span class="sy0">=</span> <span class="nu0">12</span><span class="sy0">;</span> <span class="co1">//Direction</span>

<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>STBY<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">pinMode</span><span class="br0">(</span>PWMA<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>AIN1<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>AIN2<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">pinMode</span><span class="br0">(</span>PWMB<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>BIN1<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>BIN2<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>

<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  move<span class="br0">(</span>1<span class="sy0">,</span> 255<span class="sy0">,</span> 1<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//motor 1, full speed, left</span>
  move<span class="br0">(</span>2<span class="sy0">,</span> 255<span class="sy0">,</span> 1<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//motor 2, full speed, left</span>

  <span class="kw3">delay</span><span class="br0">(</span>1000<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//go for 1 second</span>
  stop<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">//stop</span>
  <span class="kw3">delay</span><span class="br0">(</span>250<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//hold for 250ms until move again</span>

  move<span class="br0">(</span>1<span class="sy0">,</span> 128<span class="sy0">,</span> 0<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//motor 1, half speed, right</span>
  move<span class="br0">(</span>2<span class="sy0">,</span> 128<span class="sy0">,</span> 0<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//motor 2, half speed, right</span>

  <span class="kw3">delay</span><span class="br0">(</span>1000<span class="br0">)</span><span class="sy0">;</span>
  stop<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">delay</span><span class="br0">(</span>250<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>


<span class="kw4">void</span> move<span class="br0">(</span><span class="kw4">int</span> motor<span class="sy0">,</span> <span class="kw4">int</span> speed<span class="sy0">,</span> <span class="kw4">int</span> direction<span class="br0">)</span><span class="br0">{</span>
<span class="co1">//Move specific motor at speed and direction</span>
<span class="co1">//motor: 0 for B 1 for A</span>
<span class="co1">//speed: 0 is off, and 255 is full speed</span>
<span class="co1">//direction: 0 clockwise, 1 counter-clockwise</span>

  <span class="kw3">digitalWrite</span><span class="br0">(</span>STBY<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">//disable standby</span>

  <span class="kw4">boolean</span> inPin1 <span class="sy0">=</span> <span class="kw2">LOW</span><span class="sy0">;</span>
  <span class="kw4">boolean</span> inPin2 <span class="sy0">=</span> <span class="kw2">HIGH</span><span class="sy0">;</span>

  <span class="kw1">if</span><span class="br0">(</span>direction <span class="sy0">==</span> 1<span class="br0">)</span><span class="br0">{</span>
    inPin1 <span class="sy0">=</span> <span class="kw2">HIGH</span><span class="sy0">;</span>
    inPin2 <span class="sy0">=</span> <span class="kw2">LOW</span><span class="sy0">;</span>
  <span class="br0">}</span>

  <span class="kw1">if</span><span class="br0">(</span>motor <span class="sy0">==</span> 1<span class="br0">)</span><span class="br0">{</span>
    <span class="kw3">digitalWrite</span><span class="br0">(</span>AIN1<span class="sy0">,</span> inPin1<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">digitalWrite</span><span class="br0">(</span>AIN2<span class="sy0">,</span> inPin2<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">analogWrite</span><span class="br0">(</span>PWMA<span class="sy0">,</span> speed<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span><span class="kw1">else</span><span class="br0">{</span>
    <span class="kw3">digitalWrite</span><span class="br0">(</span>BIN1<span class="sy0">,</span> inPin1<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">digitalWrite</span><span class="br0">(</span>BIN2<span class="sy0">,</span> inPin2<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">analogWrite</span><span class="br0">(</span>PWMB<span class="sy0">,</span> speed<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>

<span class="kw4">void</span> stop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
<span class="co1">//enable standby  </span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>STBY<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span> 
<span class="br0">}</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
</div>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/tb6612fng-arduino">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>