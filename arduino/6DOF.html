<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>Stable Orientation - Digital IMU 6DOF + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2012/01/6dof.jpg"/></p>
<div class="columnBody">
<div class="leftColumn">
<p>A while back we wrote an article on <a href="./sensing-orientation-with-the-adxl335-arduino">sensing orientation with the adxl335 accelerometer</a>. In that article I mentioned all the drawbacks of trying to do this with just an accelerometer, and said that if you needed something stable, what you really needed was an IMU. Well... We are back with an article covering just that, the <a href="http://www.sparkfun.com/products/10121">Digital IMU 6DOF (6 degrees of freedom) breakout board</a> from <a href="http://www.sparkfun.com/">sparkfun</a>.</p>
<p>An IMU (Inertial Measurement Unit) is a system comprised of an accelerometer and a gyroscope working in tandem to compensate for the pitfalls of each other. This particular board is comprised of the ADXL345 accelerometer (<a href="./adxl345-arduino">bildr article</a>) and the ITG-3200 gyroscope. Correctly setup, the gyro is able to kick in where an accelerometer leaves off, and vise versa. A gyro is great at measuring rotation, but has no understanding of orientation. And an accelerometer is good at determining orientation, but has no ability to keep track during movement and rotation. But just sticking these together wont give you a clean orientation, we need some hardcore math that will be able to take both the readings, along with previous readings, and make a really good estimate of what is going on. The math for this is known as filtering.</p>
<p>You may have heard of something called a kalman filter. I have searched for years and have never seen a working version for 3axis that could run on the arduino. Sadly, the arduino just dosnt have the power to make it work. Thankfully Kalman isnt the only name in town, and the fusion filter does an excellent job, and is very light mathematically and runs really well on the arduino. The awesome thing about this is that the guys over at <a href="http://www.varesano.net">varesano</a> did all the hard work in their <a href="http://www.varesano.net/projects/hardware/FreeIMU">library for the 9DOF</a>( has 3 axis magnetometer )</p>
<h3>Hooking it up</h3>
<p>The both components of the Digital IMU 6DOF are I2C devices on a single bus. I2C is a 2-wire serial connection, so we just need to connect the SDA (Data) and SCL (Clock) lines to your Arduino for communication. On your Arduino (everything but the mega) SDA is on analog pin 4, and SCL is on analog pin 5. On an arduino mega, SDA is digital 20, and SCL is digital 21. (The Arduino Leonardo will also be different). Other than these 2 lines, we just need to connect power(3.3v), ground and we are all set.</p>
<p><strong>Note:</strong> I noticed that this device is particularly sensitive to so-so wiring, so make sure your connections are solid, or you will see this guy freezing left and right.</p>
</div>
<div class="rightColumn">
<a href="images/2012/01/6DOF_arduino_hookup.png"><img alt="" class="alignleft size-medium wp-image-1937" height="646" src="images/2012/01/6DOF_arduino_hookup-400x646.png" title="6DOF_arduino_hookup" width="400"/></a>
</div>
</div>
<div class="wideBody">
<h3>Code</h3>
<p>Using this part isnt simple from a code point, so we have a library for you, and a big one at that. As I said before the guys over at <a href="http://www.varesano.net">varesano</a> did all the hard work in their <a href="http://www.varesano.net/projects/hardware/FreeIMU">library for the 9DOF</a>( has 3 axis magnetometer ) I just modified for use specifically for this board and made it into a single library so it wouldn't cause any conflicts. Because this is based off of the FreeIMU code, we are keeping their GPL license on it.
   </p></div>
<div class="columnBody">
<div class="leftColumn">
<p>To make this code work, <strong>before you load the code, or even open the Arduino program</strong>, we need to place the "FreeSixIMU" folder into your Arduino Library. If you don’t know where that is by default, Look to the right.</p>
<p>If you click the download button to the right of “Arduino” you can download the whole thing as a zip, so you dont need to copy all the files.</p>
</div>
<div class="rightColumn">
<h3>Default Library Folder Location</h3>
<p><span style="font-size: 10px; line-height:12px;"><strong>On your Mac:</strong>: In (home directory)/Documents/Arduino/libraries<br/>
<strong>On your PC:</strong>: My Documents -&gt; Arduino -&gt; libraries<br/>
<strong>On your Linux box:</strong>: (home directory)/sketchbook/libraries<br/>
</span>
</p>
</div>
</div>
<div class="clear">
<script src="../github/6dof.js"></script>
</div>
<div class="wideBody">
<h3>Visualizing the orientation with a processing sketch</h3>
<p>Sometimes it is hard to see if the output is correct... So we can verify it with a processing sketch (check out the video below). We have included a processing example "freeSixCube" and it has 2 parts. A specialized arduino firmware that must be loaded first, and a processing sketch. You need to configure the sketch to use the correct serial port.</p>
<p><strong>If you are having issues with processing sketch missing a font, let me know, I did my best to not require any font files.</strong></p>
<p>When you launch the processing sketch, (make sure to hold it very still for the first 2 seconds) it should draw up a cube, and after a second it will move to mimic your movement of the 6DOF board. You can hit "h" to reset the orientation to level so you can get it to what you consider level, hit "h" and it should look just like how you hold it from there on out.</p>
<p>You will see it drifting (moving onscreen without you moving the sensor) quite a bit at first, but hold it still and it will smooth out. But even then, the yaw will still be drifting a bit. To understand why, read on.</p>
<h3>Drifting Yaw</h3>
<p>Yaw is name for rotation around an axis that is similar to spinning a top, or shaking your head “no.” Accelerometers can’t measure this type of motion, but gyros can. Unfortunately gyros have no sense of direction, and also drift. So your yaw measurements from this will be without a sense of direction, and will drift over time. How much? Maybe a few degrees a second, maybe less, it's hard to say because this library does a good job if suppressing it, but it's not perfect.</p>
<p><strong style="color: darkred;">In the first second after the Arduino resets (due to code upload, serial connection, etc), the firmware will try to reduce the drift from the gyroscope. So Make sure to keep the IMU steady during that startup time for best results.</strong></p>
<p>If you need direction, and no drift in your yaw you need to get your self an AHRS, that's an IMU with a magnetometer on it. <a href="http://www.sparkfun.com/products/10724">Like this guy here</a>.
   </p></div>
<h3>Video</h3>
<p><iframe allowfullscreen="" frameborder="0" height="534" mozallowfullscreen="" src="http://player.vimeo.com/video/38274662?portrait=0" webkitallowfullscreen="" width="950"></iframe></p>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/stable-orientation-digital-imu-6dof-arduino">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>