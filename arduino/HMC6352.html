<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>Finding your way with the HMC6352 + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2011/01/HMC6352_title.jpg"/></p>
<div class="columnBody">
<div class="leftColumn">
Ever look into getting yourself a digital compass, but stopped because of this or that? Or maybe you bought one of the <a href="http://www.sparkfun.com/products/7915">HMC6352 modules</a> from <a href="http://sparkfun.com">sparkfun</a> because it said it was drop dead simple, but never got around to getting it to work. What ever the reason, I want to let you know, the HMC6352 is very simple, more so than an analog one in many ways. But simple does not mean easy, it is after all an I2C device, and no matter how simple, getting a reading from it is always the hardest part. Well never fear, bildr is here.
<p>When running correctly, the HMC6352 will actually repost the heading in degrees. This is great because if you have ever had an analog output compass, you know that most the battle is interpreting the reading.
</p></div>
<div class="rightColumn">
<a href="images/2011/01/HMC6352.png"><img alt="" src="images/2011/01/HMC6352.png" title="HMC6352"/></a>
</div>
</div>
<p><strong>So, without further ado here is some code to get it working.</strong></p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;"><span class="co1">//All this does is read the heading from HMC6352 and spit it out via serial</span>

<span class="co2">#include &lt;Wire.h&gt;</span>
<span class="kw4">int</span> HMC6352SlaveAddress <span class="sy0">=</span> <span class="nu12">0x42</span><span class="sy0">;</span>
<span class="kw4">int</span> HMC6352ReadAddress <span class="sy0">=</span> <span class="nu12">0x41</span><span class="sy0">;</span> <span class="co1">//"A" in hex, A command is: </span>

<span class="kw4">int</span> headingValue<span class="sy0">;</span>

<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="co1">// "The Wire library uses 7 bit addresses throughout. </span>
  <span class="co1">//If you have a datasheet or sample code that uses 8 bit address, </span>
  <span class="co1">//you'll want to drop the low bit (i.e. shift the value one bit to the right), </span>
  <span class="co1">//yielding an address between 0 and 127."</span>
  HMC6352SlaveAddress <span class="sy0">=</span> HMC6352SlaveAddress <span class="sy0">&gt;&gt;</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="co1">// I know 0x42 is less than 127, but this is still required</span>

  <span class="kw3">Serial</span>.<span class="me1">begin</span><span class="br0">(</span>9600<span class="br0">)</span><span class="sy0">;</span>
  Wire.<span class="me1">begin</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>

<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="co1">//"Get Data. Compensate and Calculate New Heading"</span>
  Wire.<span class="me1">beginTransmission</span><span class="br0">(</span>HMC6352SlaveAddress<span class="br0">)</span><span class="sy0">;</span>
  Wire.<span class="me1">send</span><span class="br0">(</span>HMC6352ReadAddress<span class="br0">)</span><span class="sy0">;</span>              <span class="co1">// The "Get Data" command</span>
  Wire.<span class="me1">endTransmission</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">//time delays required by HMC6352 upon receipt of the command</span>
  <span class="co1">//Get Data. Compensate and Calculate New Heading : 6ms</span>
  <span class="kw3">delay</span><span class="br0">(</span>6<span class="br0">)</span><span class="sy0">;</span>

  Wire.<span class="me1">requestFrom</span><span class="br0">(</span>HMC6352SlaveAddress<span class="sy0">,</span> 2<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//get the two data bytes, MSB and LSB</span>

  <span class="co1">//"The heading output data will be the value in tenths of degrees</span>
  <span class="co1">//from zero to 3599 and provided in binary format over the two bytes."</span>
  <span class="kw4">byte</span> MSB <span class="sy0">=</span> Wire.<span class="me1">receive</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> LSB <span class="sy0">=</span> Wire.<span class="me1">receive</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw4">float</span> headingSum <span class="sy0">=</span> <span class="br0">(</span>MSB <span class="sy0">&lt;&lt;</span> 8<span class="br0">)</span> <span class="sy0">+</span> LSB<span class="sy0">;</span> <span class="co1">//(MSB / LSB sum)</span>
  <span class="kw4">float</span> headingInt <span class="sy0">=</span> headingSum <span class="sy0">/</span> <span class="nu0">10</span><span class="sy0">;</span> 

  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>headingInt<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">" degrees"</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">delay</span><span class="br0">(</span>100<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
<h3>Hooking it up</h3>
<p>When hooking up an I2C device to your arduino, all you need to know is that I2C is a 2-wire serial connection, SDA (Data) and SCL (clock) - On your arduino (everything but the mega) SDA is on analog input pin 4, and SCL is on analog pin 5. On an arduino mega, SDA is digital 20, and SCL is digital 21.</p>
<h3>Sort comings of all digital compasses</h3>
<p>If you have never used a digital compass, you may not know that they have 2 major downfalls. One, they can not be used around any magnet of any real strength. It will really throw off the reading or just report the direction of the magnet if it is strong or close enough (though if you get creative you could use that to your advantage). And 2, without something called "tilt compensation", the compass will only be accurate held at +/- a few degrees of level. Sadly most tilt compensated compasses are 3x as expensive.</p>
<p>I know this tutorial was short, but hey... The long ones need more time. And hopefully it will help you find your way to get you hmc6352 up and running on the arduino. If you have any questions, need help, or want to comment, you can do so by clicking on the discussion link.</p>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/hmc6352">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>