<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>L3G4200D Tripple Axis Gyroscope + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2011/06/L3G4200D.jpg"/></p>
<div class="intro">
<strong>Before we begin, just note, that while this all works, I believe the output is scaled wrong. The noise floor is very high. But from everything I have found it looks like this is how it is.</strong>
</div>
<div class="columnBody">
<div class="leftColumn">
We have covered, accelerometers, GPSs, compasses... But no gyros. Why? Not sure, but I figured today I would put an end to that, so I grabbed a L3G4200D 3-axis gyro from sparkfun.
<p>The L3G4200D is a 3-axis angular rate sensor, aka gyro/gyroscope with a user selectable 250, 500 or 2000º/Sec scale. I was about to write about what a gyro is, but Sparkfun has done a really great job of that, so to quote them:</p>
<blockquote><p>Gyroscopes measure angular velocity, how fast something is spinning about an axis. If you're trying to monitor the orientation of an object in motion, an accelerometer may not give you enough information to know exactly how it's oriented. Unlike accelerometers gyros are not affected by gravity, so they make a great complement to each other. You'll usually see angular velocity represented in units of rotations per minute (RPM), or degrees per second (°/s). The three axes of rotation are either referenced as x, y, and z, or roll, pitch, and yaw.
</p></blockquote>
</div>
<div class="rightColumn">
<p><a href="images/2011/06/L3G4200D-hookup2.png"><img alt="" class="alignleft size-medium wp-image-1358" height="214" src="images/2011/06/L3G4200D-hookup2-400x214.png" title="L3G4200D-hookup2" width="400"/></a></p>
</div>
</div>
<h3>Hooking It Up</h3>
<p>The L3G4200D has a lot of pins on it because it supports both SPI and I2C but also has some other features as well such as programmable interrupts. We are going to go as simple with this as possible.</p>
<p>The L3G4200D supports both SPI and I2C, but we are just going to talk I2C here. I2C is a 2-wire serial connection, so you just need to connect the SDA (Data) and SCL (Clock) lines to your Arduino for communication. On your Arduino (everything but the mega) SDA is on analog pin 4, and SCL is on analog pin 5. On an arduino mega, SDA is digital 20, and SCL is digital 21.</p>
<p>But other than Power, Ground, and the I2C pins, we just need to connect SD0 to 3.3v (to set the I2c Address).</p>
<h3>Code</h3>
<p>The code for this is a little complex mainly because it is a digital device. But I tried to simplify it as much as possible for you. You may have noticed that Sparkfun already had a code example written. Yep... And part of this code is based on that. I actually decided to write new code for 2 reasons. 1: Their code is CreativeCommons licensed. I like MIT better because you are more free to do what you need with it. 2: I like I2C better than SPI - Why? 2 less wires!</p>
<p>This code just outputs the x,y,z axis angular rate (in deg/sec) in the serial terminal. Simple as that.</p>
<p><strong style="color:darkred;">According to the data sheet, this is all correct. But when the sensor is sitting still and is set to 2000º/sec, I am seeing readings of 0-70 on all 3 axises. I know gyros drift, but this seems weird. If someone knows what is going wrong here please let me know.</strong></p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;">
<span class="co2">#include &lt;Wire.h&gt;</span>

<span class="co2">#define CTRL_REG1 0x20</span>
<span class="co2">#define CTRL_REG2 0x21</span>
<span class="co2">#define CTRL_REG3 0x22</span>
<span class="co2">#define CTRL_REG4 0x23</span>
<span class="co2">#define CTRL_REG5 0x24</span>

<span class="kw4">int</span> L3G4200D_Address <span class="sy0">=</span> <span class="nu0">105</span><span class="sy0">;</span> <span class="co1">//I2C address of the L3G4200D</span>

<span class="kw4">int</span> x<span class="sy0">;</span>
<span class="kw4">int</span> y<span class="sy0">;</span>
<span class="kw4">int</span> z<span class="sy0">;</span>

<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>

  Wire.<span class="me1">begin</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">begin</span><span class="br0">(</span>9600<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"starting up L3G4200D"</span><span class="br0">)</span><span class="sy0">;</span>
  setupL3G4200D<span class="br0">(</span>2000<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Configure L3G4200  - 250, 500 or 2000 deg/sec</span>

  <span class="kw3">delay</span><span class="br0">(</span>1500<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//wait for the sensor to be ready </span>
<span class="br0">}</span>

<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
   getGyroValues<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>  <span class="co1">// This will update x, y, and z with new values</span>

  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">"X:"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>x<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">" Y:"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>y<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">" Z:"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span>z<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">delay</span><span class="br0">(</span>100<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//Just here to slow down the serial to make it more readable</span>
<span class="br0">}</span>

<span class="kw4">void</span> getGyroValues<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>

  <span class="kw4">byte</span> xMSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x29<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> xLSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x28<span class="br0">)</span><span class="sy0">;</span>
  x <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>xMSB <span class="sy0">&lt;&lt;</span> 8<span class="br0">)</span> <span class="sy0">|</span> xLSB<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw4">byte</span> yMSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x2B<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> yLSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x2A<span class="br0">)</span><span class="sy0">;</span>
  y <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>yMSB <span class="sy0">&lt;&lt;</span> 8<span class="br0">)</span> <span class="sy0">|</span> yLSB<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw4">byte</span> zMSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x2D<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> zLSB <span class="sy0">=</span> readRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> 0x2C<span class="br0">)</span><span class="sy0">;</span>
  z <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>zMSB <span class="sy0">&lt;&lt;</span> 8<span class="br0">)</span> <span class="sy0">|</span> zLSB<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>

<span class="kw4">int</span> setupL3G4200D<span class="br0">(</span><span class="kw4">int</span> scale<span class="br0">)</span><span class="br0">{</span>
  <span class="co1">//From  Jim Lindblom of Sparkfun's code</span>

  <span class="co1">// Enable x, y, z and turn off power down:</span>
  writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG1<span class="sy0">,</span> 0b00001111<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// If you'd like to adjust/use the HPF, you can edit the line below to configure CTRL_REG2:</span>
  writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG2<span class="sy0">,</span> 0b00000000<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// Configure CTRL_REG3 to generate data ready interrupt on INT2</span>
  <span class="co1">// No interrupts used on INT1, if you'd like to configure INT1</span>
  <span class="co1">// or INT2 otherwise, consult the datasheet:</span>
  writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG3<span class="sy0">,</span> 0b00001000<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// CTRL_REG4 controls the full-scale range, among other things:</span>

  <span class="kw1">if</span><span class="br0">(</span>scale <span class="sy0">==</span> 250<span class="br0">)</span><span class="br0">{</span>
    writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG4<span class="sy0">,</span> 0b00000000<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>scale <span class="sy0">==</span> 500<span class="br0">)</span><span class="br0">{</span>
    writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG4<span class="sy0">,</span> 0b00010000<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span><span class="kw1">else</span><span class="br0">{</span>
    writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG4<span class="sy0">,</span> 0b00110000<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>

  <span class="co1">// CTRL_REG5 controls high-pass filtering of outputs, use it</span>
  <span class="co1">// if you'd like:</span>
  writeRegister<span class="br0">(</span>L3G4200D_Address<span class="sy0">,</span> CTRL_REG5<span class="sy0">,</span> 0b00000000<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>

<span class="kw4">void</span> writeRegister<span class="br0">(</span><span class="kw4">int</span> deviceAddress<span class="sy0">,</span> <span class="kw4">byte</span> address<span class="sy0">,</span> <span class="kw4">byte</span> val<span class="br0">)</span> <span class="br0">{</span>
    Wire.<span class="me1">beginTransmission</span><span class="br0">(</span>deviceAddress<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// start transmission to device </span>
    Wire.<span class="me1">write</span><span class="br0">(</span>address<span class="br0">)</span><span class="sy0">;</span>       <span class="co1">// send register address</span>
    Wire.<span class="me1">write</span><span class="br0">(</span>val<span class="br0">)</span><span class="sy0">;</span>         <span class="co1">// send value to write</span>
    Wire.<span class="me1">endTransmission</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>     <span class="co1">// end transmission</span>
<span class="br0">}</span>

<span class="kw4">int</span> readRegister<span class="br0">(</span><span class="kw4">int</span> deviceAddress<span class="sy0">,</span> <span class="kw4">byte</span> address<span class="br0">)</span><span class="br0">{</span>

    <span class="kw4">int</span> v<span class="sy0">;</span>
    Wire.<span class="me1">beginTransmission</span><span class="br0">(</span>deviceAddress<span class="br0">)</span><span class="sy0">;</span>
    Wire.<span class="me1">write</span><span class="br0">(</span>address<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// register to read</span>
    Wire.<span class="me1">endTransmission</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

    Wire.<span class="me1">requestFrom</span><span class="br0">(</span>deviceAddress<span class="sy0">,</span> 1<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// read a byte</span>

    <span class="kw1">while</span><span class="br0">(</span><span class="sy0">!</span>Wire.<span class="me1">available</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="co1">// waiting</span>
    <span class="br0">}</span>

    v <span class="sy0">=</span> Wire.<span class="me1">read</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">return</span> v<span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/l3g4200d-arduino">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>