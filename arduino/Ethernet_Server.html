<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>
   Pin Control Over the Internet – Arduino + Ethernet
</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2011/06/ethernet_shield_server.jpg"/></p>
<div class="columnBody">
<div class="leftColumn">
         In a previous article we showed you how to control digital pins over over serial, and showed how such a simple thing can be so powerful. One major downfall with that is you need to be nearby to send commands… So today we are going to look at doing the same thing, but this time we will be doing it over the internet using the Arduino Ethernet Shield.
<p>As per our usual style, I am going to make this as simple as possible so it is easier to extend. So if you you are looking for something with an HTML interface, this article will not be covering that.</p>
<p>The Arduino Ethernet Shield is capable of being both a client (like a web browser), and a server, and with the onboard SD card-slot can be quite powerful by hosting up full websites, but for this article we are just looking at using the Arduino as a server and you will control it simply by going to a specific URL.</p>
<p>Note that the Ethernet Shield uses digital pins, 10, 11, 12, and 13 for itself, so it is best to leave these alone and not try to use them for anything else.</p>
<div class="tag-wrapper" style="clear:both;float:left;width:100%;margin:0 0 20px 0;">
<br/>
<h3>Getting It On The Net</h3>
<p>Getting the ethernet shield on the internet is going to differ depending on your network, but no matter what, you need to plug it into an ethernet port connected to the internet – So make sure you do that.</p>
<p><del datetime="2012-01-03T00:51:56+00:00">Without an extra library, the ethernet code does not support DHCP and therefore requires that we hardcode the IP Address,gateway address, and subnet mask for your network. This isn’t really that hard, it is more of a pain when especially if you want to plug it into a different network as the same settings may not work. </del> </p>
<p><strong>As of Arduino 1.0, the library does support DHCP</strong> So you should be able to just plug it into your network and have it work. <b>It will report the ipAddress to the serial monitor</b></p>
<p>We also left the code in there to do a manual setup if you prefer doing it that way. (I know I do) If you are familiar with your network and how to do this, awesome, just make sure you change the setting at the top of the code to fit your network, and un comment out the parts related to it. If you are not familiar with it, we can help you in the forum, and have posted some general help in there as well.</p>
</div>
</div>
<div class="rightColumn">
<a href="images/2011/06/arduino-ethernet-server.png"><img alt="" class="alignleft size-medium wp-image-1329" height="663" src="images/2011/06/arduino-ethernet-server-400x663.png" title="arduino-ethernet-server" width="400"/></a>
</div>
</div>
<h3>Hooking It Up</h3>
<p>Aside from plugging the Ethernet Shield into you Arduino, there isn’t really anything you HAVE to have. I have LEDs on pins 2-9 on this example so we can see it being controlled. If you do not intend to blink LEDs or test the code with LEDs, you can by all means leave these off.</p>
<h3>Code</h3>
<p>Assuming the the ip address of the arduino is 192.168.1.167 (check the serial monitor to see what it is), this code will allow you to send a sequence to the arduino via your web browser like so: http://192.168.1.167/?23456789</p>
<p>The way the code is currently setup is that the pins will go high one at a time, in sequence, for 25ms then move on to the next in line. So this example would blink pin 2,3,4,5,6,7,8 then 9.</p>
<p>As it stands, the user will not see the webpage return until the arduino is finished processing the request. You could change the code to return right away and then process the request afterwards if needed, but I liked seeing the return after it was completed – like a receipt, instead of an order.</p>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;">
<span class="co2">#include &lt;Ethernet.h&gt;</span>
<span class="co2">#include &lt;SPI.h&gt;</span>
<span class="kw4">boolean</span> reading <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>

<span class="co1">////////////////////////////////////////////////////////////////////////</span>
<span class="co1">//CONFIGURE</span>
<span class="co1">////////////////////////////////////////////////////////////////////////</span>
  <span class="co1">//byte ip[] = { 192, 168, 0, 199 };   //Manual setup only</span>
  <span class="co1">//byte gateway[] = { 192, 168, 0, 1 }; //Manual setup only</span>
  <span class="co1">//byte subnet[] = { 255, 255, 255, 0 }; //Manual setup only</span>

  <span class="co1">// if need to change the MAC address (Very Rare)</span>
  <span class="kw4">byte</span> mac<span class="br0">[</span><span class="br0">]</span> <span class="sy0">=</span> <span class="br0">{</span> 0xDE<span class="sy0">,</span> 0xAD<span class="sy0">,</span> 0xBE<span class="sy0">,</span> 0xEF<span class="sy0">,</span> 0xFE<span class="sy0">,</span> 0xED <span class="br0">}</span><span class="sy0">;</span>

  EthernetServer server <span class="sy0">=</span> EthernetServer<span class="br0">(</span>80<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//port 80</span>
<span class="co1">////////////////////////////////////////////////////////////////////////</span>

<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="kw3">Serial</span>.<span class="me1">begin</span><span class="br0">(</span>9600<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">//Pins 10,11,12 &amp; 13 are used by the ethernet shield</span>

  <span class="kw3">pinMode</span><span class="br0">(</span>2<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>3<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>4<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>5<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>6<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>7<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>8<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>9<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>

  Ethernet.<span class="me1">begin</span><span class="br0">(</span>mac<span class="br0">)</span><span class="sy0">;</span>
  <span class="co1">//Ethernet.begin(mac, ip, gateway, subnet); //for manual setup</span>

  server.<span class="me1">begin</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span>Ethernet.<span class="me1">localIP</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>

<span class="br0">}</span>

<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>

  <span class="co1">// listen for incoming clients, and process qequest.</span>
  checkForClient<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

<span class="br0">}</span>

<span class="kw4">void</span> checkForClient<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>

  EthernetClient client <span class="sy0">=</span> server.<span class="me1">available</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw1">if</span> <span class="br0">(</span>client<span class="br0">)</span> <span class="br0">{</span>

    <span class="co1">// an http request ends with a blank line</span>
    <span class="kw4">boolean</span> currentLineIsBlank <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
    <span class="kw4">boolean</span> sentHeader <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>

    <span class="kw1">while</span> <span class="br0">(</span>client.<span class="me1">connected</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
      <span class="kw1">if</span> <span class="br0">(</span>client.<span class="me1">available</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>

        <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>sentHeader<span class="br0">)</span><span class="br0">{</span>
          <span class="co1">// send a standard http response header</span>
          client.<span class="me1">println</span><span class="br0">(</span><span class="st0">"HTTP/1.1 200 OK"</span><span class="br0">)</span><span class="sy0">;</span>
          client.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Content-Type: text/html"</span><span class="br0">)</span><span class="sy0">;</span>
          client.<span class="me1">println</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
          sentHeader <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
        <span class="br0">}</span>

        <span class="kw4">char</span> c <span class="sy0">=</span> client.<span class="me1">read</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

        <span class="kw1">if</span><span class="br0">(</span>reading <span class="sy0">&amp;&amp;</span> c <span class="sy0">==</span> <span class="st0">' '</span><span class="br0">)</span> reading <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
        <span class="kw1">if</span><span class="br0">(</span>c <span class="sy0">==</span> <span class="st0">'?'</span><span class="br0">)</span> reading <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span> <span class="co1">//found the ?, begin reading the info</span>

        <span class="kw1">if</span><span class="br0">(</span>reading<span class="br0">)</span><span class="br0">{</span>
          <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>c<span class="br0">)</span><span class="sy0">;</span>

           <span class="kw1">switch</span> <span class="br0">(</span>c<span class="br0">)</span> <span class="br0">{</span>
            <span class="kw1">case</span> <span class="st0">'2'</span><span class="sy0">:</span>
              <span class="co1">//add code here to trigger on 2</span>
              triggerPin<span class="br0">(</span>2<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'3'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 3</span>
              triggerPin<span class="br0">(</span>3<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'4'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 4</span>
              triggerPin<span class="br0">(</span>4<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'5'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 5</span>
              triggerPin<span class="br0">(</span>5<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'6'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 6</span>
              triggerPin<span class="br0">(</span>6<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'7'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 7</span>
              triggerPin<span class="br0">(</span>7<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'8'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 8</span>
              triggerPin<span class="br0">(</span>8<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
            <span class="kw1">case</span> <span class="st0">'9'</span><span class="sy0">:</span>
            <span class="co1">//add code here to trigger on 9</span>
              triggerPin<span class="br0">(</span>9<span class="sy0">,</span> client<span class="br0">)</span><span class="sy0">;</span>
              <span class="kw2">break</span><span class="sy0">;</span>
          <span class="br0">}</span>

        <span class="br0">}</span>

        <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy0">==</span> <span class="st0">'<span class="es1">\n</span>'</span> <span class="sy0">&amp;&amp;</span> currentLineIsBlank<span class="br0">)</span>  <span class="kw2">break</span><span class="sy0">;</span>

        <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy0">==</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="br0">)</span> <span class="br0">{</span>
          currentLineIsBlank <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
        <span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy0">!=</span> <span class="st0">'<span class="es1">\r</span>'</span><span class="br0">)</span> <span class="br0">{</span>
          currentLineIsBlank <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
        <span class="br0">}</span>

      <span class="br0">}</span>
    <span class="br0">}</span>

    <span class="kw3">delay</span><span class="br0">(</span>1<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// give the web browser time to receive the data</span>
    client.<span class="me1">stop</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// close the connection:</span>

  <span class="br0">}</span> 

<span class="br0">}</span>

<span class="kw4">void</span> triggerPin<span class="br0">(</span><span class="kw4">int</span> pin<span class="sy0">,</span> EthernetClient client<span class="br0">)</span><span class="br0">{</span>
<span class="co1">//blink a pin - Client needed just for HTML output purposes.  </span>
  client.<span class="me1">print</span><span class="br0">(</span><span class="st0">"Turning on pin "</span><span class="br0">)</span><span class="sy0">;</span>
  client.<span class="me1">println</span><span class="br0">(</span>pin<span class="br0">)</span><span class="sy0">;</span>
  client.<span class="me1">print</span><span class="br0">(</span><span class="st0">"&lt;br&gt;"</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">digitalWrite</span><span class="br0">(</span>pin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">delay</span><span class="br0">(</span>25<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>pin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">delay</span><span class="br0">(</span>25<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="codeFoot">
         Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> – Please use, change and share it.
      </div>

</div>
<h3>Video</h3>
<p><iframe frameborder="0" height="534" src="http://player.vimeo.com/video/24849170?byline=0&amp;portrait=0" width="949"></iframe></p>
<h3>Extending This</h3>
<p>By adding to, or changing, the switch statement in the code, you could easily add support for letters as well allowing you to call even more functions over the web. You can also change the code that is run if needed. So instead of blinking pins, maybe you control motor directions or timing. This could be easily be used for automation or art installations.</p>
<p>If I can take the non ethernet version of this article and make <a href="http://bells.tellart.com/">web controllable bells</a>, just imagine what you can do with this.</p>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/arduino-ethernet-pin-control">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>