<!DOCTYPE html >

<html lang="en">
<head>
<meta charset="utf-8"/>
<link href="style/main.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.0/mootools-yui-compressed.js" type="text/javascript"></script>
<script type="text/javascript">
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-4050921-11', 'auto');
	ga('send', 'pageview');
	
	function nospam(user,domain) { window.location = "mailto:" + user + "@" + domain; }
		
		
	window.addEvent('domready', function(){

		$$('.codeHead .copy').addEvent('click', function(event) {
			this.highlight();
			event.stop();
			
			var code = this.getParent('.codesnip-container').getElement('.codesnip');
			
			if (code.select) {
				code.select();
			}else if (document.selection) {
				var range = document.body.createTextRange();
				range.moveToElementText(code);
				range.select();
			} else if (window.getSelection) {
				var range = document.createRange();
				range.selectNode(code);
				window.getSelection().addRange(range);
			}
			
			
			try {
				var successful = document.execCommand('copy');
				var msg = successful ? 'successful' : 'unsuccessful';
				console.log('Copying text command was ' + msg);
			} catch (err) {
				console.log('Oops, unable to copy');
			}
		});
	
	});
	</script>
<!--
	
	Icon Set:	IcoMoon - Free -- http://keyamoon.com/icomoon/
	License:	CC BY-SA 3.0 -- http://creativecommons.org/licenses/by-sa/3.0/
	
	
	Icon Set:	Broccolidry -- http://dribbble.com/shots/587469-Free-16px-Broccolidryiconsaniconsetitisfullof-icons
	License:	Aribitrary -- http://licence.visualidiot.com/
	
	-->
<title>Adam meyer | Arduino</title>
</head>
<body>
<div id="headerWrapper">
<div id="header">
<h1><a href="http://adam-meyer.com">Adam meyer</a></h1>
<h2>Design + Code</h2>
<div id="topNav">
<a href="../about.html" id="aboutLink">About</a>
<a href="../resume.pdf">Resume</a>
<a href="../index.html">Portfolio</a>
<a href="index.html">Arduino Articles</a>
<span id="contactLink"><span onclick="javascript:nospam('sternmeyer','gmail.com');">Contact</span>
<div id="contactLinks">
<a class="icon-twitter" href="http://twitter.com/sternmeyer" title="twitter"></a>
<a class="icon-linkedin" href="http://www.linkedin.com/pub/adam-meyer/20/7a/850/" title="linked in"></a>
<a class="icon-dribbble" href="http://dribbble.com/ameyer" title="dribbble"></a>
<a class="icon-github" href="https://github.com/ameyer" title="github"></a>
<a class="icon-instagram" href="http://instagram.com/sternmeyer" title="instagram"></a>
<a class="icon-envelope2" href="mailto:sternmeyer@gmail.com" title="email"></a>
</div>
</span>
</div>
</div>
</div>
<div id="articleWrapper">
<div class="content">
<div class="post"><h2>Sensing Humidity With The SHT15 + Arduino</h2>
<div class="postContent">
<p><img class="noFrame" src="images/2012/01/SHT15.jpg"/></p>
<div class="columnBody">
<div class="leftColumn">
The SHT15 is a digital humidity sensor that outputs a fully calibrated humidity reading. And... because what we are measuring is actually <a href="http://en.wikipedia.org/wiki/Relative_humidity">relative humidity</a>, and relative humidity being relative to temperature, the SHT15 has a builtin digital thermometer. This makes things much easier to work with <a href="./hih4030-arduino">than sensors without a thermometer onboard</a>. You can <a href="https://www.sparkfun.com/products/8257">pick one up from sparkFun here</a>.
<h3>Hooking it up</h3>
<p>The SHT15 uses a two-wire connection for communication that is similar to, but not, I2C. So we wont be able to use the Arduino's dedicated lines for this. The down side is it is a bit slower to get readings from, the plus side is that you can connect it to any 2 digital pins you want. We are using pins 2 and 3 on our arduino.</p>
<p><b style="color: #D00;">BEFORE YOU SOLDER IT UP... </b>Note that this board can not be washed! So if you are using flux, or solder that you normally clean up, don't (They actually recommend to use "no-clean" solder just so you don't have to worry about it). And be extremely careful not to get it wet at all. </p>
<p><b style="color: #D00;">AFTER YOU SOLDER IT UP... </b> To get a clean reading, the sensor needs to be stored at &gt;75% humidity for at least 12 hours to allow the polymer to re-hydrate (just what the doc says). If you don't, your SHT15 may read an offset that slowly disappears if exposed to ambient conditions. Alternatively the re-hydration process may be performed at ambient conditions (&gt;40% Humidity) for 5 + days.</p>
<p>Im not exactly sure how you do that... But someone noted that they put it in a ziplock with a wet towel (not touching) for 12H.</p>
<h3>Code</h3>
<p>The code for this is a bit wacky (as with most digital sensors), but it is split up pretty nicely, and is as easy to read as it can be.</p>
<p><b>Note that the readings are a bit slow to return a value (100+ ms).</b></p>
</div>
<div class="rightColumn">
<a href="images/2012/11/sht15-arduino-hookup.png"><img alt="" class="alignleft size-medium wp-image-2361" height="678" src="images/2012/11/sht15-arduino-hookup-400x678.png" title="sht15-arduino-hookup" width="400"/></a>
</div>
</div>
<div class="codesnip-container">
<div class="codeHead">
<a class="copy" href="#">Copy Code</a>
</div>
<pre class="arduino codesnip" style="font-family:monospace;"><span class="co1">//Based of the wiring code at http://wiring.org.co/learning/basics/humiditytemperaturesht15.html</span>

<span class="kw4">int</span> SHT_clockPin <span class="sy0">=</span> <span class="nu0">3</span><span class="sy0">;</span>  <span class="co1">// pin used for clock</span>
<span class="kw4">int</span> SHT_dataPin  <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span>  <span class="co1">// pin used for data</span>

<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="kw3">Serial</span>.<span class="me1">begin</span><span class="br0">(</span>9600<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// open serial at 9600 bps</span>
<span class="br0">}</span>

<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="co1">//these can take a bit to get the values (100ms or so)</span>
  <span class="kw4">float</span> temperature <span class="sy0">=</span> getTemperature<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">float</span> humidity <span class="sy0">=</span> getHumidity<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span>temperature<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">print</span><span class="br0">(</span><span class="st0">" | "</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span>humidity<span class="br0">)</span><span class="sy0">;</span>

<span class="br0">}</span>






<span class="kw4">float</span> getTemperature<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="co1">//Return Temperature in Celsius</span>
  SHT_sendCommand<span class="br0">(</span>B00000011<span class="sy0">,</span> SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  SHT_waitForResult<span class="br0">(</span>SHT_dataPin<span class="br0">)</span><span class="sy0">;</span>

  <span class="kw4">int</span> val <span class="sy0">=</span> SHT_getData<span class="br0">(</span>SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  SHT_skipCrc<span class="br0">(</span>SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">return</span> <span class="br0">(</span><span class="kw4">float</span><span class="br0">)</span>val <span class="sy0">*</span> 0.01 <span class="sy0">-</span> <span class="nu0">40</span><span class="sy0">;</span> <span class="co1">//convert to celsius</span>
<span class="br0">}</span>

<span class="kw4">float</span> getHumidity<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
  <span class="co1">//Return  Relative Humidity</span>
  SHT_sendCommand<span class="br0">(</span>B00000101<span class="sy0">,</span> SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  SHT_waitForResult<span class="br0">(</span>SHT_dataPin<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">int</span> val <span class="sy0">=</span> SHT_getData<span class="br0">(</span>SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  SHT_skipCrc<span class="br0">(</span>SHT_dataPin<span class="sy0">,</span> SHT_clockPin<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">return</span> <span class="sy0">-</span>4.0 <span class="sy0">+</span> 0.0405 <span class="sy0">*</span> val <span class="sy0">+</span> <span class="sy0">-</span>0.0000028 <span class="sy0">*</span> val <span class="sy0">*</span> val<span class="sy0">;</span> 
<span class="br0">}</span>


<span class="kw4">void</span> SHT_sendCommand<span class="br0">(</span><span class="kw4">int</span> command<span class="sy0">,</span> <span class="kw4">int</span> dataPin<span class="sy0">,</span> <span class="kw4">int</span> clockPin<span class="br0">)</span><span class="br0">{</span>
  <span class="co1">// send a command to the SHTx sensor</span>
  <span class="co1">// transmission start</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// shift out the command (the 3 MSB are address and must be 000, the last 5 bits are the command)</span>
  <span class="kw3">shiftOut</span><span class="br0">(</span>dataPin<span class="sy0">,</span> clockPin<span class="sy0">,</span> MSBFIRST<span class="sy0">,</span> command<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// verify we get the right ACK</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">INPUT</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw1">if</span> <span class="br0">(</span><span class="kw3">digitalRead</span><span class="br0">(</span>dataPin<span class="br0">)</span><span class="br0">)</span> <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"ACK error 0"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span><span class="kw3">digitalRead</span><span class="br0">(</span>dataPin<span class="br0">)</span><span class="br0">)</span> <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"ACK error 1"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>


<span class="kw4">void</span> SHT_waitForResult<span class="br0">(</span><span class="kw4">int</span> dataPin<span class="br0">)</span><span class="br0">{</span>
  <span class="co1">// wait for the SHTx answer</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">INPUT</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="kw4">int</span> ack<span class="sy0">;</span> <span class="co1">//acknowledgement</span>

  <span class="co1">//need to wait up to 2 seconds for the value</span>
  <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">1000</span><span class="sy0">;</span> <span class="sy0">++</span>i<span class="br0">)</span><span class="br0">{</span>
    <span class="kw3">delay</span><span class="br0">(</span>2<span class="br0">)</span><span class="sy0">;</span>
    ack <span class="sy0">=</span> <span class="kw3">digitalRead</span><span class="br0">(</span>dataPin<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">(</span>ack <span class="sy0">==</span> <span class="kw2">LOW</span><span class="br0">)</span> <span class="kw2">break</span><span class="sy0">;</span>
  <span class="br0">}</span>

  <span class="kw1">if</span> <span class="br0">(</span>ack <span class="sy0">==</span> <span class="kw2">HIGH</span><span class="br0">)</span> <span class="kw3">Serial</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"ACK error 2"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>

<span class="kw4">int</span> SHT_getData<span class="br0">(</span><span class="kw4">int</span> dataPin<span class="sy0">,</span> <span class="kw4">int</span> clockPin<span class="br0">)</span><span class="br0">{</span>
  <span class="co1">// get data from the SHTx sensor</span>

  <span class="co1">// get the MSB (most significant bits)</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">INPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> MSB <span class="sy0">=</span> shiftIn<span class="br0">(</span>dataPin<span class="sy0">,</span> clockPin<span class="sy0">,</span> MSBFIRST<span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// send the required ACK</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>

  <span class="co1">// get the LSB (less significant bits)</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">INPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">byte</span> LSB <span class="sy0">=</span> shiftIn<span class="br0">(</span>dataPin<span class="sy0">,</span> clockPin<span class="sy0">,</span> MSBFIRST<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">return</span> <span class="br0">(</span><span class="br0">(</span>MSB <span class="sy0">&lt;&lt;</span> 8<span class="br0">)</span> <span class="sy0">|</span> LSB<span class="br0">)</span><span class="sy0">;</span> <span class="co1">//combine bits</span>
<span class="br0">}</span>

<span class="kw4">void</span> SHT_skipCrc<span class="br0">(</span><span class="kw4">int</span> dataPin<span class="sy0">,</span> <span class="kw4">int</span> clockPin<span class="br0">)</span><span class="br0">{</span>
  <span class="co1">// skip CRC data from the SHTx sensor</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">pinMode</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>dataPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">digitalWrite</span><span class="br0">(</span>clockPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre>
<div class="codeFoot">
				Unless otherwise stated, this code is released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> - Please use, change and share it.
			</div>
</div>
</div>
<div id="attribution">
<p>Article taken from <a href="http://bildr.org/sht15-arduino">bildr.org</a> with minor changes - <i>I am the original author of this content</i></p>
<div id="attributionIcons">
<div class="ccIcon cc"></div>
<div class="ccIcon sa"></div>
<div class="ccIcon attribution"></div>
<div id="attributionText">
<a href="https://creativecommons.org/licenses/by-sa/3.0/">Content available under:<br/>Attribution-Share Alike 3.0 Unported</a>
</div>
</div>
</div>
</div></div></div></body></html>